---
phase: 13-e2e-integration-launch-polish
plan: 06
type: execute
wave: 1
depends_on: []
files_modified:
  - android/build-logic/convention/src/main/kotlin/dqxn.android.library.gradle.kts
  - android/build-logic/convention/src/main/kotlin/dqxn.android.application.gradle.kts
  - android/app/src/test/kotlin/app/dqxn/android/app/localization/HardcodedTextLintTest.kt
  - android/pack/essentials/src/test/kotlin/app/dqxn/android/pack/essentials/localization/LocaleFormattingTest.kt
autonomous: true
requirements:
  - NF-I1

must_haves:
  truths:
    - "Android lint HardcodedText check is error-severity in all modules"
    - "No hardcoded user-facing text in Compose @Composable functions"
    - "Essentials pack renderers use locale-aware formatting for numbers and dates"
  artifacts:
    - path: "android/app/src/test/kotlin/app/dqxn/android/app/localization/HardcodedTextLintTest.kt"
      provides: "Lint gate verification for hardcoded text"
    - path: "android/pack/essentials/src/test/kotlin/app/dqxn/android/pack/essentials/localization/LocaleFormattingTest.kt"
      provides: "Locale-aware formatting verification for widget renderers"
  key_links:
    - from: "Convention plugins"
      to: "Android lint config"
      via: "lintOptions.error('HardcodedText')"
      pattern: "HardcodedText.*error|severity.*error"
---

<objective>
Enforce NF-I1 (all user-facing strings in Android string resources) via lint severity escalation and verify locale-aware formatting in essentials pack.

Purpose: V1 launches English-only, but all strings must be in Android string resources for future localization. Android lint's built-in `HardcodedText` check detects violations -- this plan escalates it to error severity in convention plugins so it becomes a build-breaking gate. Also verifies essentials pack uses locale-aware formatting for numbers and dates.

Output: Lint severity config in convention plugins, lint verification test, locale-aware formatting test.
</objective>

<execution_context>
@/Users/ohm/.claude/get-shit-done/workflows/execute-plan.md
@/Users/ohm/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/13-e2e-integration-launch-polish/13-RESEARCH.md
@android/build-logic/convention/src/main/kotlin/dqxn.android.library.gradle.kts
@android/build-logic/convention/src/main/kotlin/dqxn.android.application.gradle.kts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Lint HardcodedText escalation + hardcoded text verification test</name>
  <files>
    android/build-logic/convention/src/main/kotlin/dqxn.android.library.gradle.kts
    android/build-logic/convention/src/main/kotlin/dqxn.android.application.gradle.kts
    android/app/src/test/kotlin/app/dqxn/android/app/localization/HardcodedTextLintTest.kt
  </files>
  <action>
    1. **Convention plugin lint config**: In both `dqxn.android.library.gradle.kts` and `dqxn.android.application.gradle.kts`, inside the `android { lint { } }` block, add:
       ```kotlin
       error.add("HardcodedText")
       ```
       This elevates Android lint's built-in `HardcodedText` check from warning to error. Any `Text("hardcoded string")` in Compose or `android:text="hardcoded"` in XML will break the build.

       Check what lint config already exists in these convention plugins before adding. If there's already a `lint { }` block, add to it. If not, create one.

    2. **HardcodedTextLintTest** (JUnit5):
       - This is a CI-gate validation test: run `./gradlew lintDebug` and verify it succeeds with zero `HardcodedText` errors.
       - Implementation: Parse the lint report XML/HTML to confirm no HardcodedText errors.
       - PREFERRED simpler approach: Just verify the convention plugin config exists. Parse the convention plugin `.gradle.kts` file as text and assert it contains `error.add("HardcodedText")` or equivalent. This is a "guard test" -- ensures the lint gate stays configured.
       - Also do a grep-based secondary check: search for `Text("` patterns in Compose source files that aren't using `stringResource()`. This catches cases lint might miss (e.g., strings passed through intermediate variables).
       - Grep target directories: `feature/*/src/main/`, `app/src/main/`, `pack/*/src/main/`, `core/*/src/main/`
       - Pattern: in `@Composable` functions, `Text("` without `stringResource` nearby. This is a heuristic, not exhaustive -- the lint gate is the primary enforcement.
       - NOTE: Some `Text()` calls legitimately use hardcoded strings in test files or internal-only debug overlays. Exclude test sources and debug source sets from the grep check.
  </action>
  <verify>
    <automated>cd android && ./gradlew :app:lintDebug --console=plain 2>&1 | tail -10</automated>
  </verify>
  <done>HardcodedText lint check elevated to error severity in convention plugins. Lint passes (no hardcoded text violations in production source). Guard test verifies lint config persists.</done>
</task>

<task type="auto">
  <name>Task 2: Locale-aware formatting verification for essentials pack renderers</name>
  <files>
    android/pack/essentials/src/test/kotlin/app/dqxn/android/pack/essentials/localization/LocaleFormattingTest.kt
  </files>
  <action>
    1. **LocaleFormattingTest** (JUnit5):
       - Verify essentials pack renderers use locale-aware formatting:
       - **Number formatting**: Speed values, battery percentages, and other numeric displays should use `NumberFormat` or `String.format(Locale, ...)`, NOT raw `toString()` or hardcoded format strings.
       - **Date formatting**: Clock and date widgets should use `DateTimeFormatter` with locale, NOT `SimpleDateFormat` with hardcoded patterns.
       - Test approach: Parse essentials pack renderer source files and verify formatting patterns:
         - Grep for `NumberFormat.getInstance()` or `String.format(Locale` usage
         - Verify NO `"%.0f"` without `Locale` parameter (non-locale-aware format)
         - Verify NO `SimpleDateFormat` without `Locale` parameter
       - Alternative test approach: Call formatting utility methods from pack renderers (if they expose them) with different Locale settings and verify output format changes appropriately. For example:
         - Set `Locale.setDefault(Locale.GERMANY)` -> format speed 100.5 -> expect "100,5" (comma decimal)
         - Set `Locale.setDefault(Locale.US)` -> format speed 100.5 -> expect "100.5" (period decimal)
       - If renderers don't expose formatting utilities directly, use the source-parsing approach.
       - Check key renderer files: `SpeedometerRenderer.kt`, `BatteryInfoRenderer.kt`, `ClockDigitalRenderer.kt`, `DateSimpleRenderer.kt`
  </action>
  <verify>
    <automated>cd android && ./gradlew :pack:essentials:testDebugUnitTest --tests "*.LocaleFormattingTest" --console=plain 2>&1 | tail -5</automated>
  </verify>
  <done>Locale-aware formatting verified for essentials pack renderers. Number and date formatting uses Locale-aware APIs. Test passes.</done>
</task>

</tasks>

<verification>
- `cd android && ./gradlew lintDebug --console=plain` -- zero HardcodedText errors across all modules
- `cd android && ./gradlew :app:testDebugUnitTest --tests "*.HardcodedTextLintTest" --console=plain` -- guard test passes
- `cd android && ./gradlew :pack:essentials:testDebugUnitTest --tests "*.LocaleFormattingTest" --console=plain` -- locale test passes
</verification>

<success_criteria>
- HardcodedText lint check is error-severity in all Android modules via convention plugins
- No hardcoded user-facing text in production Compose source files
- Essentials pack renderers use locale-aware formatting for numbers and dates
- All tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/13-e2e-integration-launch-polish/13-06-SUMMARY.md`
</output>
