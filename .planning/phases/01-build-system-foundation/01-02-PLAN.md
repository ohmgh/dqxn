---
phase: 01-build-system-foundation
plan: 02
type: execute
wave: 2
depends_on:
  - "01-01"
files_modified:
  - android/settings.gradle.kts
  - android/sdk/contracts/build.gradle.kts
  - android/sdk/common/build.gradle.kts
  - android/sdk/ui/build.gradle.kts
  - android/sdk/observability/build.gradle.kts
  - android/sdk/analytics/build.gradle.kts
  - android/core/design/build.gradle.kts
  - android/core/thermal/build.gradle.kts
  - android/core/firebase/build.gradle.kts
  - android/core/agentic/build.gradle.kts
  - android/codegen/plugin/build.gradle.kts
  - android/codegen/agentic/build.gradle.kts
  - android/data/build.gradle.kts
  - android/feature/dashboard/build.gradle.kts
  - android/feature/settings/build.gradle.kts
  - android/feature/diagnostics/build.gradle.kts
  - android/feature/onboarding/build.gradle.kts
  - android/pack/essentials/build.gradle.kts
  - android/pack/essentials/snapshots/build.gradle.kts
  - android/pack/plus/build.gradle.kts
  - android/pack/themes/build.gradle.kts
  - android/pack/demo/build.gradle.kts
  - android/app/build.gradle.kts
  - android/lint-rules/build.gradle.kts
  - android/baselineprofile/build.gradle.kts
  - android/benchmark/build.gradle.kts
  - android/.editorconfig
  - android/.gitignore
  - android/.githooks/pre-commit
  - android/sdk/common/compose_compiler_config.txt
autonomous: true
requirements:
  - NF27
  - NF28

must_haves:
  truths:
    - "settings.gradle.kts includes every module in the module map and is stable across all phases"
    - "Every stub module applies its correct convention plugin and parses without error"
    - "Pack stubs auto-wire all :sdk:* dependencies via dqxn.pack plugin"
    - "Spotless formatting check passes on all stub files"
    - "Gradle resolves all tasks across all modules"
  artifacts:
    - path: "android/settings.gradle.kts"
      provides: "Complete module include graph stable from Phase 1 onward"
      contains: "include("
    - path: "android/pack/essentials/build.gradle.kts"
      provides: "Pack stub applying dqxn.pack convention plugin"
      contains: "dqxn.pack"
    - path: "android/pack/essentials/snapshots/build.gradle.kts"
      provides: "Snapshot sub-module stub applying dqxn.snapshot convention plugin"
      contains: "dqxn.snapshot"
    - path: "android/app/build.gradle.kts"
      provides: "Application module stub with pack dependencies"
      contains: "dqxn.android.application"
    - path: "android/.editorconfig"
      provides: "Editor formatting configuration aligned with ktfmt Google style"
  key_links:
    - from: "android/settings.gradle.kts"
      to: "android/build-logic/"
      via: "includeBuild for convention plugin resolution"
      pattern: "includeBuild.*build-logic"
    - from: "android/pack/essentials/build.gradle.kts"
      to: "android/sdk/*/build.gradle.kts"
      via: "dqxn.pack auto-wires :sdk:* implementation dependencies"
      pattern: "dqxn\\.pack"
---

<objective>
Create settings.gradle.kts with all module includes, stub build.gradle.kts for every module in the module map, Spotless/ktfmt formatting integration, and editor configuration. After this plan, `settings.gradle.kts` is stable — no subsequent phase modifies it.

Purpose: All module stubs exist so `./gradlew tasks` validates plugin resolution against real targets. Pack dependency auto-wiring is testable. Formatting enforced from day one.
Output: Complete module skeleton. Spotless + .editorconfig + pre-commit hook.
</objective>

<execution_context>
@/Users/ohm/.claude/get-shit-done/workflows/execute-plan.md
@/Users/ohm/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/migration/phase-01.md
@.planning/phases/01-build-system-foundation/01-01-SUMMARY.md
@CLAUDE.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create settings.gradle.kts, sdk/core/codegen/data stubs, and project scaffolding</name>
  <files>
    android/settings.gradle.kts
    android/sdk/contracts/build.gradle.kts
    android/sdk/common/build.gradle.kts
    android/sdk/ui/build.gradle.kts
    android/sdk/observability/build.gradle.kts
    android/sdk/analytics/build.gradle.kts
    android/core/design/build.gradle.kts
    android/core/thermal/build.gradle.kts
    android/core/firebase/build.gradle.kts
    android/core/agentic/build.gradle.kts
    android/codegen/plugin/build.gradle.kts
    android/codegen/agentic/build.gradle.kts
    android/data/build.gradle.kts
    android/sdk/common/compose_compiler_config.txt
    android/.gitignore
  </files>
  <action>
    1. Create `android/settings.gradle.kts`:
       - `pluginManagement { repositories { google(); mavenCentral(); gradlePluginPortal() } }`
       - `dependencyResolutionManagement { repositoriesMode = RepositoriesMode.FAIL_ON_PROJECT_REPOS; repositories { google(); mavenCentral() } }`
       - `rootProject.name = "dqxn"`
       - `includeBuild("build-logic")`
       - Include ALL modules from the module map:
         ```
         include(":sdk:contracts")
         include(":sdk:common")
         include(":sdk:ui")
         include(":sdk:observability")
         include(":sdk:analytics")
         include(":core:design")
         include(":core:thermal")
         include(":core:firebase")
         include(":core:agentic")
         include(":codegen:plugin")
         include(":codegen:agentic")
         include(":data")
         include(":feature:dashboard")
         include(":feature:settings")
         include(":feature:diagnostics")
         include(":feature:onboarding")
         include(":pack:essentials")
         include(":pack:essentials:snapshots")
         include(":pack:plus")
         include(":pack:themes")
         include(":pack:demo")
         include(":app")
         include(":lint-rules")
         include(":baselineprofile")
         include(":benchmark")
         ```

    2. Create stub `build.gradle.kts` for sdk, core, codegen, and data modules. Each stub contains only the convention plugin application and namespace. No source files yet (those arrive in later phases).

       **Convention plugin assignments:**
       - `:sdk:contracts` → `dqxn.android.library` (no Compose compiler — compileOnly compose.runtime added manually in Phase 2)
       - `:sdk:common` → `dqxn.android.library` + `dqxn.android.hilt` + `dqxn.android.test`
       - `:sdk:ui` → `dqxn.android.library` + `dqxn.android.compose` + `dqxn.android.test`
       - `:sdk:observability` → `dqxn.android.library` + `dqxn.android.test`
       - `:sdk:analytics` → `dqxn.android.library` + `dqxn.android.test`
       - `:core:design` → `dqxn.android.library` + `dqxn.android.compose` + `dqxn.android.test`
       - `:core:thermal` → `dqxn.android.library` + `dqxn.android.test`
       - `:core:firebase` → `dqxn.android.library` + `dqxn.android.test`
       - `:core:agentic` → `dqxn.android.library` + `dqxn.android.hilt` + `dqxn.android.test`
       - `:codegen:plugin` → `dqxn.kotlin.jvm` (pure JVM, KSP processor)
       - `:codegen:agentic` → `dqxn.kotlin.jvm` (pure JVM, KSP processor)
       - `:data` → `dqxn.android.library` + `dqxn.android.hilt` + `dqxn.android.test`

       **Namespace pattern:** `android { namespace = "app.dqxn.android.{module.path}" }` where module path uses dots. Examples:
       - `:sdk:contracts` → `app.dqxn.android.sdk.contracts`
       - `:codegen:plugin` → no namespace (JVM module)
       - `:codegen:agentic` → no namespace (JVM module)

       Each Android module stub needs an empty `src/main/AndroidManifest.xml` with just `<manifest />`.

    3. Create `android/sdk/common/compose_compiler_config.txt` — empty placeholder file. Will be populated in Phase 3 with stability configurations.

    4. Create `android/.gitignore` — standard Android gitignore (build/, .gradle/, local.properties, *.apk, etc.)
  </action>
  <verify>
    <automated>cd android && ./gradlew :sdk:contracts:tasks :core:design:tasks :codegen:plugin:tasks :data:tasks --console=plain 2>&amp;1 | tail -10</automated>
    <manual>Verify 12 module stubs exist (5 sdk + 4 core + 2 codegen + 1 data) with correct convention plugins</manual>
  </verify>
  <done>settings.gradle.kts includes all 25 modules. All sdk, core, codegen, and data stubs parse and apply their convention plugins. .gitignore and compose_compiler_config.txt placeholder exist.</done>
</task>

<task type="auto">
  <name>Task 2: Create feature, pack, app, and support module stubs</name>
  <files>
    android/feature/dashboard/build.gradle.kts
    android/feature/settings/build.gradle.kts
    android/feature/diagnostics/build.gradle.kts
    android/feature/onboarding/build.gradle.kts
    android/pack/essentials/build.gradle.kts
    android/pack/essentials/snapshots/build.gradle.kts
    android/pack/plus/build.gradle.kts
    android/pack/themes/build.gradle.kts
    android/pack/demo/build.gradle.kts
    android/app/build.gradle.kts
    android/lint-rules/build.gradle.kts
    android/baselineprofile/build.gradle.kts
    android/benchmark/build.gradle.kts
  </files>
  <action>
    1. Create stub `build.gradle.kts` for feature, pack, app, and support modules. Each stub contains only the convention plugin application and namespace.

       **Convention plugin assignments:**
       - `:feature:dashboard` → `dqxn.android.feature` (includes library+compose+hilt+test)
       - `:feature:settings` → `dqxn.android.feature`
       - `:feature:diagnostics` → `dqxn.android.feature`
       - `:feature:onboarding` → `dqxn.android.feature`
       - `:pack:essentials` → `dqxn.pack` (includes library+compose+hilt+test+ksp+serialization+sdk deps)
       - `:pack:essentials:snapshots` → `dqxn.snapshot` (android library + api(:sdk:contracts) only)
       - `:pack:plus` → `dqxn.pack`
       - `:pack:themes` → `dqxn.pack`
       - `:pack:demo` → `dqxn.pack`
       - `:app` → `dqxn.android.application` + `dqxn.android.hilt` + `dqxn.android.test`
       - `:lint-rules` → `dqxn.kotlin.jvm` (lint rules are pure JVM). Add `compileOnly(libs.lint.api)` and `testImplementation(libs.lint.tests)` manually.
       - `:baselineprofile` → Needs `com.android.test` + `androidx.baselineprofile`. Stub with just `com.android.test` for now.
       - `:benchmark` → Needs `com.android.library` + `androidx.benchmark.macro.junit`. Stub with `dqxn.android.library` for now.

       **Namespace pattern:** `android { namespace = "app.dqxn.android.{module.path}" }` where module path uses dots. Examples:
       - `:pack:essentials:snapshots` → `app.dqxn.android.pack.essentials.snapshots`
       - `:feature:dashboard` → `app.dqxn.android.feature.dashboard`
       - `:app` → `app.dqxn.android` (application module, set in applicationId too)
       - `:lint-rules` → no namespace (JVM module)

       Each Android module stub needs an empty `src/main/AndroidManifest.xml` with just `<manifest />`.

    2. **`:app` stub specifics:**
       - Apply `dqxn.android.application`, `dqxn.android.hilt`, `dqxn.android.test`
       - Add `applicationId = "app.dqxn.android"` (debug) / `app.dqxn.android.debug` suffix later
       - Add `implementation(project(":pack:essentials"))` — initial pack dependency (others added as packs are implemented)
       - Add `implementation(project(":feature:dashboard"))`, etc. — wire all feature modules
       - Add `implementation(project(":core:firebase"))`, `implementation(project(":data"))`
       - Add `implementation(project(":sdk:observability"))`, `implementation(project(":sdk:analytics"))`, `implementation(project(":sdk:ui"))`
  </action>
  <verify>
    <automated>cd android && ./gradlew tasks --console=plain 2>&amp;1 | tail -10</automated>
    <manual>Count module stubs — should be 25 modules total (including lint-rules, baselineprofile, benchmark)</manual>
  </verify>
  <done>All 25 modules parse and apply their convention plugins. `./gradlew tasks` succeeds. Pack stubs auto-wire all :sdk:* dependencies via dqxn.pack plugin. settings.gradle.kts is stable — no subsequent phase modifies it.</done>
</task>

<task type="auto">
  <name>Task 3: Configure Spotless formatting, .editorconfig, and pre-commit hook</name>
  <files>
    android/.editorconfig
    android/.githooks/pre-commit
  </files>
  <action>
    1. Create `android/.editorconfig`:
       ```ini
       root = true

       [*]
       charset = utf-8
       end_of_line = lf
       insert_final_newline = true
       trim_trailing_whitespace = true
       indent_style = space
       indent_size = 4

       [*.{kt,kts}]
       indent_size = 4
       max_line_length = 120

       [*.{xml,json,toml,yaml,yml}]
       indent_size = 2

       [*.md]
       trim_trailing_whitespace = false

       [*.proto]
       indent_size = 2
       ```

    2. Add Spotless configuration to the ROOT `android/build.gradle.kts` (already created in Plan 01):
       - Apply `com.diffplug.spotless` plugin
       - Configure `spotless { kotlin { target("**/*.kt"); targetExclude("**/build/**"); ktfmt().googleStyle() } kotlinGradle { target("**/*.kts"); targetExclude("**/build/**"); ktfmt().googleStyle() } }`
       - Use `ktfmt()` without explicit version to let Spotless choose its bundled compatible version (avoids ktfmt 0.57 breaking API issue)

    3. Create `android/.githooks/pre-commit`:
       ```bash
       #!/bin/sh
       # Pre-commit hook: formatting + basic boundary checks
       cd "$(git rev-parse --show-toplevel)/android" || exit 0

       echo "Running Spotless check..."
       ./gradlew spotlessCheck --console=plain --warning-mode=summary || exit 1

       echo "Checking for kapt usage..."
       if grep -r "kapt" --include="*.kts" */build.gradle.kts 2>/dev/null; then
           echo "ERROR: kapt detected in build files. Use ksp instead."
           exit 1
       fi

       echo "Checking for pack→dashboard boundary violation..."
       if grep -r "feature.dashboard" pack/ 2>/dev/null; then
           echo "ERROR: Pack module imports from :feature:dashboard"
           exit 1
       fi
       ```
       Make it executable: `chmod +x android/.githooks/pre-commit`

    4. Configure git hooks path. Add to project README or document: `git config core.hooksPath android/.githooks`
       Alternatively, add a Gradle task in root build.gradle.kts that sets this up on first sync.
  </action>
  <verify>
    <automated>cd android && ./gradlew spotlessCheck --console=plain 2>&amp;1 | tail -5</automated>
    <manual>Verify .editorconfig exists with correct settings and pre-commit hook is executable</manual>
  </verify>
  <done>Spotless with ktfmt Google style configured. .editorconfig matches ktfmt conventions. Pre-commit hook checks formatting, kapt usage, and pack boundary violations. `./gradlew spotlessCheck` passes on all stub files.</done>
</task>

</tasks>

<verification>
1. `cd android && ./gradlew tasks --console=plain` succeeds — all modules parse, all plugins resolve
2. `cd android && ./gradlew :pack:essentials:dependencies --configuration debugCompileClasspath --console=plain` shows all `:sdk:*` modules
3. `cd android && ./gradlew spotlessCheck --console=plain` passes
4. Module count: 25 modules in settings.gradle.kts
5. Every stub has correct convention plugin and namespace
</verification>

<success_criteria>
- `./gradlew tasks` succeeds with all 25 modules resolved
- Pack stubs show `:sdk:contracts`, `:sdk:common`, `:sdk:ui`, `:sdk:observability`, `:sdk:analytics` in dependency graph
- Spotless check passes
- .editorconfig and pre-commit hook exist and are correctly configured
- settings.gradle.kts is complete and stable (no modifications needed in later phases)
</success_criteria>

<output>
After completion, create `.planning/phases/01-build-system-foundation/01-02-SUMMARY.md`
</output>
