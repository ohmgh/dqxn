---
phase: 09-themes-demo-chaos
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - android/pack/essentials/snapshots/src/main/kotlin/app/dqxn/android/pack/essentials/snapshots/SolarSnapshot.kt
  - android/pack/essentials/snapshots/src/main/kotlin/app/dqxn/android/pack/essentials/snapshots/SpeedLimitSnapshot.kt
  - android/pack/essentials/src/main/kotlin/app/dqxn/android/pack/essentials/snapshots/SolarSnapshot.kt
  - android/pack/essentials/src/main/kotlin/app/dqxn/android/pack/essentials/snapshots/SpeedLimitSnapshot.kt
  - android/pack/demo/build.gradle.kts
  - android/pack/demo/src/main/kotlin/app/dqxn/android/pack/demo/providers/DemoTimeProvider.kt
  - android/pack/demo/src/main/kotlin/app/dqxn/android/pack/demo/providers/DemoSpeedProvider.kt
  - android/pack/demo/src/main/kotlin/app/dqxn/android/pack/demo/providers/DemoOrientationProvider.kt
  - android/pack/demo/src/main/kotlin/app/dqxn/android/pack/demo/providers/DemoBatteryProvider.kt
  - android/pack/demo/src/test/kotlin/app/dqxn/android/pack/demo/providers/DemoTimeProviderContractTest.kt
  - android/pack/demo/src/test/kotlin/app/dqxn/android/pack/demo/providers/DemoSpeedProviderContractTest.kt
  - android/pack/demo/src/test/kotlin/app/dqxn/android/pack/demo/providers/DemoOrientationProviderContractTest.kt
  - android/pack/demo/src/test/kotlin/app/dqxn/android/pack/demo/providers/DemoBatteryProviderContractTest.kt
autonomous: true
requirements: [F13.1]

must_haves:
  truths:
    - "SolarSnapshot and SpeedLimitSnapshot are cross-boundary in :pack:essentials:snapshots"
    - "4 demo providers (Time, Speed, Orientation, Battery) emit deterministic data"
    - "All demo providers use ProviderPriority.SIMULATED"
    - "Same tick produces same output (no randomness)"
    - "First 4 demo providers pass DataProviderContractTest"
  artifacts:
    - path: "android/pack/essentials/snapshots/src/main/kotlin/app/dqxn/android/pack/essentials/snapshots/SolarSnapshot.kt"
      provides: "Cross-boundary SolarSnapshot"
      contains: "@DashboardSnapshot"
    - path: "android/pack/essentials/snapshots/src/main/kotlin/app/dqxn/android/pack/essentials/snapshots/SpeedLimitSnapshot.kt"
      provides: "Cross-boundary SpeedLimitSnapshot"
      contains: "@DashboardSnapshot"
    - path: "android/pack/demo/src/main/kotlin/app/dqxn/android/pack/demo/providers/DemoTimeProvider.kt"
      provides: "Deterministic time provider"
      contains: "SIMULATED"
    - path: "android/pack/demo/src/main/kotlin/app/dqxn/android/pack/demo/providers/DemoSpeedProvider.kt"
      provides: "Deterministic speed provider"
      contains: "SIMULATED"
  key_links:
    - from: "DemoSpeedProvider"
      to: "SpeedSnapshot"
      via: "DataProvider<SpeedSnapshot>"
      pattern: "DataProvider<SpeedSnapshot>"
    - from: ":pack:demo build.gradle.kts"
      to: ":pack:essentials:snapshots"
      via: "implementation(project)"
      pattern: "pack:essentials:snapshots"
---

<objective>
Move SolarSnapshot and SpeedLimitSnapshot to cross-boundary `:pack:essentials:snapshots` sub-module, then create the first 4 demo providers (Time, Speed, Orientation, Battery).

Purpose: Prerequisite snapshot relocation enables demo pack to import all 8 snapshot types. First batch of deterministic providers proves the pattern.

Output: 2 relocated snapshots, demo pack build config, 4 deterministic providers.
</objective>

<execution_context>
@/Users/ohm/.claude/get-shit-done/workflows/execute-plan.md
@/Users/ohm/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-themes-demo-chaos/09-RESEARCH.md
@android/pack/essentials/snapshots/src/main/kotlin/app/dqxn/android/pack/essentials/snapshots/TimeSnapshot.kt
@android/pack/essentials/snapshots/src/main/kotlin/app/dqxn/android/pack/essentials/snapshots/SpeedSnapshot.kt
@android/pack/essentials/src/main/kotlin/app/dqxn/android/pack/essentials/providers/TimeDataProvider.kt
@android/pack/essentials/build.gradle.kts
@android/pack/demo/build.gradle.kts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Relocate SolarSnapshot + SpeedLimitSnapshot to cross-boundary snapshots sub-module</name>
  <files>
    android/pack/essentials/snapshots/src/main/kotlin/app/dqxn/android/pack/essentials/snapshots/SolarSnapshot.kt
    android/pack/essentials/snapshots/src/main/kotlin/app/dqxn/android/pack/essentials/snapshots/SpeedLimitSnapshot.kt
    android/pack/essentials/src/main/kotlin/app/dqxn/android/pack/essentials/snapshots/SolarSnapshot.kt (delete)
    android/pack/essentials/src/main/kotlin/app/dqxn/android/pack/essentials/snapshots/SpeedLimitSnapshot.kt (delete)
  </files>
  <action>
    **Move** `SolarSnapshot.kt` and `SpeedLimitSnapshot.kt` from `:pack:essentials` main source set to `:pack:essentials:snapshots` sub-module.

    Current location (pack-local): `android/pack/essentials/src/main/kotlin/app/dqxn/android/pack/essentials/snapshots/`
    Target location (cross-boundary): `android/pack/essentials/snapshots/src/main/kotlin/app/dqxn/android/pack/essentials/snapshots/`

    The files keep the same package (`app.dqxn.android.pack.essentials.snapshots`) so no import changes needed in consumers within `:pack:essentials`. The `:pack:essentials` module already has `implementation(project(":pack:essentials:snapshots"))` in its build.gradle.kts, so the essentials pack will continue compiling.

    After moving:
    1. Delete the old files from the pack-local snapshots directory
    2. Verify `:pack:essentials` still compiles (import paths unchanged due to same package)
    3. Verify `:pack:essentials:snapshots` compiles with the 2 new files

    **Important:** The `:pack:essentials:snapshots` module uses the `dqxn.snapshot` plugin. Verify both files have `@DashboardSnapshot` and `@Immutable` annotations (they already do). No `@Composable` function bodies allowed in snapshot modules.
  </action>
  <verify>
    <automated>cd /Users/ohm/Workspace/dqxn/android && ./gradlew :pack:essentials:snapshots:compileDebugKotlin :pack:essentials:compileDebugKotlin --console=plain 2>&1 | tail -10</automated>
  </verify>
  <done>SolarSnapshot and SpeedLimitSnapshot are in :pack:essentials:snapshots (cross-boundary). Both essentials modules compile. No import changes needed.</done>
</task>

<task type="auto">
  <name>Task 2: Create demo pack build config + first 4 deterministic providers</name>
  <files>
    android/pack/demo/build.gradle.kts
    android/pack/demo/src/main/kotlin/app/dqxn/android/pack/demo/providers/DemoTimeProvider.kt
    android/pack/demo/src/main/kotlin/app/dqxn/android/pack/demo/providers/DemoSpeedProvider.kt
    android/pack/demo/src/main/kotlin/app/dqxn/android/pack/demo/providers/DemoOrientationProvider.kt
    android/pack/demo/src/main/kotlin/app/dqxn/android/pack/demo/providers/DemoBatteryProvider.kt
  </files>
  <action>
    **1. Update demo pack build.gradle.kts:**
    ```kotlin
    plugins { id("dqxn.pack") }
    android { namespace = "app.dqxn.android.pack.demo" }
    dependencies {
      implementation(project(":pack:essentials:snapshots"))
      testImplementation(testFixtures(project(":sdk:contracts")))
    }
    ```

    **2. Create 4 demo providers** in `android/pack/demo/src/main/kotlin/app/dqxn/android/pack/demo/providers/`. All must:
    - Use `@DashboardDataProvider` annotation with `localId = "demo-{type}"`, descriptive `displayName` and `description`
    - `@Singleton` + `@Inject constructor()`
    - `override val priority = ProviderPriority.SIMULATED`
    - `override val requiredAnyEntitlement: Set<String>? = null` (free)
    - `sourceId = "demo:{type}"`
    - `isAvailable = true`, `connectionState = flowOf(true)`, `connectionErrorDescription = flowOf(null)`
    - `setupSchema = emptyList()`
    - `subscriberTimeout = 2.seconds`, `firstEmissionTimeout = 3.seconds`
    - **Zero randomness** -- tick-based deterministic math only
    - Use `System.nanoTime()` for `timestamp` field (same as essentials providers)

    **DemoTimeProvider** — `dataType = DataTypes.TIME`, emits `TimeSnapshot`:
    - Tick every 1000ms (same as real TimeDataProvider)
    - `epochMillis = BASE_EPOCH + (tick * 1000L)` where BASE_EPOCH = `1735689600000L` (2025-01-01T00:00:00Z)
    - `zoneId = "Asia/Singapore"` (fixed)
    - Schema: fields `epochMillis` (Long, ms) + `zoneId` (String), stalenessThresholdMs = 2000L

    **DemoSpeedProvider** — `dataType = DataTypes.SPEED`, emits `SpeedSnapshot`:
    - Tick every 200ms
    - Triangle wave: `tick % 48`, phase < 24 = ramp up, phase >= 24 = ramp down
    - Peak speed: 140 km/h = ~38.9 m/s. `speedMps = (speedKmh / 3.6).toFloat()`
    - `accuracy = 1.0f`
    - Schema: fields `speedMps` (Float, m/s) + `accuracy` (Float), stalenessThresholdMs = 500L

    **DemoOrientationProvider** — `dataType = DataTypes.ORIENTATION`, emits `OrientationSnapshot`:
    - Tick every 500ms
    - Slow heading rotation: `heading = (tick * 5.0f) % 360.0f` (full circle in 36 seconds)
    - `pitch = 0f`, `roll = 0f`
    - Schema: fields heading/pitch/roll (Float, degrees), stalenessThresholdMs = 1000L

    **DemoBatteryProvider** — `dataType = DataTypes.BATTERY`, emits `BatterySnapshot`:
    - Tick every 5000ms (slow cycle)
    - Sawtooth drain: `levelPercent = 100 - (tick % 100)`
    - `isCharging = false`, `temperatureCelsius = 28.5f`
    - Schema: fields levelPercent/isCharging/temperatureCelsius, stalenessThresholdMs = 10000L

    All providers follow the exact `provideState(): Flow<T>` pattern:
    ```kotlin
    override fun provideState(): Flow<SpeedSnapshot> = flow {
      var tick = 0
      while (true) {
        emit(SpeedSnapshot(/* computed from tick */))
        delay(intervalMs)
        tick++
      }
    }
    ```
  </action>
  <verify>
    <automated>cd /Users/ohm/Workspace/dqxn/android && ./gradlew :pack:demo:compileDebugKotlin --console=plain 2>&1 | tail -5</automated>
  </verify>
  <done>Demo pack compiles with 4 providers. Each emits deterministic data from tick-based math. No randomness.</done>
</task>

<task type="auto">
  <name>Task 3: Contract tests for first 4 demo providers</name>
  <files>
    android/pack/demo/src/test/kotlin/app/dqxn/android/pack/demo/providers/DemoTimeProviderContractTest.kt
    android/pack/demo/src/test/kotlin/app/dqxn/android/pack/demo/providers/DemoSpeedProviderContractTest.kt
    android/pack/demo/src/test/kotlin/app/dqxn/android/pack/demo/providers/DemoOrientationProviderContractTest.kt
    android/pack/demo/src/test/kotlin/app/dqxn/android/pack/demo/providers/DemoBatteryProviderContractTest.kt
  </files>
  <action>
    Create 4 contract test classes -- each extends `DataProviderContractTest<T>` from `:sdk:contracts` testFixtures:
    ```kotlin
    class DemoTimeProviderContractTest : DataProviderContractTest<TimeSnapshot>() {
      override fun createProvider(): DataProvider<TimeSnapshot> = DemoTimeProvider()
    }
    ```
    Same pattern for: `DemoSpeedProviderContractTest`, `DemoOrientationProviderContractTest`, `DemoBatteryProviderContractTest`.

    Each contract test validates the 12 assertions from `DataProviderContractTest`: sourceId format, displayName non-empty, dataType matches, priority set, snapshotType correct, schema fields present, provideState emits, timestamp non-zero, etc.

    The `testImplementation(testFixtures(project(":sdk:contracts")))` dependency was added in Task 2's build.gradle.kts update.
  </action>
  <verify>
    <automated>cd /Users/ohm/Workspace/dqxn/android && ./gradlew :pack:demo:testDebugUnitTest --console=plain 2>&1 | tail -20</automated>
  </verify>
  <done>4 contract tests pass (12 assertions each = 48 total). All 4 providers validated against DataProviderContractTest base.</done>
</task>

</tasks>

<verification>
```bash
cd /Users/ohm/Workspace/dqxn/android && ./gradlew :pack:essentials:snapshots:compileDebugKotlin :pack:essentials:compileDebugKotlin :pack:demo:testDebugUnitTest --console=plain
```
All three modules compile. Snapshot relocation transparent to essentials pack. 4 contract tests pass.
</verification>

<success_criteria>
- SolarSnapshot + SpeedLimitSnapshot now in `:pack:essentials:snapshots`
- `:pack:essentials` still compiles with no import changes
- Demo pack has 4 deterministic providers that compile and pass contract tests
- All providers use ProviderPriority.SIMULATED
- No randomness in any provider
- 4 `DataProviderContractTest` subclasses all pass
</success_criteria>

<output>
After completion, create `.planning/phases/09-themes-demo-chaos/09-02-SUMMARY.md`
</output>
