---
phase: 09-themes-demo-chaos
plan: 06
type: execute
wave: 3
depends_on: [09-01, 09-02, 09-03, 09-04, 09-05]
files_modified:
  - android/app/build.gradle.kts
  - android/pack/essentials/src/test/kotlin/app/dqxn/android/pack/essentials/providers/SolarTimezoneDataProviderTest.kt
  - android/pack/essentials/src/test/kotlin/app/dqxn/android/pack/essentials/providers/SolarLocationDataProviderTest.kt
  - android/pack/essentials/src/test/kotlin/app/dqxn/android/pack/essentials/providers/SpeedLimitProviderTest.kt
autonomous: true
requirements: [F6.1, F13.1]

must_haves:
  truths:
    - ":app compiles with :pack:themes and :pack:demo in dependency graph"
    - "All Phase 2-8 tests pass with new packs in dependency graph"
    - "Essentials pack tests pass after snapshot relocation"
    - ":pack:themes compiles into :app dependency graph (Hilt @IntoSet bindings generate successfully)"
    - ":pack:demo compiles into :app dependency graph (Hilt @IntoSet bindings generate successfully)"
  artifacts:
    - path: "android/app/build.gradle.kts"
      provides: "App module with :pack:themes and :pack:demo dependencies"
      contains: "pack:themes"
  key_links:
    - from: ":app build.gradle.kts"
      to: ":pack:themes"
      via: "implementation(project)"
      pattern: "pack:themes"
    - from: ":app build.gradle.kts"
      to: ":pack:demo"
      via: "implementation(project)"
      pattern: "pack:demo"
---

<objective>
Wire themes and demo packs into :app, fix any test breakages from snapshot relocation, run regression gate.

Purpose: Ensures new packs integrate cleanly into the app dependency graph. The snapshot relocation from Plan 02 may break import paths in essentials pack tests that reference SolarSnapshot/SpeedLimitSnapshot from the old pack-local location. This plan fixes any such breakages and validates the full test suite.

Output: App compiles with both new packs, all existing tests pass.
</objective>

<execution_context>
@/Users/ohm/.claude/get-shit-done/workflows/execute-plan.md
@/Users/ohm/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-themes-demo-chaos/09-01-SUMMARY.md
@.planning/phases/09-themes-demo-chaos/09-02-SUMMARY.md
@.planning/phases/09-themes-demo-chaos/09-03-SUMMARY.md
@.planning/phases/09-themes-demo-chaos/09-04-SUMMARY.md
@.planning/phases/09-themes-demo-chaos/09-05-SUMMARY.md
@android/app/build.gradle.kts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Wire packs into :app + fix snapshot relocation breakages</name>
  <files>
    android/app/build.gradle.kts
  </files>
  <action>
    **1. Add pack dependencies to :app build.gradle.kts:**
    In the `// Pack modules` section, add:
    ```kotlin
    implementation(project(":pack:themes"))
    implementation(project(":pack:demo"))
    ```

    **2. Verify essentials pack tests** — after snapshot relocation in Plan 02, tests that import `SolarSnapshot` or `SpeedLimitSnapshot` should still compile because the package name is unchanged (`app.dqxn.android.pack.essentials.snapshots`). However, if any test files have direct file-path references or use reflection that depends on the source location, they may break.

    Run `:pack:essentials:testDebugUnitTest` first. If tests fail with import/resolution errors for `SolarSnapshot` or `SpeedLimitSnapshot`, the issue is likely:
    - Test files in `:pack:essentials` that imported from the pack-local path — since the package is the same, this should be transparent. But verify.
    - If the snapshots sub-module is a dependency of the test classpath, the relocated files should be on the classpath. Verify `implementation(project(":pack:essentials:snapshots"))` is in the essentials build.gradle.kts.

    **3. Run compile check** for the full app:
    ```bash
    ./gradlew :app:compileDebugKotlin --console=plain
    ```

    This validates:
    - KSP processes `@DashboardDataProvider` annotations in `:pack:demo` (generates Hilt modules)
    - KSP processes any annotations in `:pack:themes`
    - Hilt component generation succeeds with the new multibinding entries
    - No duplicate binding conflicts between packs
  </action>
  <verify>
    <automated>cd /Users/ohm/Workspace/dqxn/android && ./gradlew :app:compileDebugKotlin :pack:essentials:testDebugUnitTest --console=plain 2>&1 | tail -20</automated>
  </verify>
  <done>:app compiles with :pack:themes and :pack:demo. Essentials pack tests pass after snapshot relocation.</done>
</task>

<task type="auto">
  <name>Task 2: Full regression gate</name>
  <files>(no new files — verification only)</files>
  <action>
    Run the full test suite to verify no regressions from Phase 9 changes:

    ```bash
    cd /Users/ohm/Workspace/dqxn/android && ./gradlew test --console=plain
    ```

    This covers:
    - All Phase 2-8 existing tests (SDK contracts, observability, KSP, core, dashboard shell, essentials pack)
    - Phase 9 new tests (themes validation, demo contract tests, chaos interceptor, chaos engine, handlers, entitlement manager)
    - Lint rules still enforcing pack boundaries (themes/demo packs must not import :core:* or :feature:*)

    If any test fails:
    - Fix the root cause (likely import path changes from snapshot relocation, or Hilt binding conflicts)
    - Do NOT skip or disable tests
    - Re-run until all green

    **Expected test count:** Previous phases had ~200+ tests. Phase 9 adds ~50+ new tests (22 JSON validation, 8 contract, 10+ determinism, 11+ interceptor, 10+ engine, 10+ handlers, 10+ entitlement). Total should be ~250+.
  </action>
  <verify>
    <automated>cd /Users/ohm/Workspace/dqxn/android && ./gradlew test --console=plain 2>&1 | tail -30</automated>
  </verify>
  <done>All tests pass. Zero regressions from Phase 9 additions. Both new packs compile and integrate cleanly.</done>
</task>

</tasks>

<verification>
```bash
cd /Users/ohm/Workspace/dqxn/android && ./gradlew test --console=plain
```
Full test suite green. No regressions.
</verification>

<success_criteria>
- `./gradlew test` passes with zero failures
- `:app:compileDebugKotlin` succeeds with both new packs
- No lint boundary violations in themes or demo packs
- Essentials pack tests unaffected by snapshot relocation
</success_criteria>

<output>
After completion, create `.planning/phases/09-themes-demo-chaos/09-06-SUMMARY.md`
</output>
