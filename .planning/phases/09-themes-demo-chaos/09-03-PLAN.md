---
phase: 09-themes-demo-chaos
plan: 03
type: execute
wave: 2
depends_on: [09-02]
files_modified:
  - android/pack/demo/src/main/kotlin/app/dqxn/android/pack/demo/providers/DemoAmbientLightProvider.kt
  - android/pack/demo/src/main/kotlin/app/dqxn/android/pack/demo/providers/DemoAccelerationProvider.kt
  - android/pack/demo/src/main/kotlin/app/dqxn/android/pack/demo/providers/DemoSolarProvider.kt
  - android/pack/demo/src/main/kotlin/app/dqxn/android/pack/demo/providers/DemoSpeedLimitProvider.kt
  - android/pack/demo/src/test/kotlin/app/dqxn/android/pack/demo/providers/DemoAmbientLightProviderContractTest.kt
  - android/pack/demo/src/test/kotlin/app/dqxn/android/pack/demo/providers/DemoAccelerationProviderContractTest.kt
  - android/pack/demo/src/test/kotlin/app/dqxn/android/pack/demo/providers/DemoSolarProviderContractTest.kt
  - android/pack/demo/src/test/kotlin/app/dqxn/android/pack/demo/providers/DemoSpeedLimitProviderContractTest.kt
  - android/pack/demo/src/test/kotlin/app/dqxn/android/pack/demo/providers/DemoDeterminismTest.kt
autonomous: true
requirements: [F13.1]

must_haves:
  truths:
    - "Remaining 4 demo providers pass DataProviderContractTest (first 4 tested in Plan 02)"
    - "All 8 providers emit deterministic data (same tick = same output)"
    - "All 8 providers use ProviderPriority.SIMULATED"
    - "Demo providers produce realistic data ranges"
  artifacts:
    - path: "android/pack/demo/src/main/kotlin/app/dqxn/android/pack/demo/providers/DemoSolarProvider.kt"
      provides: "Deterministic solar provider"
      contains: "SIMULATED"
    - path: "android/pack/demo/src/main/kotlin/app/dqxn/android/pack/demo/providers/DemoSpeedLimitProvider.kt"
      provides: "Deterministic speed limit provider"
      contains: "SIMULATED"
    - path: "android/pack/demo/src/test/kotlin/app/dqxn/android/pack/demo/providers/DemoDeterminismTest.kt"
      provides: "Determinism verification: same tick = same output"
  key_links:
    - from: "DemoSolarProvider"
      to: "SolarSnapshot"
      via: "DataProvider<SolarSnapshot>"
      pattern: "DataProvider<SolarSnapshot>"
    - from: "Demo*ContractTest"
      to: "DataProviderContractTest"
      via: "extends contract base"
      pattern: "DataProviderContractTest"
---

<objective>
Create remaining 4 demo providers (AmbientLight, Acceleration, Solar, SpeedLimit), their 4 contract tests, and determinism verification for all 8 providers.

Purpose: Completes F13.1 (demo pack with simulated providers for all data types). Contract tests for the remaining 4 providers validate against DataProviderContractTest base (first 4 tested in Plan 02). Determinism test proves reproducibility across all 8.

Output: 4 new providers, 4 contract tests, 1 determinism test covering all 8 providers.
</objective>

<execution_context>
@/Users/ohm/.claude/get-shit-done/workflows/execute-plan.md
@/Users/ohm/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-themes-demo-chaos/09-RESEARCH.md
@.planning/phases/09-themes-demo-chaos/09-02-SUMMARY.md
@android/pack/essentials/snapshots/src/main/kotlin/app/dqxn/android/pack/essentials/snapshots/AmbientLightSnapshot.kt
@android/pack/essentials/snapshots/src/main/kotlin/app/dqxn/android/pack/essentials/snapshots/AccelerationSnapshot.kt
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create remaining 4 demo providers</name>
  <files>
    android/pack/demo/src/main/kotlin/app/dqxn/android/pack/demo/providers/DemoAmbientLightProvider.kt
    android/pack/demo/src/main/kotlin/app/dqxn/android/pack/demo/providers/DemoAccelerationProvider.kt
    android/pack/demo/src/main/kotlin/app/dqxn/android/pack/demo/providers/DemoSolarProvider.kt
    android/pack/demo/src/main/kotlin/app/dqxn/android/pack/demo/providers/DemoSpeedLimitProvider.kt
  </files>
  <action>
    Create 4 providers following the same pattern established in Plan 02 Task 2. All must:
    - `@DashboardDataProvider`, `@Singleton`, `@Inject constructor()`
    - `ProviderPriority.SIMULATED`, `requiredAnyEntitlement = null`
    - `sourceId = "demo:{type}"`, tick-based deterministic math, `System.nanoTime()` for timestamp

    **DemoAmbientLightProvider** — `dataType = DataTypes.AMBIENT_LIGHT`, emits `AmbientLightSnapshot`:
    - Tick every 2000ms
    - Sine wave simulating day/night: `lux = 500.0f + 499.0f * sin(tick * PI / 30).toFloat()`
    - Full cycle: 60 ticks = 120 seconds (2 min day-night cycle)
    - Schema: fields `lux` (Float, lx), stalenessThresholdMs = 4000L

    **DemoAccelerationProvider** — `dataType = DataTypes.ACCELERATION`, emits `AccelerationSnapshot`:
    - Tick every 200ms (matches speed cadence)
    - Lateral G: gentle sway `lateralG = 0.3f * sin(tick * PI / 24).toFloat()`
    - Longitudinal G: derived from speed delta (triangle wave acceleration/deceleration)
      - `longitudinalG = if (tick % 48 < 24) 0.15f else -0.15f`
    - Schema: fields lateralG/longitudinalG (Float, G), stalenessThresholdMs = 500L

    **DemoSolarProvider** — `dataType = DataTypes.SOLAR`, emits `SolarSnapshot`:
    - Tick every 30000ms (30s, solar data is slow)
    - Fixed Singapore coordinates: sunrise ~6:45 AM, sunset ~7:10 PM SGT
    - `sunriseEpochMillis = BASE_EPOCH + 24_300_000L` (06:45 SGT = midnight UTC + 6h45m = 24300000ms)
    - `sunsetEpochMillis = BASE_EPOCH + 68_400_000L` (19:00 SGT)
    - `solarNoonEpochMillis = BASE_EPOCH + 46_350_000L` (12:52 SGT)
    - `isDaytime = true` (fixed for demo)
    - `sourceMode = "simulated"`
    - Schema: fields sunriseEpochMillis/sunsetEpochMillis/solarNoonEpochMillis/isDaytime/sourceMode, stalenessThresholdMs = 60000L

    **DemoSpeedLimitProvider** — `dataType = DataTypes.SPEED_LIMIT`, emits `SpeedLimitSnapshot`:
    - Tick every 10000ms (10s, speed limits change infrequently)
    - Cycling through common limits: `LIMITS = floatArrayOf(50f, 60f, 80f, 90f, 110f)`
    - `speedLimitKph = LIMITS[tick % LIMITS.size]`
    - `source = "simulated"`
    - Schema: fields speedLimitKph/source, stalenessThresholdMs = 15000L

    **Note:** Plan 02 must complete first (wave dependency) to relocate SolarSnapshot and SpeedLimitSnapshot to `:pack:essentials:snapshots` before these providers can import them.
  </action>
  <verify>
    <automated>cd /Users/ohm/Workspace/dqxn/android && ./gradlew :pack:demo:compileDebugKotlin --console=plain 2>&1 | tail -5</automated>
  </verify>
  <done>All 8 demo providers compile. Each emits deterministic data from tick-based math.</done>
</task>

<task type="auto">
  <name>Task 2: Contract tests for remaining 4 providers</name>
  <files>
    android/pack/demo/src/test/kotlin/app/dqxn/android/pack/demo/providers/DemoAmbientLightProviderContractTest.kt
    android/pack/demo/src/test/kotlin/app/dqxn/android/pack/demo/providers/DemoAccelerationProviderContractTest.kt
    android/pack/demo/src/test/kotlin/app/dqxn/android/pack/demo/providers/DemoSolarProviderContractTest.kt
    android/pack/demo/src/test/kotlin/app/dqxn/android/pack/demo/providers/DemoSpeedLimitProviderContractTest.kt
  </files>
  <action>
    Create 4 contract test classes for the providers created in Task 1 — each extends `DataProviderContractTest<T>` from `:sdk:contracts` testFixtures:
    ```kotlin
    class DemoAmbientLightProviderContractTest : DataProviderContractTest<AmbientLightSnapshot>() {
      override fun createProvider(): DataProvider<AmbientLightSnapshot> = DemoAmbientLightProvider()
    }
    ```
    Same pattern for: `DemoAccelerationProviderContractTest`, `DemoSolarProviderContractTest`, `DemoSpeedLimitProviderContractTest`.

    Each contract test validates the 12 assertions from `DataProviderContractTest`: sourceId format, displayName non-empty, dataType matches, priority set, snapshotType correct, schema fields present, provideState emits, timestamp non-zero, etc.

    Note: Contract tests for Time, Speed, Orientation, Battery already exist from Plan 02.
  </action>
  <verify>
    <automated>cd /Users/ohm/Workspace/dqxn/android && ./gradlew :pack:demo:testDebugUnitTest --tests "*.Demo*ContractTest" --console=plain 2>&1 | tail -20</automated>
  </verify>
  <done>All 8 contract tests pass (4 from Plan 02 + 4 new). 12 assertions each = 96 total.</done>
</task>

<task type="auto">
  <name>Task 3: Determinism verification for all 8 providers</name>
  <files>
    android/pack/demo/src/test/kotlin/app/dqxn/android/pack/demo/providers/DemoDeterminismTest.kt
  </files>
  <action>
    Create DemoDeterminismTest.kt — verifies reproducibility across all 8 providers:
    - For each of the 8 providers, collect first 10 emissions using Turbine
    - Collect first 10 emissions again from a fresh instance
    - Assert the data values (excluding timestamp which uses `System.nanoTime()`) are identical
    - Use `StandardTestDispatcher` + `runTest` with virtual time for deterministic delay advancement
    - Example:
    ```kotlin
    @Test
    fun `DemoSpeedProvider produces identical values across instances`() = runTest {
      val provider1 = DemoSpeedProvider()
      val provider2 = DemoSpeedProvider()
      val values1 = mutableListOf<Float>()
      val values2 = mutableListOf<Float>()

      provider1.provideState().take(10).collect { values1.add(it.speedMps) }
      provider2.provideState().take(10).collect { values2.add(it.speedMps) }

      assertThat(values1).isEqualTo(values2)
    }
    ```
    - Test all 8 providers in separate test methods
    - Additional test: verify specific known values at known ticks (e.g., DemoSpeedProvider tick 0 = 0 m/s, tick 12 = ~19.4 m/s, tick 24 = ~38.9 m/s)
  </action>
  <verify>
    <automated>cd /Users/ohm/Workspace/dqxn/android && ./gradlew :pack:demo:testDebugUnitTest --tests "*.DemoDeterminismTest" --console=plain 2>&1 | tail -20</automated>
  </verify>
  <done>Determinism tests pass: identical values from separate instances for all 8 providers. Known-value assertions pass.</done>
</task>

</tasks>

<verification>
```bash
cd /Users/ohm/Workspace/dqxn/android && ./gradlew :pack:demo:testDebugUnitTest --console=plain
```
All contract tests and determinism tests pass. 8 providers, all SIMULATED priority, all deterministic.
</verification>

<success_criteria>
- 4 new `DataProviderContractTest` subclasses pass (8 total with Plan 02's 4)
- `DemoDeterminismTest` proves same-tick reproducibility for all 8 providers
- All providers use `ProviderPriority.SIMULATED`
- No randomness in any provider
- Data ranges are realistic (speed 0-140 km/h, heading 0-360, battery 1-100, etc.)
</success_criteria>

<output>
After completion, create `.planning/phases/09-themes-demo-chaos/09-03-SUMMARY.md`
</output>
