---
phase: 14-ui-visual-interactive-parity
plan: 06
type: execute
wave: 1
depends_on: []
files_modified:
  - android/feature/settings/src/main/kotlin/app/dqxn/android/feature/settings/theme/ThemeSelector.kt
  - android/feature/settings/src/test/kotlin/app/dqxn/android/feature/settings/theme/ThemeSelectorTest.kt
autonomous: true
requirements: [F4.6]

must_haves:
  truths:
    - "ThemeSelector uses GridCells.Fixed(4) -- 4 columns instead of 3"
    - "ThemeSelector has 2-page HorizontalPager: page 0 = built-in themes (Native), page 1 = custom themes"
    - "Theme cards show gradient background via theme.backgroundBrush"
    - "Theme cards show 4 color-dot swatches (8dp circles: primaryTextColor, secondaryTextColor, accentColor, highlightColor)"
    - "Premium themes show star icon overlay (Icons.Filled.Star) instead of lock icon"
    - "Theme card aspect ratio is 2f (not 1.5f)"
    - "Selection border uses theme.highlightColor (not accentColor)"
    - "Title bar has page indicator icons: Palette (page 0) + Add (page 1), accent-highlighted when active"
    - "60s preview timeout is removed (PREVIEW_TIMEOUT_MS constant + timeout LaunchedEffect deleted)"
    - "DisposableEffect cleanup and entitlement revocation LaunchedEffect preserved"
    - "ThemeSelector accepts isDark: Boolean parameter to filter themes by mode"
    - "ThemeSelector accepts onCreateNewTheme: () -> Unit parameter for custom page create button"
  artifacts:
    - path: "android/feature/settings/src/main/kotlin/app/dqxn/android/feature/settings/theme/ThemeSelector.kt"
      provides: "4-col 2-page HorizontalPager theme selector with gradient backgrounds and color dots"
      contains: "HorizontalPager"
    - path: "android/feature/settings/src/test/kotlin/app/dqxn/android/feature/settings/theme/ThemeSelectorTest.kt"
      provides: "Tests for 4-col grid, pager, color dots, star icon, no timeout, isDark filtering"
      contains: "GridCells.Fixed(4)"
---

<objective>
Rework ThemeSelector to 4-column 2-page HorizontalPager layout with visual parity from old codebase.

Purpose: Current ThemeSelector has a 3-column single grid, no gradient backgrounds on theme cards, no color-dot swatches, lock icon instead of star for premium, wrong aspect ratio (1.5f vs 2f), wrong selection border color (accentColor vs highlightColor), and a 60s preview timeout that the old codebase didn't have. This plan fixes ALL ThemeSelector visual issues and adds isDark/onCreateNewTheme parameters that 14-09 wires.

Output: Reworked ThemeSelector.kt with pager, updated ThemeSelectorTest.kt.
</objective>

<execution_context>
@/Users/ohm/.claude/get-shit-done/workflows/execute-plan.md
@/Users/ohm/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@android/feature/settings/src/main/kotlin/app/dqxn/android/feature/settings/theme/ThemeSelector.kt
@android/feature/settings/src/test/kotlin/app/dqxn/android/feature/settings/theme/ThemeSelectorTest.kt

<interfaces>
<!-- DashboardThemeDefinition fields for theme cards:
     val themeId: String
     val displayName: String
     val isDark: Boolean
     val packId: String?
     val requiredAnyEntitlement: Set<String>?
     val primaryTextColor: Color
     val secondaryTextColor: Color
     val accentColor: Color
     val highlightColor: Color
     val widgetBorderColor: Color
     val backgroundBrush: Brush
     val widgetBackgroundBrush: Brush
-->

<!-- Old codebase ThemeSelector layout (user corrections applied):
     - 2-page HorizontalPager (page 0: "Native" built-in, page 1: "Custom" themes)
     - LazyVerticalGrid with GridCells.Fixed(3) -- USER OVERRIDE: wants 4 columns
     - Each theme item: aspectRatio(2f), background = theme.backgroundBrush, selected = 2dp highlightColor border
     - Content: 4 color swatches (8dp circles: primaryTextColor, secondaryTextColor, accentColor, highlightColor) + star icon if premium
     - Page 1: same grid + CreateThemeButton at end
     - Title bar icons: Palette (page 0) + Add (page 1), accent-highlighted when active
     - NO preview timeout (old codebase had none)
-->

<!-- Current ThemeSelector state (deltas to fix):
     1. GridCells.Fixed(3) -> GridCells.Fixed(4)
     2. Single LazyVerticalGrid -> 2-page HorizontalPager with LazyVerticalGrid per page
     3. No background on swatch box -> background = theme.backgroundBrush
     4. aspectRatio(1.5f) -> aspectRatio(2f)
     5. Icons.Filled.Lock -> Icons.Filled.Star for premium
     6. borderColor = accentColor -> borderColor = highlightColor
     7. No color-dot swatches -> 4 x 8dp colored circles
     8. PREVIEW_TIMEOUT_MS = 60_000L + LaunchedEffect -> DELETE both
     9. No isDark param -> add isDark: Boolean to filter themes
     10. No onCreateNewTheme -> add for custom page create button
     11. No page indicator icons -> add Palette/Add icons in title bar area
-->

<!-- OverlayScaffold signature (no actions slot):
     fun OverlayScaffold(title, overlayType, onClose, modifier, visible, content)
     NO actions slot -- page icons must go inside content, above the HorizontalPager
-->

<!-- This plan does NOT touch MainSettings.kt, OverlayNavHost.kt, or OverlayRoutes.kt.
     Those are owned by plan 14-09 to avoid file conflicts. -->
</interfaces>
</context>

<tasks>

<task type="auto">
  <name>Task 1: Rework ThemeSelector to 4-col HorizontalPager with visual parity</name>
  <files>
    android/feature/settings/src/main/kotlin/app/dqxn/android/feature/settings/theme/ThemeSelector.kt
  </files>
  <action>
**Rework ThemeSelector.kt completely. Key changes:**

**1. Add new parameters** to ThemeSelector:
```kotlin
@Composable
public fun ThemeSelector(
    allThemes: ImmutableList<DashboardThemeDefinition>,
    isDark: Boolean,                                    // NEW: filter themes by mode
    previewTheme: DashboardThemeDefinition?,
    customThemeCount: Int,
    entitlementManager: EntitlementManager,
    onPreviewTheme: (DashboardThemeDefinition) -> Unit,
    onApplyTheme: (String) -> Unit,
    onClearPreview: () -> Unit,
    onCloneToCustom: (DashboardThemeDefinition) -> Unit,
    onOpenStudio: (DashboardThemeDefinition) -> Unit,
    onDeleteCustom: (String) -> Unit,
    onCreateNewTheme: () -> Unit,                       // NEW: custom page create button
    onShowToast: (String) -> Unit,
    onClose: () -> Unit,
    modifier: Modifier = Modifier,
)
```

**2. Filter themes by isDark** before sorting:
```kotlin
val filteredThemes = remember(allThemes, isDark) {
    allThemes.filter { it.isDark == isDark }
}
val sortedThemes = remember(filteredThemes) { sortThemes(filteredThemes.toImmutableList()) }
```

**3. Remove preview timeout** -- delete the `PREVIEW_TIMEOUT_MS` constant and the `LaunchedEffect(previewTheme?.themeId)` block that calls `delay(PREVIEW_TIMEOUT_MS)` + `onClearPreview()` + `onShowToast("Preview timed out")`. Keep the entitlement revocation `LaunchedEffect` and the `DisposableEffect(Unit)` cleanup.

**4. Split sorted themes into built-in vs custom** for 2-page pager:
```kotlin
val builtInThemes = remember(sortedThemes) {
    sortedThemes.filter { !it.themeId.startsWith("custom_") }
}
val customThemes = remember(sortedThemes) {
    sortedThemes.filter { it.themeId.startsWith("custom_") }
}
```

**5. Add pager state and scope:**
```kotlin
val pagerState = rememberPagerState(initialPage = 0) { 2 }
val scope = rememberCoroutineScope()
```

**6. Replace the OverlayScaffold content** with a Column containing page icons + HorizontalPager. Since OverlayScaffold has no `actions` slot, place the page icons inside the content:

```kotlin
OverlayScaffold(
    title = if (isDark) "Dark Themes" else "Light Themes",
    overlayType = OverlayType.Preview,
    onClose = onClose,
    modifier = modifier.testTag("theme_selector"),
) {
    Column(modifier = Modifier.fillMaxSize()) {
        // -- Title bar page icons: Palette (page 0) + Add (page 1) --
        ThemePageIcons(
            currentPage = pagerState.currentPage,
            onNavigateToPage = { page -> scope.launch { pagerState.animateScrollToPage(page) } },
            accentColor = theme.accentColor,
            inactiveColor = theme.secondaryTextColor,
        )

        // -- 2-page HorizontalPager --
        HorizontalPager(
            state = pagerState,
            modifier = Modifier.fillMaxSize().testTag("theme_pager"),
        ) { page ->
            when (page) {
                0 -> ThemeGrid(
                    themes = builtInThemes,
                    previewTheme = previewTheme,
                    entitlementManager = entitlementManager,
                    customThemeCount = customThemeCount,
                    onTap = onPreviewTheme,
                    onLongPress = { themeItem ->
                        if (customThemeCount < MAX_CUSTOM_THEMES) onCloneToCustom(themeItem)
                        else onShowToast("Maximum $MAX_CUSTOM_THEMES custom themes reached")
                    },
                    onApply = { themeItem, hasAccess ->
                        if (hasAccess) onApplyTheme(themeItem.themeId)
                        else onShowToast("Upgrade required to apply this theme")
                    },
                    accentColor = theme.accentColor,
                    textColor = theme.primaryTextColor,
                    highlightColor = theme.highlightColor,
                    modifier = Modifier.testTag("theme_page_builtin"),
                )
                1 -> ThemeGrid(
                    themes = customThemes,
                    previewTheme = previewTheme,
                    entitlementManager = entitlementManager,
                    customThemeCount = customThemeCount,
                    onTap = onPreviewTheme,
                    onLongPress = { /* no clone for custom themes */ },
                    onApply = { themeItem, _ -> onApplyTheme(themeItem.themeId) },
                    accentColor = theme.accentColor,
                    textColor = theme.primaryTextColor,
                    highlightColor = theme.highlightColor,
                    isCustomPage = true,
                    onEdit = onOpenStudio,
                    onDelete = { themeItem -> onDeleteCustom(themeItem.themeId) },
                    onCreateNew = onCreateNewTheme,
                    modifier = Modifier.testTag("theme_page_custom"),
                )
            }
        }
    }
}
```

**7. Create ThemePageIcons composable** (title bar page indicator icons):
```kotlin
@Composable
private fun ThemePageIcons(
    currentPage: Int,
    onNavigateToPage: (Int) -> Unit,
    accentColor: Color,
    inactiveColor: Color,
) {
    Row(
        modifier = Modifier.fillMaxWidth().testTag("theme_page_icons"),
        horizontalArrangement = Arrangement.Center,
    ) {
        IconButton(onClick = { onNavigateToPage(0) }) {
            Icon(
                imageVector = Icons.Filled.Palette,
                contentDescription = "Built-in themes",
                tint = if (currentPage == 0) accentColor else inactiveColor,
                modifier = Modifier.testTag("theme_page_icon_builtin"),
            )
        }
        IconButton(onClick = { onNavigateToPage(1) }) {
            Icon(
                imageVector = Icons.Filled.Add,
                contentDescription = "Custom themes",
                tint = if (currentPage == 1) accentColor else inactiveColor,
                modifier = Modifier.testTag("theme_page_icon_custom"),
            )
        }
    }
}
```

**8. Create ThemeGrid composable** (shared grid for both pages):
```kotlin
@Composable
private fun ThemeGrid(
    themes: List<DashboardThemeDefinition>,
    previewTheme: DashboardThemeDefinition?,
    entitlementManager: EntitlementManager,
    customThemeCount: Int,
    onTap: (DashboardThemeDefinition) -> Unit,
    onLongPress: (DashboardThemeDefinition) -> Unit,
    onApply: (DashboardThemeDefinition, Boolean) -> Unit,
    accentColor: Color,
    textColor: Color,
    highlightColor: Color,
    modifier: Modifier = Modifier,
    isCustomPage: Boolean = false,
    onEdit: ((DashboardThemeDefinition) -> Unit)? = null,
    onDelete: ((DashboardThemeDefinition) -> Unit)? = null,
    onCreateNew: (() -> Unit)? = null,
) {
    LazyVerticalGrid(
        columns = GridCells.Fixed(4),  // 4 columns per user correction
        contentPadding = PaddingValues(8.dp),
        horizontalArrangement = Arrangement.spacedBy(8.dp),
        verticalArrangement = Arrangement.spacedBy(8.dp),
        modifier = modifier.fillMaxSize(),
    ) {
        items(themes, key = { it.themeId }) { themeItem ->
            val isSelected = previewTheme?.themeId == themeItem.themeId
            val isGated = !themeItem.requiredAnyEntitlement.isNullOrEmpty()
            val hasAccess = !isGated || themeItem.requiredAnyEntitlement!!.any { entitlementManager.hasEntitlement(it) }

            ThemeCard(
                theme = themeItem,
                isSelected = isSelected,
                isGated = isGated,
                isCustom = isCustomPage,
                hasAccess = hasAccess,
                onTap = { onTap(themeItem) },
                onLongPress = { onLongPress(themeItem) },
                onApply = { onApply(themeItem, hasAccess) },
                onEdit = if (isCustomPage && onEdit != null) { { onEdit(themeItem) } } else null,
                onDelete = if (isCustomPage && onDelete != null) { { onDelete(themeItem) } } else null,
                textColor = textColor,
                highlightColor = highlightColor,
            )
        }

        if (isCustomPage && onCreateNew != null) {
            item {
                CreateThemeButton(accentColor = accentColor, onClick = onCreateNew)
            }
        }
    }
}
```

**9. Rework ThemeCard** to match old codebase visual:
```kotlin
@Composable
private fun ThemeCard(
    theme: DashboardThemeDefinition,
    isSelected: Boolean,
    isGated: Boolean,
    isCustom: Boolean,
    hasAccess: Boolean,
    onTap: () -> Unit,
    onLongPress: () -> Unit,
    onApply: () -> Unit,
    onEdit: (() -> Unit)?,
    onDelete: (() -> Unit)?,
    textColor: Color,
    highlightColor: Color,
) {
    val borderColor = if (isSelected) highlightColor else Color.Transparent  // highlightColor, NOT accentColor
    val cornerShape = RoundedCornerShape(CardSize.SMALL.cornerRadius)

    Column(
        modifier = Modifier
            .testTag("theme_card_${theme.themeId}")
            .clip(cornerShape)
            .border(2.dp, borderColor, cornerShape)
            .combinedClickable(onClick = onTap, onLongClick = onLongPress, onDoubleClick = onApply)
            .padding(4.dp),
        horizontalAlignment = Alignment.CenterHorizontally,
    ) {
        // Gradient background swatch
        Box(
            modifier = Modifier
                .fillMaxWidth()
                .aspectRatio(2f)  // 2f, NOT 1.5f
                .clip(cornerShape)
                .background(theme.backgroundBrush)  // gradient background
                .testTag("theme_swatch_${theme.themeId}"),
        ) {
            // Star icon for premium (NOT lock)
            if (isGated) {
                Icon(
                    imageVector = Icons.Filled.Star,
                    contentDescription = "Premium",
                    tint = Color.White.copy(alpha = 0.8f),
                    modifier = Modifier
                        .align(Alignment.TopEnd)
                        .padding(4.dp)
                        .size(14.dp)
                        .testTag("theme_star_${theme.themeId}"),
                )
            }
        }

        // Theme name
        Text(
            text = theme.displayName,
            style = DashboardTypography.caption,
            color = textColor,
            maxLines = 1,
            modifier = Modifier.testTag("theme_name_${theme.themeId}"),
        )

        // 4 color-dot swatches (8dp circles)
        Row(
            horizontalArrangement = Arrangement.spacedBy(4.dp),
            modifier = Modifier.padding(top = 2.dp).testTag("theme_dots_${theme.themeId}"),
        ) {
            ColorDot(color = theme.primaryTextColor)
            ColorDot(color = theme.secondaryTextColor)
            ColorDot(color = theme.accentColor)
            ColorDot(color = theme.highlightColor)
        }

        // Edit/delete for custom themes
        if (isCustom && onEdit != null && onDelete != null) {
            Row(
                modifier = Modifier.testTag("theme_custom_actions_${theme.themeId}"),
                horizontalArrangement = Arrangement.spacedBy(4.dp),
            ) {
                IconButton(onClick = onEdit, modifier = Modifier.size(24.dp)) {
                    Icon(Icons.Filled.Edit, "Edit", tint = textColor.copy(alpha = 0.7f), modifier = Modifier.size(16.dp))
                }
                IconButton(onClick = onDelete, modifier = Modifier.size(24.dp)) {
                    Icon(Icons.Filled.Delete, "Delete", tint = textColor.copy(alpha = 0.7f), modifier = Modifier.size(16.dp))
                }
            }
        }
    }
}
```

**10. Add ColorDot and CreateThemeButton composables:**
```kotlin
@Composable
private fun ColorDot(color: Color, modifier: Modifier = Modifier) {
    Box(modifier = modifier.size(8.dp).clip(CircleShape).background(color))
}

@Composable
private fun CreateThemeButton(accentColor: Color, onClick: () -> Unit, modifier: Modifier = Modifier) {
    val cornerShape = RoundedCornerShape(CardSize.SMALL.cornerRadius)
    Box(
        modifier = modifier
            .fillMaxWidth()
            .aspectRatio(2f)
            .clip(cornerShape)
            .border(2.dp, accentColor.copy(alpha = 0.3f), cornerShape)
            .clickable(onClick = onClick)
            .testTag("create_theme_button"),
        contentAlignment = Alignment.Center,
    ) {
        Icon(Icons.Filled.Add, "Create theme", tint = accentColor, modifier = Modifier.size(32.dp))
    }
}
```

**11. Add required imports:**
```kotlin
import androidx.compose.foundation.background
import androidx.compose.foundation.clickable
import androidx.compose.foundation.layout.Row
import androidx.compose.foundation.layout.fillMaxSize
import androidx.compose.foundation.pager.HorizontalPager
import androidx.compose.foundation.pager.rememberPagerState
import androidx.compose.foundation.shape.CircleShape
import androidx.compose.material.icons.filled.Add
import androidx.compose.material.icons.filled.Palette
import androidx.compose.material.icons.filled.Star
import androidx.compose.runtime.rememberCoroutineScope
import kotlinx.coroutines.launch
```

Remove imports no longer needed: `Icons.Filled.Lock`, `delay`.

Remove the `PREVIEW_TIMEOUT_MS` constant. Keep `MAX_CUSTOM_THEMES`.

The `sortThemes()` function at the bottom remains unchanged.
  </action>
  <verify>
    <automated>cd android && ./gradlew :feature:settings:compileDebugKotlin --console=plain 2>&1 | tail -5</automated>
  </verify>
  <done>
    - ThemeSelector uses GridCells.Fixed(4)
    - 2-page HorizontalPager: page 0 = built-in, page 1 = custom
    - Theme cards show gradient background via theme.backgroundBrush
    - Theme cards show 4 color-dot swatches (8dp circles)
    - Premium themes show star icon (not lock)
    - Selection border uses highlightColor (not accentColor)
    - Aspect ratio is 2f (not 1.5f)
    - Title bar has Palette/Add page icons, accent-highlighted when active
    - Preview timeout removed (PREVIEW_TIMEOUT_MS deleted)
    - isDark parameter added and filters themes
    - onCreateNewTheme parameter added for custom page
    - DisposableEffect and entitlement revocation preserved
    - Compiles successfully
  </done>
</task>

<task type="auto">
  <name>Task 2: Update ThemeSelectorTest for new layout and behavior</name>
  <files>
    android/feature/settings/src/test/kotlin/app/dqxn/android/feature/settings/theme/ThemeSelectorTest.kt
  </files>
  <action>
**Update ThemeSelectorTest.kt** to verify the reworked ThemeSelector:

**1. Update ALL test helper calls** to pass new params. Every call to ThemeSelector in tests must now include:
```kotlin
isDark = true,
onCreateNewTheme = {},
```

**2. Delete the timeout test** -- `preview timeout clears preview after 60s` test must be removed since the timeout is gone.

**3. Update lock icon test** to star icon test -- rename and change assertion:
```kotlin
@Test
fun `star icon shown on gated themes`() {
    composeTestRule.setContent {
        CompositionLocalProvider(LocalDashboardTheme provides containerTheme) {
            ThemeSelector(
                allThemes = persistentListOf(premiumTheme1),
                isDark = true,
                previewTheme = null,
                customThemeCount = 0,
                entitlementManager = noThemesEntitlementManager,
                onPreviewTheme = {},
                onApplyTheme = {},
                onClearPreview = {},
                onCloneToCustom = {},
                onOpenStudio = {},
                onDeleteCustom = {},
                onCreateNewTheme = {},
                onShowToast = {},
                onClose = {},
            )
        }
    }

    composeTestRule
        .onNodeWithTag("theme_star_neon", useUnmergedTree = true)
        .assertExists()
}
```

**4. Add new tests:**

```kotlin
@Test
fun `4-column grid layout verified in source`() {
    val file = File(System.getProperty("user.dir"),
        "feature/settings/src/main/kotlin/app/dqxn/android/feature/settings/theme/ThemeSelector.kt")
    val content = file.readText()
    assertThat(content).contains("GridCells.Fixed(4)")
    assertThat(content).doesNotContain("GridCells.Fixed(3)")
}

@Test
fun `horizontal pager exists with 2 pages`() {
    val file = File(System.getProperty("user.dir"),
        "feature/settings/src/main/kotlin/app/dqxn/android/feature/settings/theme/ThemeSelector.kt")
    val content = file.readText()
    assertThat(content).contains("HorizontalPager")
    assertThat(content).contains("rememberPagerState")
}

@Test
fun `theme cards show color dots`() {
    composeTestRule.setContent {
        CompositionLocalProvider(LocalDashboardTheme provides containerTheme) {
            ThemeSelector(
                allThemes = persistentListOf(freeTheme1),
                isDark = true,
                previewTheme = null,
                customThemeCount = 0,
                entitlementManager = freeEntitlementManager,
                onPreviewTheme = {},
                onApplyTheme = {},
                onClearPreview = {},
                onCloneToCustom = {},
                onOpenStudio = {},
                onDeleteCustom = {},
                onCreateNewTheme = {},
                onShowToast = {},
                onClose = {},
            )
        }
    }

    composeTestRule.onNodeWithTag("theme_dots_minimalist", useUnmergedTree = true).assertExists()
}

@Test
fun `no preview timeout in source`() {
    val file = File(System.getProperty("user.dir"),
        "feature/settings/src/main/kotlin/app/dqxn/android/feature/settings/theme/ThemeSelector.kt")
    val content = file.readText()
    assertThat(content).doesNotContain("PREVIEW_TIMEOUT_MS")
    assertThat(content).doesNotContain("Preview timed out")
}

@Test
fun `selection border uses highlightColor not accentColor`() {
    val file = File(System.getProperty("user.dir"),
        "feature/settings/src/main/kotlin/app/dqxn/android/feature/settings/theme/ThemeSelector.kt")
    val content = file.readText()
    assertThat(content).contains("highlightColor")
    // ThemeCard border must use highlightColor param
    assertThat(content).contains("if (isSelected) highlightColor")
}

@Test
fun `theme cards use aspect ratio 2f`() {
    val file = File(System.getProperty("user.dir"),
        "feature/settings/src/main/kotlin/app/dqxn/android/feature/settings/theme/ThemeSelector.kt")
    val content = file.readText()
    assertThat(content).contains("aspectRatio(2f)")
    assertThat(content).doesNotContain("aspectRatio(1.5f)")
}

@Test
fun `themes filtered by isDark parameter`() {
    // Create a light theme and dark theme
    val lightTheme = createTheme("light-test", "Light Test", isDark = false)
    val darkTheme = createTheme("dark-test", "Dark Test", isDark = true)
    val mixed = persistentListOf(lightTheme, darkTheme)

    composeTestRule.setContent {
        CompositionLocalProvider(LocalDashboardTheme provides containerTheme) {
            ThemeSelector(
                allThemes = mixed,
                isDark = false,  // only light themes
                previewTheme = null,
                customThemeCount = 0,
                entitlementManager = freeEntitlementManager,
                onPreviewTheme = {},
                onApplyTheme = {},
                onClearPreview = {},
                onCloneToCustom = {},
                onOpenStudio = {},
                onDeleteCustom = {},
                onCreateNewTheme = {},
                onShowToast = {},
                onClose = {},
            )
        }
    }

    // Light theme visible, dark theme not
    composeTestRule.onNodeWithTag("theme_card_light-test", useUnmergedTree = true).assertExists()
    composeTestRule.onNodeWithTag("theme_card_dark-test", useUnmergedTree = true).assertDoesNotExist()
}

@Test
fun `page icons exist`() {
    composeTestRule.setContent {
        CompositionLocalProvider(LocalDashboardTheme provides containerTheme) {
            ThemeSelector(
                allThemes = persistentListOf(freeTheme1),
                isDark = true,
                previewTheme = null,
                customThemeCount = 0,
                entitlementManager = freeEntitlementManager,
                onPreviewTheme = {},
                onApplyTheme = {},
                onClearPreview = {},
                onCloneToCustom = {},
                onOpenStudio = {},
                onDeleteCustom = {},
                onCreateNewTheme = {},
                onShowToast = {},
                onClose = {},
            )
        }
    }

    composeTestRule.onNodeWithTag("theme_page_icon_builtin", useUnmergedTree = true).assertExists()
    composeTestRule.onNodeWithTag("theme_page_icon_custom", useUnmergedTree = true).assertExists()
}
```

**5. Add import:**
```kotlin
import java.io.File
```

**6. Update the `createTheme` helper** to include `highlightColor` if not already present (it already uses `Color.Cyan` for accentColor, add a distinct highlightColor like `Color.Yellow`):
Check the existing createTheme helper. It currently uses `DashboardThemeDefinition(...)` but doesn't pass `highlightColor`. If `highlightColor` has a default value in DashboardThemeDefinition, that's fine. If not, add `highlightColor = Color.Yellow` to the helper.
  </action>
  <verify>
    <automated>cd android && ./gradlew :feature:settings:testDebugUnitTest --tests "*.ThemeSelectorTest" --console=plain 2>&1 | tail -10</automated>
  </verify>
  <done>
    - All ThemeSelectorTest call sites updated with isDark + onCreateNewTheme params
    - Timeout test deleted
    - Lock icon test replaced with star icon test
    - Source verification: GridCells.Fixed(4), HorizontalPager, no PREVIEW_TIMEOUT_MS
    - Color dots test via theme_dots_ tag
    - isDark filtering test
    - Page icons test
    - Aspect ratio 2f verified
    - highlightColor border verified
    - All tests pass
  </done>
</task>

</tasks>

<verification>
1. `cd android && ./gradlew :feature:settings:compileDebugKotlin --console=plain` -- compiles
2. `cd android && ./gradlew :feature:settings:testDebugUnitTest --tests "*.ThemeSelectorTest" --console=plain` -- all tests pass
3. `cd android && ./gradlew :feature:settings:testDebugUnitTest --console=plain` -- no regressions
</verification>

<success_criteria>
- ThemeSelector: 4-col grid, 2-page HorizontalPager, gradient backgrounds, 4 color dots, premium stars (not locks), highlightColor selection border, 2f aspect ratio
- Theme preview timeout fully removed (no constant, no LaunchedEffect)
- isDark parameter filters themes by mode
- onCreateNewTheme parameter for custom page create button
- Title bar has Palette/Add page icons
- DisposableEffect and entitlement revocation preserved
- All tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/14-ui-visual-interactive-parity/14-06-SUMMARY.md`
</output>
