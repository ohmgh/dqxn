---
phase: 14-ui-visual-interactive-parity
plan: 09
type: execute
wave: 1
depends_on: []
files_modified:
  - android/feature/settings/src/main/kotlin/app/dqxn/android/feature/settings/main/MainSettings.kt
  - android/feature/settings/src/main/res/values/strings.xml
  - android/feature/dashboard/src/main/kotlin/app/dqxn/android/feature/dashboard/layer/OverlayNavHost.kt
  - android/feature/settings/src/test/kotlin/app/dqxn/android/feature/settings/main/MainSettingsAppIntroTest.kt
autonomous: true
requirements: []

must_haves:
  truths:
    - "App intro header renders at top of MainSettings with DQXN logo, tagline, and version"
    - "Orientation Lock row renders in the Behavior section with current value"
    - "Orientation Lock row triggers callback to update preference"
  artifacts:
    - path: "android/feature/settings/src/main/kotlin/app/dqxn/android/feature/settings/main/MainSettings.kt"
      provides: "AppIntroHeader composable + Orientation Lock row in Behavior section"
      contains: "AppIntroHeader"
    - path: "android/feature/settings/src/test/kotlin/app/dqxn/android/feature/settings/main/MainSettingsAppIntroTest.kt"
      provides: "Tests for app intro header and orientation lock row"
  key_links:
    - from: "MainSettings.kt"
      to: "MainSettingsViewModel.kt"
      via: "orientationLock StateFlow and setOrientationLock callback"
      pattern: "orientationLock"
---

<objective>
Add app intro header and missing Orientation Lock row to MainSettings.

Purpose: Old codebase had a brand banner at the top of settings (mascot logo, tagline "Life is a
dash. Make it beautiful.", app name + version). The new MainSettings jumps straight into the
Appearance section header. Also, the Orientation Lock preference has a ViewModel property
(`orientationLock` StateFlow, `setOrientationLock()` method) and string resource
(`main_settings_orientation_lock`) but no corresponding UI row rendered in MainSettings.

Output: `AppIntroHeader` composable at top of settings, `OrientationLockRow` in Behavior section.
</objective>

<execution_context>
@/Users/ohm/.claude/get-shit-done/workflows/execute-plan.md
@/Users/ohm/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@android/feature/settings/src/main/kotlin/app/dqxn/android/feature/settings/main/MainSettings.kt
@android/feature/settings/src/main/kotlin/app/dqxn/android/feature/settings/main/MainSettingsViewModel.kt
@android/feature/settings/src/main/res/values/strings.xml

<interfaces>
<!-- MainSettingsViewModel already exposes:
     val orientationLock: StateFlow<String> (values: "auto", "landscape", "portrait")
     fun setOrientationLock(lock: String) -- persists to UserPreferencesRepository
-->
<!-- String resource already exists: main_settings_orientation_lock = "Orientation Lock" -->
<!-- MainSettings currently takes: analyticsConsent, showStatusBar, keepScreenOn + setters -->
<!-- ic_logo_letterform.xml exists at android/app/src/main/res/drawable/ (in :app, not :feature:settings) -->
<!-- Product tagline from REQUIREMENTS.md: "Life is a dash. Make it beautiful." -->
<!-- App name string resource in :app: app_name = "DQXN" -->
</interfaces>
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add AppIntroHeader and OrientationLockRow to MainSettings</name>
  <files>
    android/feature/settings/src/main/kotlin/app/dqxn/android/feature/settings/main/MainSettings.kt
    android/feature/settings/src/main/res/values/strings.xml
  </files>
  <action>
1. **Add new string resources** to `android/feature/settings/src/main/res/values/strings.xml`:
```xml
<string name="main_settings_tagline">Life is a dash. Make it beautiful.</string>
<string name="main_settings_tagline_attribution">The Dashing Dachshund</string>
<string name="main_settings_version">Version %1$s</string>
<string name="main_settings_orientation_auto">Auto</string>
<string name="main_settings_orientation_landscape">Landscape</string>
<string name="main_settings_orientation_portrait">Portrait</string>
```

2. **Add `orientationLock` and `onSetOrientationLock` parameters** to `MainSettings`:
```kotlin
@Composable
public fun MainSettings(
  analyticsConsent: Boolean,
  showStatusBar: Boolean,
  keepScreenOn: Boolean,
  orientationLock: String,              // NEW
  versionName: String,                  // NEW
  onSetAnalyticsConsent: (Boolean) -> Unit,
  onSetShowStatusBar: (Boolean) -> Unit,
  onSetKeepScreenOn: (Boolean) -> Unit,
  onSetOrientationLock: (String) -> Unit, // NEW
  onDeleteAllData: () -> Unit,
  onNavigateToThemeMode: () -> Unit,
  onNavigateToDashPacks: () -> Unit,
  onNavigateToDiagnostics: () -> Unit,
  onClose: () -> Unit,
  modifier: Modifier = Modifier,
)
```

3. **Add `AppIntroHeader` composable** (private, inside MainSettings.kt). Place it at the top of the
   scrollable Column, before the Appearance section:
```kotlin
@Composable
private fun AppIntroHeader(
  versionName: String,
  theme: DashboardThemeDefinition,
  modifier: Modifier = Modifier,
) {
  Column(
    modifier = modifier
      .fillMaxWidth()
      .padding(vertical = DashboardSpacing.SectionGap)
      .testTag("app_intro_header"),
    horizontalAlignment = Alignment.CenterHorizontally,
  ) {
    // App name
    Text(
      text = stringResource(R.string.app_name_settings),  // or just "DQXN"
      style = DashboardTypography.title,
      color = theme.accentColor,
    )
    Spacer(modifier = Modifier.height(DashboardSpacing.InGroupGap))
    // Tagline
    Text(
      text = stringResource(R.string.main_settings_tagline),
      style = DashboardTypography.description,
      color = theme.primaryTextColor.copy(alpha = TextEmphasis.Medium),
    )
    Text(
      text = "-- ${stringResource(R.string.main_settings_tagline_attribution)}",
      style = DashboardTypography.caption,
      color = theme.primaryTextColor.copy(alpha = TextEmphasis.Disabled),
    )
    Spacer(modifier = Modifier.height(DashboardSpacing.InGroupGap))
    // Version
    Text(
      text = stringResource(R.string.main_settings_version, versionName),
      style = DashboardTypography.caption,
      color = theme.secondaryTextColor,
    )
  }
}
```

If `R.string.app_name` is not accessible from `:feature:settings` (it's in `:app`), add a new
string to the settings module:
```xml
<string name="app_name_settings">DQXN</string>
```

4. **Add `OrientationLockRow`** in the Behavior section. It should be an enum-style row showing
   the current value with a click to cycle through options (auto -> landscape -> portrait -> auto):
```kotlin
@Composable
private fun OrientationLockRow(
  currentLock: String,
  onSetOrientationLock: (String) -> Unit,
  theme: DashboardThemeDefinition,
  modifier: Modifier = Modifier,
) {
  val displayValue = when (currentLock) {
    "landscape" -> stringResource(R.string.main_settings_orientation_landscape)
    "portrait" -> stringResource(R.string.main_settings_orientation_portrait)
    else -> stringResource(R.string.main_settings_orientation_auto)
  }
  val nextValue = when (currentLock) {
    "auto" -> "landscape"
    "landscape" -> "portrait"
    else -> "auto"
  }

  Row(
    modifier = modifier
      .fillMaxWidth()
      .sizeIn(minHeight = 76.dp)
      .clickable { onSetOrientationLock(nextValue) }
      .testTag("main_settings_orientation_lock"),
    horizontalArrangement = Arrangement.SpaceBetween,
    verticalAlignment = Alignment.CenterVertically,
  ) {
    Text(
      text = stringResource(R.string.main_settings_orientation_lock),
      style = DashboardTypography.itemTitle,
      color = theme.primaryTextColor,
    )
    Text(
      text = displayValue,
      style = DashboardTypography.description,
      color = theme.secondaryTextColor,
    )
  }
}
```

5. **Wire into the MainSettings Column** layout. Insert `AppIntroHeader` before the first
   SectionHeader, and insert `OrientationLockRow` in the Behavior section after the
   "Keep Screen On" toggle row:

```kotlin
// At top of scrollable Column content:
AppIntroHeader(versionName = versionName, theme = theme)

// In Section 2: Behavior, after ToggleRow for keepScreenOn:
OrientationLockRow(
  currentLock = orientationLock,
  onSetOrientationLock = onSetOrientationLock,
  theme = theme,
)
```

6. **Update the OverlayNavHost call site** for MainSettings to pass the new parameters. In
   `android/feature/dashboard/src/main/kotlin/app/dqxn/android/feature/dashboard/layer/OverlayNavHost.kt`,
   add `orientationLock` and `versionName` collection and pass-through:

```kotlin
val orientationLock by mainSettingsViewModel.orientationLock.collectAsState()

MainSettings(
  // ... existing params ...
  orientationLock = orientationLock,
  versionName = "1.0.0", // TODO: Inject from BuildConfig when available from :app
  onSetOrientationLock = mainSettingsViewModel::setOrientationLock,
  // ... rest unchanged ...
)
```

For `versionName`, since `BuildConfig.VERSION_NAME` is only available in `:app` module and
`:feature:dashboard` cannot access it directly, pass it as a parameter. The simplest approach is
to add a `versionName: String` parameter to `OverlayNavHost` and pass it from `DashboardScreen`.
In DashboardScreen (which is in `:feature:dashboard`), read it from the provided `BuildConfig`
or hardcode "1.0.0" as a placeholder until proper injection is set up.

**Alternative:** Use `PackageManager.getPackageInfo()` via a `@Singleton` provider. But for V1,
a simple string parameter threaded from `:app` is sufficient.
  </action>
  <verify>
    <automated>cd android && ./gradlew :feature:settings:compileDebugKotlin :feature:dashboard:compileDebugKotlin --console=plain 2>&1 | tail -5</automated>
  </verify>
  <done>
    - AppIntroHeader renders at top of MainSettings with app name, tagline, attribution, version
    - OrientationLockRow renders in Behavior section with cycle-on-click
    - New string resources added
    - OverlayNavHost passes new params
    - Compiles successfully
  </done>
</task>

<task type="auto">
  <name>Task 2: Add tests for AppIntroHeader and OrientationLockRow</name>
  <files>
    android/feature/settings/src/test/kotlin/app/dqxn/android/feature/settings/main/MainSettingsAppIntroTest.kt
  </files>
  <action>
Create tests verifying the new UI elements:

```kotlin
package app.dqxn.android.feature.settings.main

import com.google.common.truth.Truth.assertThat
import org.junit.jupiter.api.Test
import java.io.File

class MainSettingsAppIntroTest {

    private val projectDir = File(System.getProperty("user.dir"))

    @Test
    fun `MainSettings contains AppIntroHeader`() {
        val file = File(
            projectDir,
            "feature/settings/src/main/kotlin/app/dqxn/android/feature/settings/main/MainSettings.kt"
        )
        val content = file.readText()
        assertThat(content).contains("AppIntroHeader")
        assertThat(content).contains("app_intro_header")
    }

    @Test
    fun `MainSettings contains OrientationLockRow`() {
        val file = File(
            projectDir,
            "feature/settings/src/main/kotlin/app/dqxn/android/feature/settings/main/MainSettings.kt"
        )
        val content = file.readText()
        assertThat(content).contains("OrientationLockRow")
        assertThat(content).contains("main_settings_orientation_lock")
    }

    @Test
    fun `MainSettings accepts orientationLock parameter`() {
        val file = File(
            projectDir,
            "feature/settings/src/main/kotlin/app/dqxn/android/feature/settings/main/MainSettings.kt"
        )
        val content = file.readText()
        assertThat(content).contains("orientationLock: String")
        assertThat(content).contains("onSetOrientationLock:")
    }

    @Test
    fun `MainSettings accepts versionName parameter`() {
        val file = File(
            projectDir,
            "feature/settings/src/main/kotlin/app/dqxn/android/feature/settings/main/MainSettings.kt"
        )
        val content = file.readText()
        assertThat(content).contains("versionName: String")
    }

    @Test
    fun `string resources contain tagline and orientation labels`() {
        val strings = File(
            projectDir,
            "feature/settings/src/main/res/values/strings.xml"
        )
        val content = strings.readText()
        assertThat(content).contains("main_settings_tagline")
        assertThat(content).contains("Life is a dash")
        assertThat(content).contains("main_settings_orientation_auto")
        assertThat(content).contains("main_settings_orientation_landscape")
        assertThat(content).contains("main_settings_orientation_portrait")
    }

    @Test
    fun `OrientationLockRow cycles through auto landscape portrait`() {
        val file = File(
            projectDir,
            "feature/settings/src/main/kotlin/app/dqxn/android/feature/settings/main/MainSettings.kt"
        )
        val content = file.readText()
        // Verify the cycle logic exists
        assertThat(content).contains("\"auto\" -> \"landscape\"")
        assertThat(content).contains("\"landscape\" -> \"portrait\"")
    }
}
```

Also update any existing MainSettings tests that call `MainSettings(...)` directly to include
the new parameters. Check `MainSettingsTest.kt` or `MainSettingsViewModelTest.kt` for call sites.
  </action>
  <verify>
    <automated>cd android && ./gradlew :feature:settings:testDebugUnitTest --tests "*.MainSettingsAppIntroTest" --console=plain 2>&1 | tail -10</automated>
  </verify>
  <done>
    - All 6 tests pass
    - AppIntroHeader presence verified
    - OrientationLockRow presence verified
    - Parameter additions verified
    - String resources verified
    - Cycle logic verified
  </done>
</task>

</tasks>

<verification>
1. `cd android && ./gradlew :feature:settings:compileDebugKotlin --console=plain` -- compiles
2. `cd android && ./gradlew :feature:settings:testDebugUnitTest --tests "*.MainSettingsAppIntroTest" --console=plain` -- all tests pass
3. `cd android && ./gradlew :feature:settings:testDebugUnitTest --console=plain` -- no regressions
4. `cd android && ./gradlew :feature:dashboard:compileDebugKotlin --console=plain` -- OverlayNavHost compiles with new params
</verification>

<success_criteria>
- AppIntroHeader composable renders app name, tagline, attribution, and version
- OrientationLockRow renders in Behavior section
- Orientation lock cycles: auto -> landscape -> portrait -> auto
- String resources added for tagline, attribution, version format, orientation labels
- OverlayNavHost passes orientationLock and versionName to MainSettings
- All tests pass including existing MainSettings tests
</success_criteria>

<output>
After completion, create `.planning/phases/14-ui-visual-interactive-parity/14-09-SUMMARY.md`
</output>
