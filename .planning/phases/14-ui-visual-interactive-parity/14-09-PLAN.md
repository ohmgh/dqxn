---
phase: 14-ui-visual-interactive-parity
plan: 09
type: execute
wave: 1
depends_on: []
files_modified:
  - android/feature/settings/src/main/kotlin/app/dqxn/android/feature/settings/main/MainSettings.kt
  - android/feature/settings/src/main/res/values/strings.xml
  - android/feature/settings/src/test/kotlin/app/dqxn/android/feature/settings/main/MainSettingsTest.kt
autonomous: true
requirements: [F1.9]

must_haves:
  truths:
    - "About App banner is the first item in settings with cyber-dog logo, tagline, attribution, app name, and version"
    - "MainSettings item order matches old codebase: About Banner → Divider → Dash Packs → Divider → Theme Items → Divider → Show Status Bar → Divider → Reset Dash"
    - "Settings items with navigation arrows show icons in 40dp rounded-square box with accentColor tint"
    - "Each settings item has a subtitle/description below the label"
    - "Dash Packs row shows dynamic count subtitle ($packCount packs, $themeCount themes, $widgetCount widgets, $providerCount providers)"
    - "Reset Dash row has red text and subtitle 'Restore default layout and theme'"
    - "Show Status Bar has subtitle 'Applies to current dash'"
  artifacts:
    - path: "android/feature/settings/src/main/kotlin/app/dqxn/android/feature/settings/main/MainSettings.kt"
      provides: "Reordered MainSettings with icons, descriptions, About banner, and old codebase item order"
      contains: "AboutAppBanner"
    - path: "android/feature/settings/src/test/kotlin/app/dqxn/android/feature/settings/main/MainSettingsTest.kt"
      provides: "Tests for item order, icons, descriptions, About banner"
  key_links:
    - from: "MainSettings.kt"
      to: "DashboardThemeDefinition"
      via: "accentColor used for icon tinting"
      pattern: "accentColor"
---

<objective>
Reorder MainSettings to match old codebase item order, add icons and descriptions to rows, add About App banner.

Purpose: Current MainSettings has a 4-section layout (Appearance, Behavior, Data & Privacy, Danger Zone) with no icons, minimal descriptions, and wrong item order. The old codebase had a flat list: About Banner -> Dash Packs -> Theme Items -> Status Bar -> Reset Dash. Each row had an icon in a 40dp rounded-square box with accent-tinted icon. This plan restores visual parity with old codebase settings while keeping the new architecture's data flow.

Output: MainSettings.kt with old codebase visual layout, icons, descriptions, About banner, correct item order.
</objective>

<execution_context>
@/Users/ohm/.claude/get-shit-done/workflows/execute-plan.md
@/Users/ohm/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@android/feature/settings/src/main/kotlin/app/dqxn/android/feature/settings/main/MainSettings.kt
@android/feature/settings/src/main/res/values/strings.xml

<interfaces>
<!-- Old codebase MainSettingsContent.kt item order:
     1. About App Banner -- cyber-dog logo + "Life is a dash. Make it beautiful." + "-- The Dashing Dachshund" + "DQXN" + version
     2. HorizontalDivider
     3. "Dash Packs" -- icon: Icons.Default.Dashboard, subtitle: "$packCount packs, $themeCount themes, $widgetCount widgets, $providerCount providers"
     4. HorizontalDivider
     5. Theme Items Group (4dp spacing between):
        - "Theme Mode" -- icon: Icons.Default.SettingsBrightness, subtitle: autoSwitchMode.description
        - "Light Theme" -- icon: Icons.Default.LightMode, subtitle: lightThemeName
        - "Dark Theme" -- icon: Icons.Default.DarkMode, subtitle: darkThemeName
     6. HorizontalDivider
     7. "Show Status Bar" -- no icon, subtitle: "Applies to current dash" (toggle)
     8. HorizontalDivider
     9. "Reset Dash" -- no icon, subtitle: "Restore default layout and theme", red text
-->

<!-- Old SettingsItem composable:
     - icon rendered in 40dp rounded-square box, accentColor.copy(alpha = 0.1f) background,
       24dp icon tinted accentColor
     - Has showArrow param (defaults false)
     - Navigation items show ChevronRight arrow
-->

<!-- Current MainSettings has:
     - Appearance: Theme Mode, Status Bar toggle
     - Behavior: Keep Screen On, Dash Packs
     - Data & Privacy: Analytics, Diagnostics
     - Danger Zone: Delete All Data
     - NO icons on any row
     - NO About banner
     - Delete All Data is prominent, Reset Dash doesn't exist separately
-->

<!-- Note: Plan 14-06 adds lightThemeName, darkThemeName, onNavigateToLightTheme,
     onNavigateToDarkTheme params. This plan must be COMPATIBLE with those additions.
     Since both plans are wave 1 (parallel), the executor must reconcile if both modify
     MainSettings.kt. The approach: this plan restructures the layout, 14-06 adds the
     new params. If file conflict occurs, executor merges. -->

<!-- DashboardThemeDefinition.accentColor used for icon tinting in SettingsItem icon box -->
</interfaces>
</context>

<tasks>

<task type="auto">
  <name>Task 1: Restructure MainSettings layout with old codebase item order, icons, and About banner</name>
  <files>
    android/feature/settings/src/main/kotlin/app/dqxn/android/feature/settings/main/MainSettings.kt
    android/feature/settings/src/main/res/values/strings.xml
  </files>
  <action>
**Restructure MainSettings.kt** to match old codebase item order. The key changes:

**1. Add new parameters** for pack counts and reset callback:
```kotlin
@Composable
public fun MainSettings(
    // ... existing params (analyticsConsent, showStatusBar, keepScreenOn, etc.) ...
    // NEW: pack stats for Dash Packs subtitle
    packCount: Int = 0,
    themeCount: Int = 0,
    widgetCount: Int = 0,
    providerCount: Int = 0,
    // NEW: auto-switch mode description
    autoSwitchModeDescription: String = "",
    // NEW: reset dash callback
    onResetDash: () -> Unit = {},
    // NEW: version string
    versionName: String = "",
    // ... existing callbacks ...
    modifier: Modifier = Modifier,
)
```

**2. Replace the 4-section layout** with the old codebase flat list:

Replace the entire Column content inside OverlayScaffold with:

```kotlin
Column(
    modifier = Modifier
        .fillMaxSize()
        .verticalScroll(rememberScrollState())
        .padding(horizontal = DashboardSpacing.ScreenEdgePadding)
        .testTag("main_settings_content"),
) {
    // 1. About App Banner
    AboutAppBanner(
        versionName = versionName,
        theme = theme,
    )

    SectionDivider(theme = theme)

    // 2. Dash Packs
    SettingsItemRow(
        label = stringResource(R.string.main_settings_dash_packs),
        subtitle = "$packCount packs, $themeCount themes, $widgetCount widgets, $providerCount providers",
        icon = Icons.Default.Dashboard,
        accentColor = theme.accentColor,
        theme = theme,
        showArrow = true,
        onClick = onNavigateToDashPacks,
        testTag = "main_settings_dash_packs",
    )

    SectionDivider(theme = theme)

    // 3. Theme Items Group (4dp spacing between)
    Column(verticalArrangement = Arrangement.spacedBy(4.dp)) {
        SettingsItemRow(
            label = stringResource(R.string.main_settings_theme_mode),
            subtitle = autoSwitchModeDescription,
            icon = Icons.Default.SettingsBrightness,
            accentColor = theme.accentColor,
            theme = theme,
            showArrow = true,
            onClick = onNavigateToThemeMode,
            testTag = "main_settings_theme_mode",
        )
        // NOTE: "Light Theme" and "Dark Theme" rows are added by plan 14-06.
        // If plan 14-06 has already added onNavigateToLightTheme/onNavigateToDarkTheme,
        // include them here. If not, skip -- they'll be merged when 14-06 executes.
        // The executor should check if those params already exist.
    }

    SectionDivider(theme = theme)

    // 4. Show Status Bar (toggle, no icon)
    ToggleRow(
        label = stringResource(R.string.main_settings_status_bar),
        subtitle = stringResource(R.string.main_settings_status_bar_subtitle),
        checked = showStatusBar,
        onCheckedChange = onSetShowStatusBar,
        theme = theme,
        testTag = "main_settings_status_bar",
    )

    SectionDivider(theme = theme)

    // 5. Reset Dash (red text, no icon)
    ResetDashRow(
        theme = theme,
        onClick = onResetDash,
    )

    Spacer(modifier = Modifier.height(DashboardSpacing.SpaceXL))
}
```

**IMPORTANT:** This removes the "Keep Screen On", "Analytics", "Diagnostics", and "Delete All Data" items from MainSettings. These are NOT in the old codebase's MainSettings. The "Delete All Data" functionality was not in the old settings screen. For V1 parity, keep only the items that exist in the old codebase. If the user needs analytics/diagnostics/delete-all accessible, they can be added back later. However, **if removing them breaks requirements** (F12.5 analytics consent, F14.4 delete all data), keep them in a collapsible "Advanced" section at the bottom, AFTER the Reset Dash row, behind a divider:

```kotlin
// -- Advanced (items not in old codebase but required by current requirements) --
SectionDivider(theme = theme)

SectionHeader(title = "Advanced", theme = theme)

ToggleRow(
    label = stringResource(R.string.main_settings_keep_screen_on),
    checked = keepScreenOn,
    onCheckedChange = onSetKeepScreenOn,
    theme = theme,
    testTag = "main_settings_keep_screen_on",
)

AnalyticsToggleRow(
    checked = analyticsConsent,
    onToggle = { enabled ->
        if (enabled) showAnalyticsDialog = true
        else onSetAnalyticsConsent(false)
    },
    theme = theme,
)

NavigationRow(
    label = stringResource(R.string.main_settings_diagnostics),
    theme = theme,
    onClick = onNavigateToDiagnostics,
    testTag = "main_settings_diagnostics",
)

DeleteAllDataButton(theme = theme, onClick = { showDeleteDialog = true })
```

**3. Create AboutAppBanner composable:**
```kotlin
@Composable
private fun AboutAppBanner(
    versionName: String,
    theme: DashboardThemeDefinition,
    modifier: Modifier = Modifier,
) {
    Column(
        modifier = modifier
            .fillMaxWidth()
            .padding(vertical = DashboardSpacing.SpaceL)
            .testTag("about_app_banner"),
        horizontalAlignment = Alignment.CenterHorizontally,
    ) {
        // App icon placeholder -- 64dp circle with accent background
        // (Replace with actual ic_logo_letterform when available)
        Box(
            modifier = Modifier
                .size(64.dp)
                .clip(CircleShape)
                .background(theme.accentColor.copy(alpha = 0.15f)),
            contentAlignment = Alignment.Center,
        ) {
            Text(
                text = "D",
                style = DashboardTypography.title,
                color = theme.accentColor,
            )
        }

        Spacer(modifier = Modifier.height(DashboardSpacing.SpaceS))

        // Tagline
        Text(
            text = stringResource(R.string.about_app_tagline),
            style = DashboardTypography.description,
            color = theme.primaryTextColor.copy(alpha = TextEmphasis.Medium),
        )

        // Attribution
        Text(
            text = stringResource(R.string.about_app_attribution),
            style = DashboardTypography.caption,
            color = theme.primaryTextColor.copy(alpha = TextEmphasis.Medium),
        )

        Spacer(modifier = Modifier.height(DashboardSpacing.SpaceXS))

        // App name + version
        Text(
            text = "DQXN",
            style = DashboardTypography.sectionHeader,
            color = theme.primaryTextColor,
        )

        if (versionName.isNotEmpty()) {
            Text(
                text = versionName,
                style = DashboardTypography.caption,
                color = theme.primaryTextColor.copy(alpha = TextEmphasis.Medium),
            )
        }
    }
}
```

**4. Create SettingsItemRow composable** (row with icon box + label + subtitle + optional arrow):
```kotlin
@Composable
private fun SettingsItemRow(
    label: String,
    subtitle: String,
    icon: ImageVector,
    accentColor: Color,
    theme: DashboardThemeDefinition,
    showArrow: Boolean = false,
    onClick: () -> Unit,
    testTag: String,
    modifier: Modifier = Modifier,
) {
    Row(
        modifier = modifier
            .fillMaxWidth()
            .sizeIn(minHeight = 76.dp)
            .clickable(onClick = onClick)
            .testTag(testTag),
        verticalAlignment = Alignment.CenterVertically,
        horizontalArrangement = Arrangement.spacedBy(DashboardSpacing.SpaceM),
    ) {
        // Icon in 40dp rounded-square box with accent background
        Box(
            modifier = Modifier
                .size(40.dp)
                .clip(RoundedCornerShape(8.dp))
                .background(accentColor.copy(alpha = 0.1f)),
            contentAlignment = Alignment.Center,
        ) {
            Icon(
                imageVector = icon,
                contentDescription = null,
                tint = accentColor,
                modifier = Modifier.size(24.dp),
            )
        }

        // Label + subtitle
        Column(modifier = Modifier.weight(1f)) {
            Text(
                text = label,
                style = DashboardTypography.itemTitle,
                color = theme.primaryTextColor,
            )
            Text(
                text = subtitle,
                style = DashboardTypography.description,
                color = theme.primaryTextColor.copy(alpha = TextEmphasis.Medium),
                maxLines = 1,
            )
        }

        // Navigation arrow
        if (showArrow) {
            Icon(
                imageVector = Icons.Filled.ChevronRight,
                contentDescription = null,
                tint = theme.primaryTextColor.copy(alpha = TextEmphasis.Medium),
            )
        }
    }
}
```

**5. Update ToggleRow** to accept optional subtitle:
```kotlin
@Composable
private fun ToggleRow(
    label: String,
    checked: Boolean,
    onCheckedChange: (Boolean) -> Unit,
    theme: DashboardThemeDefinition,
    testTag: String,
    subtitle: String? = null,
    modifier: Modifier = Modifier,
)
```
When subtitle is non-null, render it in a Column below label, same pattern as AnalyticsToggleRow.

**6. Create ResetDashRow composable:**
```kotlin
@Composable
private fun ResetDashRow(
    theme: DashboardThemeDefinition,
    onClick: () -> Unit,
    modifier: Modifier = Modifier,
) {
    Row(
        modifier = modifier
            .fillMaxWidth()
            .sizeIn(minHeight = 76.dp)
            .clickable(onClick = onClick)
            .testTag("main_settings_reset_dash"),
        verticalAlignment = Alignment.CenterVertically,
    ) {
        Column(modifier = Modifier.weight(1f)) {
            Text(
                text = stringResource(R.string.main_settings_reset_dash),
                style = DashboardTypography.itemTitle,
                color = SemanticColors.Error,
            )
            Text(
                text = stringResource(R.string.main_settings_reset_dash_subtitle),
                style = DashboardTypography.description,
                color = SemanticColors.Error.copy(alpha = TextEmphasis.Medium),
            )
        }
    }
}
```

**7. Add new string resources** to `android/feature/settings/src/main/res/values/strings.xml`:
```xml
<!-- About App Banner -->
<string name="about_app_tagline">Life is a dash. Make it beautiful.</string>
<string name="about_app_attribution">-- The Dashing Dachshund</string>

<!-- Settings subtitles -->
<string name="main_settings_status_bar_subtitle">Applies to current dash</string>
<string name="main_settings_reset_dash">Reset Dash</string>
<string name="main_settings_reset_dash_subtitle">Restore default layout and theme</string>
```

**8. Add new imports** to MainSettings.kt:
```kotlin
import androidx.compose.material.icons.filled.Dashboard
import androidx.compose.material.icons.filled.SettingsBrightness
import androidx.compose.ui.graphics.vector.ImageVector
import androidx.compose.foundation.shape.CircleShape
```

**9. Wire new params in OverlayNavHost.kt** -- in the Settings route composable block:
```kotlin
MainSettings(
    // ... existing params ...
    packCount = widgetRegistry.getAll().map { it.typeId.substringBefore(':') }.distinct().size,
    themeCount = allThemes.size,
    widgetCount = widgetRegistry.getAll().size,
    providerCount = dataProviderRegistry.getAll().size,
    autoSwitchModeDescription = themeCoordinator.themeState.value.autoSwitchMode.name.lowercase().replace('_', ' ').replaceFirstChar { it.uppercase() },
    versionName = "", // TODO: inject BuildConfig.VERSION_NAME via ViewModel
    onResetDash = { onCommand(DashboardCommand.ResetLayout) },
)
```

Check if `DashboardCommand.ResetLayout` exists -- if not, check for `ResetDash` or similar. If it doesn't exist, create a `DashboardCommand.ResetLayout` sealed variant. The LayoutRepository already has reset-to-default functionality from its `clearAll()` method, but a specific `ResetLayout` command may be needed vs full delete. The executor should check what commands exist and wire appropriately.
  </action>
  <verify>
    <automated>cd android && ./gradlew :feature:settings:compileDebugKotlin :feature:dashboard:compileDebugKotlin --console=plain 2>&1 | tail -10</automated>
  </verify>
  <done>
    - MainSettings restructured with old codebase item order
    - About App banner with tagline, attribution, app name, version
    - Dash Packs row with dynamic count subtitle and Dashboard icon
    - Theme Mode row with SettingsBrightness icon and mode description subtitle
    - Show Status Bar with "Applies to current dash" subtitle
    - Reset Dash with red text and "Restore default layout and theme" subtitle
    - SettingsItemRow with 40dp icon box, accentColor tint, arrow support
    - Advanced section at bottom for analytics/diagnostics/delete-all (preserved for requirements)
    - All new string resources added
    - Compiles successfully
  </done>
</task>

<task type="auto">
  <name>Task 2: Add MainSettings tests for new layout</name>
  <files>
    android/feature/settings/src/test/kotlin/app/dqxn/android/feature/settings/main/MainSettingsTest.kt
  </files>
  <action>
Update or add tests in MainSettingsTest.kt to verify the restructured layout:

**1. Update the test helper function** to include new params:
```kotlin
private fun createMainSettings(
    // ... existing params ...
    packCount: Int = 3,
    themeCount: Int = 24,
    widgetCount: Int = 13,
    providerCount: Int = 9,
    autoSwitchModeDescription: String = "System",
    versionName: String = "1.0.0",
    onResetDash: () -> Unit = {},
) { ... }
```

**2. Add new tests:**

```kotlin
@Test
fun `about app banner is displayed`() {
    composeTestRule.setContent { createMainSettings() }
    composeTestRule.onNodeWithTag("about_app_banner").assertExists()
}

@Test
fun `about app banner shows tagline`() {
    composeTestRule.setContent { createMainSettings() }
    composeTestRule.onNodeWithText("Life is a dash. Make it beautiful.").assertExists()
}

@Test
fun `about app banner shows app name`() {
    composeTestRule.setContent { createMainSettings() }
    composeTestRule.onNodeWithText("DQXN").assertExists()
}

@Test
fun `about app banner shows version`() {
    composeTestRule.setContent { createMainSettings(versionName = "1.0.0") }
    composeTestRule.onNodeWithText("1.0.0").assertExists()
}

@Test
fun `dash packs row shows dynamic count subtitle`() {
    composeTestRule.setContent {
        createMainSettings(
            packCount = 3,
            themeCount = 24,
            widgetCount = 13,
            providerCount = 9,
        )
    }
    composeTestRule.onNodeWithText("3 packs, 24 themes, 13 widgets, 9 providers")
        .assertExists()
}

@Test
fun `status bar row shows subtitle`() {
    composeTestRule.setContent { createMainSettings() }
    composeTestRule.onNodeWithText("Applies to current dash").assertExists()
}

@Test
fun `reset dash row exists with red styling`() {
    composeTestRule.setContent { createMainSettings() }
    composeTestRule.onNodeWithTag("main_settings_reset_dash").assertExists()
    composeTestRule.onNodeWithText("Reset Dash").assertExists()
    composeTestRule.onNodeWithText("Restore default layout and theme").assertExists()
}

@Test
fun `reset dash row triggers callback on click`() {
    var resetCalled = false
    composeTestRule.setContent { createMainSettings(onResetDash = { resetCalled = true }) }
    composeTestRule.onNodeWithTag("main_settings_reset_dash").performClick()
    assertThat(resetCalled).isTrue()
}

@Test
fun `item order matches old codebase`() {
    // Verify About banner appears before Dash Packs
    composeTestRule.setContent { createMainSettings() }
    val aboutBanner = composeTestRule.onNodeWithTag("about_app_banner")
    val dashPacks = composeTestRule.onNodeWithTag("main_settings_dash_packs")
    val themeMode = composeTestRule.onNodeWithTag("main_settings_theme_mode")
    val statusBar = composeTestRule.onNodeWithTag("main_settings_status_bar")
    val resetDash = composeTestRule.onNodeWithTag("main_settings_reset_dash")

    // All exist
    aboutBanner.assertExists()
    dashPacks.assertExists()
    themeMode.assertExists()
    statusBar.assertExists()
    resetDash.assertExists()
}
```

**3. Source-based layout verification test** (structural, like other Phase 14 plans):
```kotlin
@Test
fun `settings item rows have icon box styling`() {
    val file = File(
        System.getProperty("user.dir"),
        "feature/settings/src/main/kotlin/app/dqxn/android/feature/settings/main/MainSettings.kt"
    )
    val content = file.readText()
    // Icon box: 40dp rounded-square with accent background
    assertThat(content).contains("40.dp")
    assertThat(content).contains("accentColor.copy(alpha = 0.1f)")
    // About banner exists
    assertThat(content).contains("AboutAppBanner")
    assertThat(content).contains("about_app_banner")
    // Reset Dash row
    assertThat(content).contains("Reset Dash")
    assertThat(content).contains("main_settings_reset_dash")
}
```
  </action>
  <verify>
    <automated>cd android && ./gradlew :feature:settings:testDebugUnitTest --tests "*.MainSettingsTest" --console=plain 2>&1 | tail -10</automated>
  </verify>
  <done>
    - All MainSettingsTest tests pass including new layout tests
    - About App banner verified (tagline, attribution, app name, version)
    - Dash Packs dynamic subtitle verified
    - Status bar subtitle verified
    - Reset Dash row verified with click callback
    - Item order verified
    - Icon box styling verified
  </done>
</task>

</tasks>

<verification>
1. `cd android && ./gradlew :feature:settings:compileDebugKotlin --console=plain` -- compiles
2. `cd android && ./gradlew :feature:settings:testDebugUnitTest --tests "*.MainSettingsTest" --console=plain` -- all tests pass
3. `cd android && ./gradlew :feature:dashboard:compileDebugKotlin --console=plain` -- OverlayNavHost still compiles with new params
4. `cd android && ./gradlew :feature:settings:testDebugUnitTest --console=plain` -- no regressions
</verification>

<success_criteria>
- About App banner displayed first with tagline, attribution, DQXN, version
- MainSettings item order: About -> Dash Packs -> Theme Items -> Status Bar -> Reset Dash -> Advanced
- Settings items have icons in 40dp accent-tinted rounded-square box
- Each item has subtitle/description
- Dash Packs shows dynamic pack counts
- Reset Dash has red text
- All existing functionality preserved in Advanced section
- All tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/14-ui-visual-interactive-parity/14-09-SUMMARY.md`
</output>
