---
phase: 14-ui-visual-interactive-parity
plan: 11
type: execute
wave: 1
depends_on: []
files_modified:
  - android/feature/onboarding/src/main/kotlin/app/dqxn/android/feature/onboarding/FirstRunFlow.kt
  - android/feature/onboarding/src/main/kotlin/app/dqxn/android/feature/onboarding/AnalyticsConsentStep.kt
  - android/feature/onboarding/src/main/kotlin/app/dqxn/android/feature/onboarding/FirstLaunchDisclaimer.kt
  - android/feature/onboarding/src/test/kotlin/app/dqxn/android/feature/onboarding/FirstRunFlowTest.kt
autonomous: true
requirements: [F11.1, F11.2]

must_haves:
  truths:
    - "FirstRunFlow uses OnboardingNavigationBar (modeled after SetupNavigationBar) with back/next/done buttons + page indicator dots"
    - "OnboardingNavigationBar uses dashboard theme tokens: theme.accentColor for dots and buttons, DashboardTypography.label for button text, DashboardSpacing.SpaceS for padding, DashboardSpacing.SpaceXS for dot spacing"
    - "OnboardingNavigationBar buttons have 76dp minimum touch targets (sizeIn minWidth/minHeight)"
    - "OnboardingNavigationBar back button hidden (alpha 0f) on page 0, visible on pages 1+"
    - "FirstRunFlow AnimatedContent slide transitions use directional factor (targetState > initialState) matching SetupSheet pattern"
    - "Per-page composables no longer own their own Next/Continue/Done/Skip buttons -- navigation is centralized in OnboardingNavigationBar"
    - "AnalyticsConsentStep uses DashboardTypography.title (not MaterialTheme.typography.headlineMedium), DashboardSpacing.ScreenEdgePadding (not 24.dp), theme.primaryTextColor"
    - "AnalyticsConsentStep uses theme.accentColor for primary button, theme.secondaryTextColor for skip button"
    - "FirstLaunchDisclaimer uses DashboardTypography.description (not MaterialTheme.typography.bodyMedium), DashboardSpacing.ScreenEdgePadding (not 24.dp), theme.primaryTextColor"
    - "ThemeSelectionStep uses DashboardTypography.title for title, DashboardSpacing.ScreenEdgePadding for padding, theme tokens for ThemeCard styling"
    - "ThemeCard uses theme.accentColor for selected border (not MaterialTheme.colorScheme.primaryContainer), theme.widgetBorderColor.copy(alpha=0.1f) for unselected background"
    - "EditModeTourStep uses DashboardTypography.title for title, DashboardTypography.description for card text, DashboardSpacing tokens for all spacing"
    - "TourCard uses theme.widgetBorderColor.copy(alpha=0.1f) background (not Card/CardDefaults), CardSize.MEDIUM.cornerRadius shape"
    - "PageIndicator removed from FirstRunFlow -- replaced by dots in OnboardingNavigationBar"
    - "Zero MaterialTheme.typography references remain in :feature:onboarding module"
    - "Zero MaterialTheme.colorScheme references remain in :feature:onboarding module"
    - "Zero hardcoded dp literal padding (24.dp, 16.dp, 12.dp) remains -- all use DashboardSpacing tokens"
  artifacts:
    - path: "android/feature/onboarding/src/main/kotlin/app/dqxn/android/feature/onboarding/FirstRunFlow.kt"
      provides: "Setup-schema-style onboarding flow with OnboardingNavigationBar and dashboard theme tokens"
      contains: "OnboardingNavigationBar"
    - path: "android/feature/onboarding/src/test/kotlin/app/dqxn/android/feature/onboarding/FirstRunFlowTest.kt"
      provides: "Tests for navigation bar, dashboard token usage, no MaterialTheme references"
      contains: "onboarding_nav_bar"
---

<objective>
Migrate onboarding to setup schema navigation pattern and dashboard theme tokens.

Purpose: Current FirstRunFlow uses its own ad-hoc navigation (per-page buttons, custom PageIndicator), MaterialTheme.typography/colorScheme throughout, Card/CardDefaults from Material 3, and hardcoded dp values. This plan restructures navigation to match the SetupSheet pattern (centralized navigation bar with back/next/done + page indicator dots) and replaces ALL Material 3 theme references with dashboard design tokens from `:core:design`.

Output: Restructured FirstRunFlow.kt with OnboardingNavigationBar, re-themed AnalyticsConsentStep.kt, re-themed FirstLaunchDisclaimer.kt, updated FirstRunFlowTest.kt.
</objective>

<execution_context>
@/Users/ohm/.claude/get-shit-done/workflows/execute-plan.md
@/Users/ohm/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@android/feature/onboarding/src/main/kotlin/app/dqxn/android/feature/onboarding/FirstRunFlow.kt
@android/feature/onboarding/src/main/kotlin/app/dqxn/android/feature/onboarding/AnalyticsConsentStep.kt
@android/feature/onboarding/src/main/kotlin/app/dqxn/android/feature/onboarding/FirstLaunchDisclaimer.kt
@android/feature/onboarding/src/test/kotlin/app/dqxn/android/feature/onboarding/FirstRunFlowTest.kt
@android/feature/settings/src/main/kotlin/app/dqxn/android/feature/settings/setup/SetupNavigationBar.kt

<interfaces>
<!-- SetupNavigationBar pattern to replicate (from :feature:settings:setup):
     - Row with back button (hidden page 0) + page dots + next/done button
     - Back: Icons.AutoMirrored.Filled.ArrowBack, alpha 0f on page 0, clickable only when > 0
     - Dots: 8.dp circles, accentColor for current, secondaryTextColor.copy(alpha=Disabled) for others
     - Next: "Next" text + ArrowForward icon, alpha-dimmed 0.5f when gated
     - Done: "Done" text + Check icon, alpha-dimmed 0.5f when gated
     - All buttons: sizeIn(minWidth=76.dp, minHeight=76.dp)
     - Uses: DashboardTypography.label, DashboardSpacing.SpaceS, DashboardSpacing.SpaceXS, DashboardSpacing.SpaceXXS
     - Uses: LocalDashboardTheme.current for theme, TextEmphasis.Medium for back icon tint
-->

<!-- Dashboard design tokens available in :core:design:
     DashboardTypography: title(17sp), sectionHeader(13sp), itemTitle(15sp), label(14sp), description(13sp), caption(11sp)
     DashboardSpacing: SpaceXXS(4dp), SpaceXS(8dp), SpaceS(12dp), SpaceM(16dp), SpaceL(24dp), SpaceXL(48dp), ScreenEdgePadding(16dp), ItemGap(8dp), SectionGap(16dp)
     TextEmphasis: High(1.0f), Medium(0.7f), Disabled(0.4f)
     CardSize: SMALL(8dp corner), MEDIUM(12dp corner), LARGE(16dp corner)
     LocalDashboardTheme.current -> DashboardThemeDefinition with: primaryTextColor, secondaryTextColor, accentColor, highlightColor, widgetBorderColor, backgroundBrush, widgetBackgroundBrush
-->

<!-- Current onboarding per-page navigation (to remove/centralize):
     - AnalyticsConsentStep: own "Enable Analytics" Button + "Skip" OutlinedButton (keep as consent CHOICE, not navigation)
     - FirstLaunchDisclaimer: own "Got it" Button (REMOVE -- nav bar handles page advancement)
     - ThemeSelectionStep: own "Continue" Button (REMOVE -- nav bar handles page advancement)
     - EditModeTourStep: own "Done" Button (REMOVE -- nav bar handles completion)
     Per-page buttons for page advancement get removed. Navigation is centralized in OnboardingNavigationBar.
     AnalyticsConsentStep retains its consent/skip buttons for the CHOICE itself (not for navigation).
-->

<!-- Current MaterialTheme usage to replace:
     FirstRunFlow.kt:
       - PageIndicator: MaterialTheme.colorScheme.primary, MaterialTheme.colorScheme.outlineVariant
       - ThemeCard: CardDefaults.cardColors, MaterialTheme.colorScheme.primaryContainer, MaterialTheme.colorScheme.surfaceVariant, MaterialTheme.colorScheme.onSurfaceVariant
       - ThemeSelectionStep: MaterialTheme.typography.headlineMedium, hardcoded 24.dp
       - EditModeTourStep: MaterialTheme.typography.headlineMedium, hardcoded 24.dp/12.dp
       - TourCard: Card(modifier), MaterialTheme.typography.bodyMedium, hardcoded 16.dp
     AnalyticsConsentStep.kt:
       - MaterialTheme.typography.headlineMedium, MaterialTheme.typography.bodyMedium
       - Button (Material 3 default styling), OutlinedButton
       - Hardcoded 24.dp, 16.dp, 12.dp padding
     FirstLaunchDisclaimer.kt:
       - MaterialTheme.typography.bodyMedium
       - Button (Material 3 default styling)
       - Hardcoded 24.dp, 16.dp padding
-->

<!-- Gating model for onboarding pages:
     All pages are always satisfiable (no permission/setup gating).
     OnboardingNavigationBar isPageSatisfied = true always.
-->

<!-- FirstLaunchDisclaimer.kt signature change:
     Remove onDismiss parameter -- nav bar handles page advancement.
     The onDismissDisclaimer() side effect fires in FirstRunFlow's onNext handler
     when advancing past page 1.
-->
</interfaces>
</context>

<tasks>

<task type="auto">
  <name>Task 1: Restructure FirstRunFlow navigation + replace all dashboard theme tokens</name>
  <files>
    android/feature/onboarding/src/main/kotlin/app/dqxn/android/feature/onboarding/FirstRunFlow.kt
    android/feature/onboarding/src/main/kotlin/app/dqxn/android/feature/onboarding/AnalyticsConsentStep.kt
    android/feature/onboarding/src/main/kotlin/app/dqxn/android/feature/onboarding/FirstLaunchDisclaimer.kt
  </files>
  <action>
**A. Restructure FirstRunFlow.kt:**

**1. Add imports and remove old ones:**
```kotlin
// ADD:
import app.dqxn.android.core.design.token.CardSize
import app.dqxn.android.core.design.token.DashboardSpacing
import app.dqxn.android.core.design.token.DashboardTypography
import app.dqxn.android.core.design.token.TextEmphasis
import app.dqxn.android.sdk.ui.theme.LocalDashboardTheme
import androidx.compose.foundation.border
import androidx.compose.foundation.layout.sizeIn
import androidx.compose.foundation.shape.RoundedCornerShape
import androidx.compose.material.icons.Icons
import androidx.compose.material.icons.automirrored.filled.ArrowBack
import androidx.compose.material.icons.automirrored.filled.ArrowForward
import androidx.compose.material.icons.filled.Check
import androidx.compose.material3.Icon
import androidx.compose.ui.draw.alpha
import androidx.compose.ui.graphics.Color
import androidx.compose.ui.semantics.Role
import androidx.compose.ui.semantics.role
import androidx.compose.ui.semantics.semantics

// REMOVE:
import androidx.compose.material3.Card
import androidx.compose.material3.CardDefaults
import androidx.compose.material3.MaterialTheme
import androidx.compose.material3.Button
```

**2. Replace AnimatedContent transition spec** with the SetupSheet directional pattern. Remove the `previousPage` state variable and all `previousPage = N` assignments:
```kotlin
// DELETE: var previousPage by rememberSaveable { mutableIntStateOf(0) }
// DELETE: val isForward = currentPage >= previousPage

AnimatedContent(
    targetState = currentPage,
    modifier = Modifier.weight(1f),
    transitionSpec = {
        val direction = if (targetState > initialState) 1 else -1
        slideInHorizontally { fullWidth -> direction * fullWidth } togetherWith
            slideOutHorizontally { fullWidth -> -direction * fullWidth }
    },
    label = "onboarding_page",
) { page -> ... }
```

**3. Update the when block** -- per-page composables no longer trigger page advancement:
```kotlin
when (page) {
    0 -> AnalyticsConsentStep(
        onConsent = { enabled -> onConsent(enabled) },
        modifier = Modifier.fillMaxSize(),
    )
    1 -> FirstLaunchDisclaimer(
        modifier = Modifier.fillMaxSize(),
    )
    2 -> ThemeSelectionStep(
        freeThemes = freeThemes,
        selectedThemeId = selectedThemeId,
        onSelectTheme = { themeId ->
            selectedThemeId = themeId
            onSelectTheme(themeId)
        },
        modifier = Modifier.fillMaxSize(),
    )
    3 -> EditModeTourStep(
        modifier = Modifier.fillMaxSize(),
    )
}
```

**4. Delete PageIndicator call and composable.** Replace with OnboardingNavigationBar at bottom of Column:
```kotlin
// REPLACE the PageIndicator call with:
OnboardingNavigationBar(
    currentPage = currentPage,
    totalPages = TOTAL_PAGES,
    isPageSatisfied = true,  // all onboarding pages always satisfiable
    onBack = { currentPage-- },
    onNext = {
        // Fire page-specific side effects on advancement
        when (currentPage) {
            1 -> onDismissDisclaimer()
        }
        currentPage++
    },
    onDone = onComplete,
)
```

**5. Delete the PageIndicator composable function** entirely.

**6. Create OnboardingNavigationBar** (mirrors SetupNavigationBar pattern exactly):
```kotlin
/**
 * Navigation bar for onboarding flow, modeled after [SetupNavigationBar].
 *
 * Back button (hidden page 0) + page indicator dots + Next/Done button.
 * All buttons: 76dp min touch targets (F10.4). Alpha-dimmed when gated (not disabled).
 */
@Composable
private fun OnboardingNavigationBar(
    currentPage: Int,
    totalPages: Int,
    isPageSatisfied: Boolean,
    onBack: () -> Unit,
    onNext: () -> Unit,
    onDone: () -> Unit,
    modifier: Modifier = Modifier,
) {
    val theme = LocalDashboardTheme.current
    val isLastPage = currentPage >= totalPages - 1

    Row(
        modifier = modifier
            .fillMaxWidth()
            .padding(vertical = DashboardSpacing.SpaceS)
            .testTag("onboarding_nav_bar"),
        horizontalArrangement = Arrangement.SpaceBetween,
        verticalAlignment = Alignment.CenterVertically,
    ) {
        // Back button -- invisible on page 0
        Box(
            modifier = Modifier
                .sizeIn(minWidth = 76.dp, minHeight = 76.dp)
                .testTag("onboarding_back_button")
                .alpha(if (currentPage > 0) 1f else 0f)
                .then(
                    if (currentPage > 0) {
                        Modifier
                            .semantics { role = Role.Button }
                            .clickable(onClick = onBack)
                    } else {
                        Modifier
                    },
                ),
            contentAlignment = Alignment.Center,
        ) {
            Icon(
                imageVector = Icons.AutoMirrored.Filled.ArrowBack,
                contentDescription = "Back",
                tint = theme.primaryTextColor.copy(alpha = TextEmphasis.Medium),
            )
        }

        // Page indicator dots
        Row(
            horizontalArrangement = Arrangement.spacedBy(DashboardSpacing.SpaceXS),
            verticalAlignment = Alignment.CenterVertically,
        ) {
            repeat(totalPages) { index ->
                Box(
                    modifier = Modifier
                        .testTag("onboarding_page_dot_$index")
                        .size(8.dp)
                        .background(
                            color = if (index == currentPage) {
                                theme.accentColor
                            } else {
                                theme.secondaryTextColor.copy(alpha = TextEmphasis.Disabled)
                            },
                            shape = CircleShape,
                        ),
                )
            }
        }

        // Next / Done button
        if (isLastPage) {
            Box(
                modifier = Modifier
                    .sizeIn(minWidth = 76.dp, minHeight = 76.dp)
                    .testTag("onboarding_done_button")
                    .alpha(if (isPageSatisfied) 1f else 0.5f)
                    .semantics { role = Role.Button }
                    .clickable(onClick = onDone),
                contentAlignment = Alignment.Center,
            ) {
                Row(
                    horizontalArrangement = Arrangement.spacedBy(DashboardSpacing.SpaceXXS),
                    verticalAlignment = Alignment.CenterVertically,
                ) {
                    Text(
                        text = "Done",
                        style = DashboardTypography.label,
                        color = theme.accentColor,
                    )
                    Icon(
                        imageVector = Icons.Filled.Check,
                        contentDescription = "Done",
                        tint = theme.accentColor,
                    )
                }
            }
        } else {
            Box(
                modifier = Modifier
                    .sizeIn(minWidth = 76.dp, minHeight = 76.dp)
                    .testTag("onboarding_next_button")
                    .alpha(if (isPageSatisfied) 1f else 0.5f)
                    .semantics { role = Role.Button }
                    .clickable(onClick = onNext),
                contentAlignment = Alignment.Center,
            ) {
                Row(
                    horizontalArrangement = Arrangement.spacedBy(DashboardSpacing.SpaceXXS),
                    verticalAlignment = Alignment.CenterVertically,
                ) {
                    Text(
                        text = "Next",
                        style = DashboardTypography.label,
                        color = theme.accentColor,
                    )
                    Icon(
                        imageVector = Icons.AutoMirrored.Filled.ArrowForward,
                        contentDescription = "Next",
                        tint = theme.accentColor,
                    )
                }
            }
        }
    }
}
```

**7. Rework ThemeSelectionStep** -- remove `onContinue` param, replace all MaterialTheme with dashboard tokens:
```kotlin
@OptIn(ExperimentalLayoutApi::class)
@Composable
private fun ThemeSelectionStep(
    freeThemes: ImmutableList<DashboardThemeDefinition>,
    selectedThemeId: String?,
    onSelectTheme: (String) -> Unit,
    modifier: Modifier = Modifier,
) {
    val theme = LocalDashboardTheme.current

    Column(
        modifier = modifier
            .testTag("theme_selection_step")
            .padding(DashboardSpacing.ScreenEdgePadding),
        horizontalAlignment = Alignment.CenterHorizontally,
    ) {
        Text(
            text = stringResource(R.string.onboarding_theme_title),
            style = DashboardTypography.title,
            color = theme.primaryTextColor,
        )

        Spacer(modifier = Modifier.height(DashboardSpacing.SpaceL))

        FlowRow(
            horizontalArrangement = Arrangement.spacedBy(DashboardSpacing.SpaceS),
            verticalArrangement = Arrangement.spacedBy(DashboardSpacing.SpaceS),
            modifier = Modifier.fillMaxWidth(),
        ) {
            freeThemes.forEach { themeItem ->
                ThemeCard(
                    theme = themeItem,
                    isSelected = themeItem.themeId == selectedThemeId,
                    onClick = { onSelectTheme(themeItem.themeId) },
                    containerTheme = theme,
                )
            }
        }

        Spacer(modifier = Modifier.weight(1f))
        // No button -- OnboardingNavigationBar handles advancement
    }
}
```

**8. Rework ThemeCard** -- replace Card/CardDefaults/MaterialTheme with themed composable matching ThemeSelector style:
```kotlin
@Composable
private fun ThemeCard(
    theme: DashboardThemeDefinition,
    isSelected: Boolean,
    onClick: () -> Unit,
    containerTheme: DashboardThemeDefinition,
    modifier: Modifier = Modifier,
) {
    val borderColor = if (isSelected) containerTheme.accentColor else Color.Transparent
    val backgroundColor = if (isSelected) containerTheme.accentColor.copy(alpha = 0.15f)
        else containerTheme.widgetBorderColor.copy(alpha = 0.1f)
    val cornerShape = RoundedCornerShape(CardSize.MEDIUM.cornerRadius)

    Column(
        modifier = modifier
            .testTag("theme_card_${theme.themeId}")
            .clip(cornerShape)
            .background(backgroundColor, cornerShape)
            .border(2.dp, borderColor, cornerShape)
            .clickable(onClick = onClick)
            .padding(DashboardSpacing.SpaceM),
    ) {
        Text(
            text = theme.displayName,
            style = DashboardTypography.itemTitle,
            color = containerTheme.primaryTextColor,
        )
        Text(
            text = if (theme.isDark) "Dark" else "Light",
            style = DashboardTypography.caption,
            color = containerTheme.secondaryTextColor,
        )
    }
}
```

**9. Rework EditModeTourStep** -- remove `onDone` param, replace MaterialTheme:
```kotlin
@Composable
private fun EditModeTourStep(
    modifier: Modifier = Modifier,
) {
    val theme = LocalDashboardTheme.current

    Column(
        modifier = modifier
            .testTag("edit_mode_tour_step")
            .padding(DashboardSpacing.ScreenEdgePadding),
        horizontalAlignment = Alignment.CenterHorizontally,
    ) {
        Text(
            text = stringResource(R.string.onboarding_tour_title),
            style = DashboardTypography.title,
            color = theme.primaryTextColor,
        )

        Spacer(modifier = Modifier.height(DashboardSpacing.SpaceL))

        TourCard(text = stringResource(R.string.onboarding_tour_edit), theme = theme)
        Spacer(modifier = Modifier.height(DashboardSpacing.SpaceS))
        TourCard(text = stringResource(R.string.onboarding_tour_move), theme = theme)
        Spacer(modifier = Modifier.height(DashboardSpacing.SpaceS))
        TourCard(text = stringResource(R.string.onboarding_tour_resize), theme = theme)

        Spacer(modifier = Modifier.weight(1f))
        // No button -- OnboardingNavigationBar handles done
    }
}
```

**10. Rework TourCard** -- replace Card with themed Box:
```kotlin
@Composable
private fun TourCard(
    text: String,
    theme: DashboardThemeDefinition,
    modifier: Modifier = Modifier,
) {
    val cornerShape = RoundedCornerShape(CardSize.MEDIUM.cornerRadius)
    Box(
        modifier = modifier
            .fillMaxWidth()
            .clip(cornerShape)
            .background(theme.widgetBorderColor.copy(alpha = 0.1f), cornerShape)
            .padding(DashboardSpacing.SpaceM),
    ) {
        Text(
            text = text,
            style = DashboardTypography.description,
            color = theme.primaryTextColor,
        )
    }
}
```

**B. Update AnalyticsConsentStep.kt:**

The consent step keeps its own Enable/Skip buttons for the consent CHOICE (not navigation). Restyle everything with dashboard tokens.

```kotlin
@Composable
public fun AnalyticsConsentStep(
    onConsent: (Boolean) -> Unit,
    modifier: Modifier = Modifier,
) {
    val theme = LocalDashboardTheme.current

    Column(
        modifier = modifier
            .testTag("analytics_consent_step")
            .padding(DashboardSpacing.ScreenEdgePadding),
        horizontalAlignment = Alignment.CenterHorizontally,
    ) {
        Text(
            text = stringResource(R.string.consent_title),
            style = DashboardTypography.title,
            color = theme.primaryTextColor,
        )

        Spacer(modifier = Modifier.height(DashboardSpacing.SpaceM))

        Text(
            text = stringResource(R.string.consent_body),
            style = DashboardTypography.description,
            color = theme.primaryTextColor.copy(alpha = TextEmphasis.Medium),
        )

        Spacer(modifier = Modifier.weight(1f))

        Row(
            modifier = Modifier.fillMaxWidth(),
            horizontalArrangement = Arrangement.spacedBy(
                DashboardSpacing.SpaceS,
                Alignment.CenterHorizontally,
            ),
        ) {
            // Skip -- secondary styling
            Box(
                modifier = Modifier
                    .sizeIn(minWidth = 76.dp, minHeight = 76.dp)
                    .testTag("consent_skip")
                    .semantics { role = Role.Button }
                    .clickable { onConsent(false) },
                contentAlignment = Alignment.Center,
            ) {
                Text(
                    text = stringResource(R.string.consent_skip),
                    style = DashboardTypography.label,
                    color = theme.secondaryTextColor,
                )
            }

            // Enable -- primary accent styling
            Box(
                modifier = Modifier
                    .sizeIn(minWidth = 76.dp, minHeight = 76.dp)
                    .testTag("consent_enable")
                    .clip(RoundedCornerShape(CardSize.SMALL.cornerRadius))
                    .background(theme.accentColor)
                    .semantics { role = Role.Button }
                    .clickable { onConsent(true) },
                contentAlignment = Alignment.Center,
            ) {
                Text(
                    text = stringResource(R.string.consent_enable),
                    style = DashboardTypography.label,
                    color = Color.White,
                )
            }
        }
    }
}
```

Add imports:
```kotlin
import app.dqxn.android.core.design.token.CardSize
import app.dqxn.android.core.design.token.DashboardSpacing
import app.dqxn.android.core.design.token.DashboardTypography
import app.dqxn.android.core.design.token.TextEmphasis
import app.dqxn.android.sdk.ui.theme.LocalDashboardTheme
import androidx.compose.foundation.background
import androidx.compose.foundation.clickable
import androidx.compose.foundation.layout.Box
import androidx.compose.foundation.layout.sizeIn
import androidx.compose.foundation.shape.RoundedCornerShape
import androidx.compose.ui.draw.clip
import androidx.compose.ui.graphics.Color
import androidx.compose.ui.semantics.Role
import androidx.compose.ui.semantics.role
import androidx.compose.ui.semantics.semantics
```

Remove: `import androidx.compose.material3.Button`, `import androidx.compose.material3.OutlinedButton`, `import androidx.compose.material3.MaterialTheme`.

**C. Update FirstLaunchDisclaimer.kt:**

Remove the dismiss button entirely (nav bar handles advancement). Remove `onDismiss` parameter.

```kotlin
@Composable
public fun FirstLaunchDisclaimer(
    modifier: Modifier = Modifier,
) {
    val theme = LocalDashboardTheme.current

    Column(
        modifier = modifier
            .testTag("first_launch_disclaimer")
            .padding(DashboardSpacing.ScreenEdgePadding),
        horizontalAlignment = Alignment.CenterHorizontally,
    ) {
        Text(
            text = stringResource(R.string.disclaimer_text),
            style = DashboardTypography.description,
            color = theme.primaryTextColor,
        )

        Spacer(modifier = Modifier.weight(1f))
        // No button -- OnboardingNavigationBar handles advancement
    }
}
```

Remove: `import androidx.compose.material3.Button`, `import androidx.compose.material3.MaterialTheme`.
Add: `import app.dqxn.android.core.design.token.DashboardSpacing`, `import app.dqxn.android.core.design.token.DashboardTypography`, `import app.dqxn.android.sdk.ui.theme.LocalDashboardTheme`.

**IMPORTANT:** Since FirstLaunchDisclaimer.kt loses its `onDismiss` parameter, check OverlayNavHost.kt or wherever FirstRunFlow is called to ensure no external code passes `onDismiss` directly to FirstLaunchDisclaimer. The `onDismissDisclaimer()` side effect is now triggered inside FirstRunFlow's OnboardingNavigationBar `onNext` handler when advancing past page 1.
  </action>
  <verify>
    <automated>cd android && ./gradlew :feature:onboarding:compileDebugKotlin --console=plain 2>&1 | tail -5</automated>
  </verify>
  <done>
    - OnboardingNavigationBar created matching SetupNavigationBar pattern
    - 76dp min touch targets on all nav buttons
    - Back button hidden on page 0
    - Page indicator dots use accentColor + secondaryTextColor
    - Per-page navigation buttons removed (navigation centralized in nav bar)
    - All MaterialTheme.typography replaced with DashboardTypography
    - All MaterialTheme.colorScheme replaced with dashboard theme tokens
    - All hardcoded dp replaced with DashboardSpacing tokens
    - Card/CardDefaults replaced with themed Box + RoundedCornerShape
    - AnimatedContent uses directional SetupSheet pattern
    - FirstLaunchDisclaimer onDismiss removed, handled via nav bar onNext
    - Compiles successfully
  </done>
</task>

<task type="auto">
  <name>Task 2: Update FirstRunFlowTest for new navigation and verify token elimination</name>
  <files>
    android/feature/onboarding/src/test/kotlin/app/dqxn/android/feature/onboarding/FirstRunFlowTest.kt
  </files>
  <action>
**1. Update renderFlow helper** -- wrap in `CompositionLocalProvider(LocalDashboardTheme provides testTheme)` so dashboard tokens resolve:

```kotlin
private val testTheme = SlateTheme  // already imported, provides all dashboard theme fields

private fun renderFlow(
    onConsent: (Boolean) -> Unit = {},
    onDismissDisclaimer: () -> Unit = {},
    onSelectTheme: (String) -> Unit = {},
    onComplete: () -> Unit = {},
) {
    composeTestRule.setContent {
        CompositionLocalProvider(LocalDashboardTheme provides testTheme) {
            FirstRunFlow(
                freeThemes = freeThemes,
                onConsent = onConsent,
                onDismissDisclaimer = onDismissDisclaimer,
                onSelectTheme = onSelectTheme,
                onComplete = onComplete,
            )
        }
    }
}
```

Add imports:
```kotlin
import androidx.compose.runtime.CompositionLocalProvider
import app.dqxn.android.sdk.ui.theme.LocalDashboardTheme
import java.io.File
```

**2. Update navigation helpers** -- navigation now uses the nav bar instead of per-page buttons:

```kotlin
private fun navigateToPage(targetPage: Int) {
    for (page in 0 until targetPage) {
        when (page) {
            0 -> {
                // On analytics page -- skip consent then advance via nav bar
                composeTestRule.onNodeWithTag("consent_skip").performClick()
                composeTestRule.onNodeWithTag("onboarding_next_button").performClick()
            }
            else -> {
                composeTestRule.onNodeWithTag("onboarding_next_button").performClick()
            }
        }
        advanceAnimations()
    }
}

private fun navigateToThemeStep() = navigateToPage(2)

private fun navigateToTourStep() {
    navigateToThemeStep()
    composeTestRule.onNodeWithTag("theme_card_${SlateTheme.themeId}").performClick()
    composeTestRule.onNodeWithTag("onboarding_next_button").performClick()
    advanceAnimations()
}
```

**3. Update existing tests for new nav pattern:**

- `advances to disclaimer after consent`: Use `consent_skip` then `onboarding_next_button`
- `advances to theme selection after disclaimer`: Use `navigateToPage(2)`
- `advances to tour after theme selection`: Use `navigateToTourStep()`
- `completing tour marks onboarding done`: Navigate to tour, then `onboarding_done_button`
- `back from page 2 returns to page 1`: Navigate to page 2, then `onBackPressedDispatcher.onBackPressed()` or click `onboarding_back_button`

Specific update for "completing tour marks onboarding done":
```kotlin
@Test
fun `completing tour marks onboarding done`() {
    var completed = false
    renderFlow(onComplete = { completed = true })
    navigateToTourStep()
    composeTestRule.onNodeWithTag("onboarding_done_button").performClick()
    assertThat(completed).isTrue()
}
```

**4. Add new tests for OnboardingNavigationBar:**

```kotlin
@Test
fun `navigation bar exists`() {
    renderFlow()
    composeTestRule.onNodeWithTag("onboarding_nav_bar").assertExists()
}

@Test
fun `back button hidden on page 0`() {
    renderFlow()
    composeTestRule.onNodeWithTag("onboarding_back_button").assertExists()
    // Back button exists but is invisible (alpha 0f) -- can't assert alpha directly,
    // but verify it's present and page 0 renders correctly
}

@Test
fun `page dots show 4 indicators`() {
    renderFlow()
    for (i in 0 until 4) {
        composeTestRule.onNodeWithTag("onboarding_page_dot_$i").assertExists()
    }
}

@Test
fun `next button shown on non-last page`() {
    renderFlow()
    composeTestRule.onNodeWithTag("onboarding_next_button").assertExists()
}

@Test
fun `done button shown on last page`() {
    renderFlow()
    navigateToTourStep()
    composeTestRule.onNodeWithTag("onboarding_done_button").assertExists()
}

@Test
fun `done button completes onboarding`() {
    var completed = false
    renderFlow(onComplete = { completed = true })
    navigateToTourStep()
    composeTestRule.onNodeWithTag("onboarding_done_button").performClick()
    assertThat(completed).isTrue()
}
```

**5. Add source verification tests -- zero MaterialTheme, zero hardcoded dp:**

```kotlin
@Test
fun `no MaterialTheme typography in onboarding source`() {
    val onboardingDir = File(System.getProperty("user.dir"),
        "feature/onboarding/src/main/kotlin/app/dqxn/android/feature/onboarding")
    onboardingDir.listFiles()?.filter { it.extension == "kt" }?.forEach { file ->
        val content = file.readText()
        assertThat(content)
            .named("${file.name} should not contain MaterialTheme.typography")
            .doesNotContain("MaterialTheme.typography")
    }
}

@Test
fun `no MaterialTheme colorScheme in onboarding source`() {
    val onboardingDir = File(System.getProperty("user.dir"),
        "feature/onboarding/src/main/kotlin/app/dqxn/android/feature/onboarding")
    onboardingDir.listFiles()?.filter { it.extension == "kt" }?.forEach { file ->
        val content = file.readText()
        assertThat(content)
            .named("${file.name} should not contain MaterialTheme.colorScheme")
            .doesNotContain("MaterialTheme.colorScheme")
    }
}

@Test
fun `no Card or CardDefaults in onboarding source`() {
    val onboardingDir = File(System.getProperty("user.dir"),
        "feature/onboarding/src/main/kotlin/app/dqxn/android/feature/onboarding")
    onboardingDir.listFiles()?.filter { it.extension == "kt" }?.forEach { file ->
        val content = file.readText()
        assertThat(content)
            .named("${file.name} should not contain CardDefaults")
            .doesNotContain("CardDefaults")
    }
}

@Test
fun `navigation bar has 76dp touch targets in source`() {
    val file = File(System.getProperty("user.dir"),
        "feature/onboarding/src/main/kotlin/app/dqxn/android/feature/onboarding/FirstRunFlow.kt")
    val content = file.readText()
    assertThat(content).contains("sizeIn(minWidth = 76.dp, minHeight = 76.dp)")
}

@Test
fun `onboarding uses DashboardTypography`() {
    val onboardingDir = File(System.getProperty("user.dir"),
        "feature/onboarding/src/main/kotlin/app/dqxn/android/feature/onboarding")
    val mainFiles = listOf("FirstRunFlow.kt", "AnalyticsConsentStep.kt", "FirstLaunchDisclaimer.kt")
    mainFiles.forEach { fileName ->
        val content = File(onboardingDir, fileName).readText()
        assertThat(content)
            .named("$fileName should use DashboardTypography")
            .contains("DashboardTypography")
    }
}

@Test
fun `onboarding uses LocalDashboardTheme`() {
    val onboardingDir = File(System.getProperty("user.dir"),
        "feature/onboarding/src/main/kotlin/app/dqxn/android/feature/onboarding")
    val mainFiles = listOf("FirstRunFlow.kt", "AnalyticsConsentStep.kt", "FirstLaunchDisclaimer.kt")
    mainFiles.forEach { fileName ->
        val content = File(onboardingDir, fileName).readText()
        assertThat(content)
            .named("$fileName should use LocalDashboardTheme")
            .contains("LocalDashboardTheme")
    }
}
```
  </action>
  <verify>
    <automated>cd android && ./gradlew :feature:onboarding:testDebugUnitTest --tests "*.FirstRunFlowTest" --console=plain 2>&1 | tail -10</automated>
  </verify>
  <done>
    - renderFlow wraps in CompositionLocalProvider with LocalDashboardTheme
    - All navigation tests use onboarding_next_button / onboarding_done_button
    - navigateToPage helper for consistent page advancement
    - New tests: nav bar exists, back button hidden page 0, 4 page dots, next button, done button, done completes
    - Source verification: no MaterialTheme.typography, no MaterialTheme.colorScheme, no CardDefaults
    - 76dp touch target verified in source
    - DashboardTypography and LocalDashboardTheme usage verified across all 3 files
    - All tests pass
  </done>
</task>

</tasks>

<verification>
1. `cd android && ./gradlew :feature:onboarding:compileDebugKotlin --console=plain` -- compiles
2. `cd android && ./gradlew :feature:onboarding:testDebugUnitTest --tests "*.FirstRunFlowTest" --console=plain` -- all tests pass
3. `cd android && ./gradlew :feature:onboarding:testDebugUnitTest --console=plain` -- no regressions
</verification>

<success_criteria>
- OnboardingNavigationBar matches SetupNavigationBar pattern (back/next/done + dots)
- 76dp min touch targets on all nav bar buttons
- Back button hidden on page 0
- Page dots use dashboard theme accentColor
- Per-page navigation buttons removed (centralized in nav bar)
- Zero MaterialTheme.typography references in :feature:onboarding
- Zero MaterialTheme.colorScheme references in :feature:onboarding
- Zero Card/CardDefaults in :feature:onboarding
- All spacing uses DashboardSpacing tokens
- ThemeCard uses dashboard theme tokens for styling
- TourCard uses themed Box with CardSize corner radius
- All tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/14-ui-visual-interactive-parity/14-11-SUMMARY.md`
</output>
