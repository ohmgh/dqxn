---
phase: 10-settings-foundation-setup-ui
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - android/sdk/contracts/src/main/kotlin/app/dqxn/android/sdk/contracts/settings/ProviderSettingsStore.kt
  - android/data/src/main/kotlin/app/dqxn/android/data/preferences/UserPreferencesRepository.kt
  - android/data/src/main/kotlin/app/dqxn/android/data/preferences/UserPreferencesRepositoryImpl.kt
  - android/data/src/main/kotlin/app/dqxn/android/data/layout/LayoutRepository.kt
  - android/data/src/main/kotlin/app/dqxn/android/data/layout/LayoutRepositoryImpl.kt
  - android/data/src/main/kotlin/app/dqxn/android/data/provider/ProviderSettingsStoreImpl.kt
  - android/data/src/main/kotlin/app/dqxn/android/data/style/WidgetStyleStore.kt
  - android/data/src/main/kotlin/app/dqxn/android/data/style/WidgetStyleStoreImpl.kt
  - android/data/src/main/kotlin/app/dqxn/android/data/device/PairedDeviceStore.kt
  - android/data/src/main/kotlin/app/dqxn/android/data/device/PairedDeviceStoreImpl.kt
  - android/data/src/test/kotlin/app/dqxn/android/data/preferences/UserPreferencesRepositoryImplTest.kt
  - android/data/src/test/kotlin/app/dqxn/android/data/layout/LayoutRepositoryImplTest.kt
  - android/data/src/test/kotlin/app/dqxn/android/data/provider/ProviderSettingsStoreImplTest.kt
  - android/data/src/test/kotlin/app/dqxn/android/data/style/WidgetStyleStoreTest.kt
  - android/data/src/test/kotlin/app/dqxn/android/data/device/PairedDeviceStoreTest.kt
  - android/core/design/src/main/kotlin/app/dqxn/android/core/design/token/SemanticColors.kt
  - android/core/design/src/test/kotlin/app/dqxn/android/core/design/token/SemanticColorsTest.kt
autonomous: true
requirements:
  - F12.5
  - F14.4

must_haves:
  truths:
    - "Semantic color tokens (info, warning, success, error) exist in `:core:design`"
    - "UserPreferencesRepository exposes analyticsConsent flow and clearAll method"
    - "ProviderSettingsStore exposes clearAll method"
    - "LayoutRepository exposes clearAll method"
    - "WidgetStyleStore exposes clearAll method"
    - "PairedDeviceStore exposes clearAll method"
  artifacts:
    - path: "android/core/design/src/main/kotlin/app/dqxn/android/core/design/token/SemanticColors.kt"
      provides: "Info/Warning/Success/Error color tokens"
    - path: "android/data/src/main/kotlin/app/dqxn/android/data/preferences/UserPreferencesRepository.kt"
      provides: "analyticsConsent + clearAll"
  key_links:
    - from: "android/data/src/main/kotlin/app/dqxn/android/data/preferences/UserPreferencesRepositoryImpl.kt"
      to: "analyticsConsent preference"
      via: "Preferences DataStore booleanPreferencesKey"
      pattern: "analyticsConsent"
---

<objective>
Data layer extensions and semantic color tokens needed by all Phase 10 UI plans.

Purpose: Add `clearAll()` methods to all 5 data stores/repositories (for F14.4 Delete All Data), add `analyticsConsent` preference (for F12.5), and create semantic color tokens (for InfoSettingRow and setup cards). These are small edits to existing files -- each interface gets one new method signature, each impl gets ~3-5 lines, each test gets ~10-15 lines. Low context cost despite file count.
Output: Extended data interfaces, semantic colors object, all tests green.
</objective>

<execution_context>
@/Users/ohm/.claude/get-shit-done/workflows/execute-plan.md
@/Users/ohm/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-settings-foundation-setup-ui/10-RESEARCH.md

@android/data/src/main/kotlin/app/dqxn/android/data/preferences/UserPreferencesRepository.kt
@android/data/src/main/kotlin/app/dqxn/android/data/preferences/UserPreferencesRepositoryImpl.kt
@android/sdk/contracts/src/main/kotlin/app/dqxn/android/sdk/contracts/settings/ProviderSettingsStore.kt
@android/data/src/main/kotlin/app/dqxn/android/data/provider/ProviderSettingsStoreImpl.kt
@android/data/src/main/kotlin/app/dqxn/android/data/layout/LayoutRepository.kt
@android/data/src/main/kotlin/app/dqxn/android/data/layout/LayoutRepositoryImpl.kt
@android/data/src/main/kotlin/app/dqxn/android/data/style/WidgetStyleStore.kt
@android/data/src/main/kotlin/app/dqxn/android/data/style/WidgetStyleStoreImpl.kt
@android/data/src/main/kotlin/app/dqxn/android/data/device/PairedDeviceStore.kt
@android/data/src/main/kotlin/app/dqxn/android/data/device/PairedDeviceStoreImpl.kt
@android/core/design/src/main/kotlin/app/dqxn/android/core/design/token/CardSize.kt
</context>

<tasks>

<task type="auto">
  <name>Task 1: Data layer clearAll + analyticsConsent extensions</name>
  <files>
    android/sdk/contracts/src/main/kotlin/app/dqxn/android/sdk/contracts/settings/ProviderSettingsStore.kt
    android/data/src/main/kotlin/app/dqxn/android/data/preferences/UserPreferencesRepository.kt
    android/data/src/main/kotlin/app/dqxn/android/data/preferences/UserPreferencesRepositoryImpl.kt
    android/data/src/main/kotlin/app/dqxn/android/data/layout/LayoutRepository.kt
    android/data/src/main/kotlin/app/dqxn/android/data/layout/LayoutRepositoryImpl.kt
    android/data/src/main/kotlin/app/dqxn/android/data/provider/ProviderSettingsStoreImpl.kt
    android/data/src/main/kotlin/app/dqxn/android/data/style/WidgetStyleStore.kt
    android/data/src/main/kotlin/app/dqxn/android/data/style/WidgetStyleStoreImpl.kt
    android/data/src/main/kotlin/app/dqxn/android/data/device/PairedDeviceStore.kt
    android/data/src/main/kotlin/app/dqxn/android/data/device/PairedDeviceStoreImpl.kt
  </files>
  <action>
    1. **UserPreferencesRepository**: Add `analyticsConsent: Flow<Boolean>` (default `false` -- opt-in per PDPA/GDPR F12.5). Add `suspend fun setAnalyticsConsent(enabled: Boolean)`. Add `suspend fun clearAll()` that resets ALL preferences to defaults.

    2. **UserPreferencesRepositoryImpl**: `analyticsConsent` backed by `booleanPreferencesKey("analytics_consent")` with default `false`. `clearAll()` calls `dataStore.edit { it.clear() }`.

    3. **ProviderSettingsStore interface (`:sdk:contracts`)**: Add `suspend fun clearAll()` method to clear ALL provider settings across all packs/providers.

    4. **ProviderSettingsStoreImpl**: Implement `clearAll()` -- call `dataStore.edit { it.clear() }` on the underlying Preferences DataStore.

    5. **LayoutRepository + Impl**: Add `suspend fun clearAll()` that deletes all profiles and widgets, then recreates the default profile (cannot have zero profiles). Implementation: clear all proto data, recreate a single "Default" profile with empty widget list.

    6. **WidgetStyleStore interface**: Add `suspend fun clearAll()` to remove all style overrides. This is needed by Plan 09's MainSettingsViewModel.deleteAllData().

    7. **WidgetStyleStoreImpl**: Implement `clearAll()` -- call `dataStore.edit { it.clear() }`.

    8. **PairedDeviceStore interface**: Add `suspend fun clearAll()` to remove all paired device records. Needed by Plan 09's MainSettingsViewModel.deleteAllData().

    9. **PairedDeviceStoreImpl**: Implement `clearAll()` -- clear all paired device entries from Proto DataStore.
  </action>
  <verify>
    <automated>cd /Users/ohm/Workspace/dqxn/android && ./gradlew :data:compileDebugKotlin :sdk:contracts:compileDebugKotlin --console=plain 2>&1 | tail -10</automated>
  </verify>
  <done>
    - analyticsConsent flow defaults to false, correctly persists true/false
    - clearAll() added to all 5 interfaces: UserPreferencesRepository, ProviderSettingsStore, LayoutRepository, WidgetStyleStore, PairedDeviceStore
    - LayoutRepository.clearAll() recreates default profile (never zero profiles)
  </done>
</task>

<task type="auto">
  <name>Task 2: SemanticColors + tests for all data extensions</name>
  <files>
    android/core/design/src/main/kotlin/app/dqxn/android/core/design/token/SemanticColors.kt
    android/core/design/src/test/kotlin/app/dqxn/android/core/design/token/SemanticColorsTest.kt
    android/data/src/test/kotlin/app/dqxn/android/data/preferences/UserPreferencesRepositoryImplTest.kt
    android/data/src/test/kotlin/app/dqxn/android/data/layout/LayoutRepositoryImplTest.kt
    android/data/src/test/kotlin/app/dqxn/android/data/provider/ProviderSettingsStoreImplTest.kt
    android/data/src/test/kotlin/app/dqxn/android/data/style/WidgetStyleStoreTest.kt
    android/data/src/test/kotlin/app/dqxn/android/data/device/PairedDeviceStoreTest.kt
  </files>
  <action>
    1. **SemanticColors object** in `:core:design` token package. Static colors (NOT per-theme):
       - `Info = Color(0xFF2196F3)` (Material Blue 500)
       - `Warning = Color(0xFFFFA726)` (Material Orange 400)
       - `Success = Color(0xFF66BB6A)` (Material Green 400)
       - `Error = Color(0xFFEF5350)` (Material Red 400)
       These are informational state colors, not themed aesthetics per research recommendation.

    2. **SemanticColorsTest**: Verify all 4 color values are non-transparent (alpha > 0).

    3. **UserPreferencesRepositoryImplTest**: Add tests for `analyticsConsent` flow (default false, set true, set false) and `clearAll()` (verify data is cleared).

    4. **LayoutRepositoryImplTest**: Add `clearAll()` test -- verify all profiles/widgets cleared, default profile recreated.

    5. **ProviderSettingsStoreImplTest**: Add `clearAll()` test -- verify all settings cleared.

    6. **WidgetStyleStoreTest**: Add `clearAll()` test -- set styles for 2 widgets, call clearAll, verify both return WidgetStyle.Default.

    7. **PairedDeviceStoreTest**: Add `clearAll()` test -- add 2 devices, call clearAll, verify devices list is empty.
  </action>
  <verify>
    <automated>cd /Users/ohm/Workspace/dqxn/android && ./gradlew :data:testDebugUnitTest :core:design:testDebugUnitTest --console=plain 2>&1 | tail -20</automated>
  </verify>
  <done>
    - SemanticColors has Info/Warning/Success/Error static color tokens
    - All clearAll() methods verified via tests on all 5 stores/repos
    - analyticsConsent round-trip verified
  </done>
</task>

</tasks>

<verification>
```bash
cd /Users/ohm/Workspace/dqxn/android && ./gradlew :data:testDebugUnitTest :core:design:testDebugUnitTest :sdk:contracts:compileDebugKotlin --console=plain 2>&1 | tail -30
```
</verification>

<success_criteria>
- `analyticsConsent` preference defaults to `false`, round-trips correctly
- `clearAll()` works on all 5 data layer interfaces (UserPreferences, ProviderSettings, LayoutRepository, WidgetStyleStore, PairedDeviceStore)
- LayoutRepository.clearAll() recreates default profile (never zero profiles)
- SemanticColors object provides Info/Warning/Success/Error colors
- All new/modified tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/10-settings-foundation-setup-ui/10-01-SUMMARY.md`
</output>
