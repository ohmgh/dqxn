---
phase: 10-settings-foundation-setup-ui
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - android/feature/settings/build.gradle.kts
  - android/core/design/src/main/kotlin/app/dqxn/android/core/design/token/SemanticColors.kt
  - android/core/design/src/test/kotlin/app/dqxn/android/core/design/token/SemanticColorsTest.kt
  - android/sdk/contracts/src/main/kotlin/app/dqxn/android/sdk/contracts/settings/ProviderSettingsStore.kt
  - android/data/src/main/kotlin/app/dqxn/android/data/preferences/UserPreferencesRepository.kt
  - android/data/src/main/kotlin/app/dqxn/android/data/preferences/UserPreferencesRepositoryImpl.kt
  - android/data/src/main/kotlin/app/dqxn/android/data/layout/LayoutRepository.kt
  - android/data/src/main/kotlin/app/dqxn/android/data/layout/LayoutRepositoryImpl.kt
  - android/data/src/main/kotlin/app/dqxn/android/data/provider/ProviderSettingsStoreImpl.kt
  - android/data/src/test/kotlin/app/dqxn/android/data/preferences/UserPreferencesRepositoryImplTest.kt
  - android/data/src/test/kotlin/app/dqxn/android/data/layout/LayoutRepositoryImplTest.kt
  - android/data/src/test/kotlin/app/dqxn/android/data/provider/ProviderSettingsStoreImplTest.kt
  - android/feature/settings/src/main/kotlin/app/dqxn/android/feature/settings/SettingsNavigation.kt
  - android/feature/settings/src/main/kotlin/app/dqxn/android/feature/settings/overlay/OverlayScaffold.kt
  - android/feature/settings/src/main/kotlin/app/dqxn/android/feature/settings/overlay/OverlayTitleBar.kt
autonomous: true
requirements:
  - F12.5
  - F14.4

must_haves:
  truths:
    - "`:feature:settings` compiles with `:core:design` and `:data` dependencies"
    - "Semantic color tokens (info, warning, success, error) exist in `:core:design`"
    - "UserPreferencesRepository exposes analyticsConsent flow and clearAll method"
    - "ProviderSettingsStore exposes clearAll method"
    - "LayoutRepository exposes clearAll method"
    - "OverlayScaffold and OverlayTitleBar render with correct design tokens"
  artifacts:
    - path: "android/feature/settings/build.gradle.kts"
      provides: "Feature settings module with core:design + data deps"
    - path: "android/core/design/src/main/kotlin/app/dqxn/android/core/design/token/SemanticColors.kt"
      provides: "Info/Warning/Success/Error color tokens"
    - path: "android/feature/settings/src/main/kotlin/app/dqxn/android/feature/settings/SettingsNavigation.kt"
      provides: "SettingNavigation sealed interface with 4 events"
    - path: "android/feature/settings/src/main/kotlin/app/dqxn/android/feature/settings/overlay/OverlayScaffold.kt"
      provides: "Shared overlay container composable"
  key_links:
    - from: "android/feature/settings/build.gradle.kts"
      to: ":core:design, :data"
      via: "implementation project dependencies"
      pattern: 'implementation\\(project\\(":core:design"\\)\\)'
    - from: "android/data/src/main/kotlin/app/dqxn/android/data/preferences/UserPreferencesRepositoryImpl.kt"
      to: "analyticsConsent preference"
      via: "Preferences DataStore booleanPreferencesKey"
      pattern: "analyticsConsent"
---

<objective>
Foundation layer for Phase 10: module build config, data layer extensions, semantic color tokens, shared overlay infrastructure, and navigation types.

Purpose: Unblock all subsequent Phase 10 plans by establishing the `:feature:settings` module dependencies, adding `clearAll()` and `analyticsConsent` to data repositories, creating semantic color tokens missing from the design system, and building shared overlay composables.
Output: Compilable `:feature:settings` module, extended data interfaces, semantic colors, OverlayScaffold/OverlayTitleBar, SettingNavigation sealed interface.
</objective>

<execution_context>
@/Users/ohm/.claude/get-shit-done/workflows/execute-plan.md
@/Users/ohm/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-settings-foundation-setup-ui/10-RESEARCH.md

@android/feature/settings/build.gradle.kts
@android/core/design/src/main/kotlin/app/dqxn/android/core/design/token/CardSize.kt
@android/core/design/src/main/kotlin/app/dqxn/android/core/design/token/DashboardSpacing.kt
@android/core/design/src/main/kotlin/app/dqxn/android/core/design/token/TextEmphasis.kt
@android/data/src/main/kotlin/app/dqxn/android/data/preferences/UserPreferencesRepository.kt
@android/data/src/main/kotlin/app/dqxn/android/data/preferences/UserPreferencesRepositoryImpl.kt
@android/sdk/contracts/src/main/kotlin/app/dqxn/android/sdk/contracts/settings/ProviderSettingsStore.kt
@android/data/src/main/kotlin/app/dqxn/android/data/provider/ProviderSettingsStoreImpl.kt
@android/data/src/main/kotlin/app/dqxn/android/data/layout/LayoutRepository.kt
@android/data/src/main/kotlin/app/dqxn/android/data/layout/LayoutRepositoryImpl.kt
@android/core/design/src/main/kotlin/app/dqxn/android/core/design/motion/DashboardMotion.kt
@android/core/design/src/main/kotlin/app/dqxn/android/core/design/token/DashboardTypography.kt
</context>

<tasks>

<task type="auto">
  <name>Task 1: Data layer extensions + semantic colors</name>
  <files>
    android/sdk/contracts/src/main/kotlin/app/dqxn/android/sdk/contracts/settings/ProviderSettingsStore.kt
    android/data/src/main/kotlin/app/dqxn/android/data/preferences/UserPreferencesRepository.kt
    android/data/src/main/kotlin/app/dqxn/android/data/preferences/UserPreferencesRepositoryImpl.kt
    android/data/src/main/kotlin/app/dqxn/android/data/layout/LayoutRepository.kt
    android/data/src/main/kotlin/app/dqxn/android/data/layout/LayoutRepositoryImpl.kt
    android/data/src/main/kotlin/app/dqxn/android/data/provider/ProviderSettingsStoreImpl.kt
    android/data/src/test/kotlin/app/dqxn/android/data/preferences/UserPreferencesRepositoryImplTest.kt
    android/data/src/test/kotlin/app/dqxn/android/data/layout/LayoutRepositoryImplTest.kt
    android/data/src/test/kotlin/app/dqxn/android/data/provider/ProviderSettingsStoreImplTest.kt
    android/core/design/src/main/kotlin/app/dqxn/android/core/design/token/SemanticColors.kt
    android/core/design/src/test/kotlin/app/dqxn/android/core/design/token/SemanticColorsTest.kt
  </files>
  <action>
    1. **UserPreferencesRepository + Impl**: Add `analyticsConsent: Flow<Boolean>` (default `false` -- opt-in per PDPA/GDPR F12.5). Add `suspend fun setAnalyticsConsent(enabled: Boolean)`. Add `suspend fun clearAll()` that resets ALL preferences to defaults (delete all keys from Preferences DataStore). Implementation: `analyticsConsent` backed by `booleanPreferencesKey("analytics_consent")` with default `false`. `clearAll()` calls `dataStore.edit { it.clear() }`.

    2. **ProviderSettingsStore interface (`:sdk:contracts`)**: Add `suspend fun clearAll()` method to clear ALL provider settings across all packs/providers.

    3. **ProviderSettingsStoreImpl**: Implement `clearAll()` -- call `dataStore.edit { it.clear() }` on the underlying Preferences DataStore.

    4. **LayoutRepository + Impl**: Add `suspend fun clearAll()` that deletes all profiles and widgets, then recreates the default profile (cannot have zero profiles). Implementation: clear all proto data, recreate a single "Default" profile with empty widget list.

    5. **SemanticColors object** in `:core:design` token package. Static colors (NOT per-theme):
       - `Info = Color(0xFF2196F3)` (Material Blue 500)
       - `Warning = Color(0xFFFFA726)` (Material Orange 400)
       - `Success = Color(0xFF66BB6A)` (Material Green 400)
       - `Error = Color(0xFFEF5350)` (Material Red 400)
       These are informational state colors, not themed aesthetics per research recommendation.

    6. **Tests**: Add tests for `analyticsConsent` flow (default false, set true, set false), `clearAll()` on each repository/store (verify data is cleared, verify default profile recreated for LayoutRepository), and a trivial SemanticColors test verifying all 4 color values are non-transparent.
  </action>
  <verify>
    <automated>cd /Users/ohm/Workspace/dqxn/android && ./gradlew :data:testDebugUnitTest :core:design:testDebugUnitTest --console=plain 2>&1 | tail -20</automated>
  </verify>
  <done>
    - analyticsConsent flow defaults to false, correctly persists true/false
    - clearAll() on UserPreferencesRepository, ProviderSettingsStore, and LayoutRepository clears all data
    - LayoutRepository.clearAll() recreates default profile (never zero profiles)
    - SemanticColors has Info/Warning/Success/Error static color tokens
  </done>
</task>

<task type="auto">
  <name>Task 2: Feature settings build config + overlay scaffold + navigation types</name>
  <files>
    android/feature/settings/build.gradle.kts
    android/feature/settings/src/main/kotlin/app/dqxn/android/feature/settings/SettingsNavigation.kt
    android/feature/settings/src/main/kotlin/app/dqxn/android/feature/settings/overlay/OverlayScaffold.kt
    android/feature/settings/src/main/kotlin/app/dqxn/android/feature/settings/overlay/OverlayTitleBar.kt
  </files>
  <action>
    1. **build.gradle.kts**: Add explicit dependencies beyond what `dqxn.android.feature` provides:
       ```kotlin
       plugins { id("dqxn.android.feature") }
       android { namespace = "app.dqxn.android.feature.settings" }
       dependencies {
           implementation(project(":core:design"))
           implementation(project(":data"))
       }
       ```
       The `dqxn.android.feature` convention plugin already provides `:sdk:*`, lifecycle, Hilt, Navigation Compose, and Compose. `:core:design` needed for tokens/motion. `:data` needed for repository injection (Delete All Data, analytics consent).

    2. **SettingsNavigation.kt**: Sealed interface with 4 events for sub-navigation within settings:
       ```kotlin
       sealed interface SettingNavigation {
           data class ToTimezonePicker(val settingKey: String, val currentValue: String?) : SettingNavigation
           data class ToDateFormatPicker(val settingKey: String, val currentValue: DateFormatOption) : SettingNavigation
           data class ToAppPicker(val settingKey: String, val currentPackage: String?) : SettingNavigation
           data class OnInstructionAction(val settingKey: String, val action: InstructionAction) : SettingNavigation
       }
       ```
       Import `DateFormatOption` and `InstructionAction` from `:sdk:contracts`.

    3. **OverlayScaffold.kt**: Shared container composable for all overlay surfaces.
       - `OverlayType` enum: `Hub` (full-screen, no rounded corners), `Preview` (top-rounded), `Confirmation` (all-rounded).
       - Shape derived from `OverlayType` using `CardSize.LARGE.cornerRadius` (16dp) -- NOT inline dp values per replication advisory fix.
       - Background color from `LocalDashboardTheme.current`.
       - Uses `DashboardSpacing.ScreenEdgePadding` for internal padding.
       - Uses `DashboardMotion.sheetEnter/sheetExit` for `AnimatedVisibility`.
       - Accepts `title: String`, `overlayType: OverlayType`, `onClose: () -> Unit`, `modifier: Modifier`, `content: @Composable () -> Unit`.
       - Minimum touch target 76dp on close button (F10.4).
       - Uses `Column` with `OverlayTitleBar` at top and `content()` filling remaining space.

    4. **OverlayTitleBar.kt**: Title + close button composable.
       - Title uses `DashboardTypography.title`.
       - Text color from `LocalDashboardTheme.current.primaryTextColor`.
       - Close button uses `TextEmphasis.Medium` (0.7f) alpha -- NOT inline 0.6f per advisory fix.
       - Close button minimum size 76dp (F10.4).
       - Row layout with `SpaceBetween` arrangement.

    5. Verify compilation: `./gradlew :feature:settings:compileDebugKotlin --console=plain`.
  </action>
  <verify>
    <automated>cd /Users/ohm/Workspace/dqxn/android && ./gradlew :feature:settings:compileDebugKotlin --console=plain 2>&1 | tail -10</automated>
  </verify>
  <done>
    - `:feature:settings` compiles with `:core:design` and `:data` dependencies
    - SettingNavigation sealed interface has 4 event types
    - OverlayScaffold renders with OverlayType-based shape, design tokens, 76dp close button
    - OverlayTitleBar uses DashboardTypography.title and TextEmphasis.Medium
  </done>
</task>

</tasks>

<verification>
```bash
cd /Users/ohm/Workspace/dqxn/android && ./gradlew :feature:settings:compileDebugKotlin :data:testDebugUnitTest :core:design:testDebugUnitTest --console=plain 2>&1 | tail -30
```
</verification>

<success_criteria>
- `:feature:settings` module compiles with `:core:design` and `:data` deps
- `analyticsConsent` preference defaults to `false`, round-trips correctly
- `clearAll()` works on all 3 data layer interfaces (UserPreferences, ProviderSettings, LayoutRepository)
- SemanticColors object provides Info/Warning/Success/Error colors
- OverlayScaffold + OverlayTitleBar compile with correct design token usage
- SettingNavigation sealed interface compiles with 4 event types
- All new/modified tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/10-settings-foundation-setup-ui/10-01-SUMMARY.md`
</output>
