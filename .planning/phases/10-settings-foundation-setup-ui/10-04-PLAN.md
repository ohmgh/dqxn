---
phase: 10-settings-foundation-setup-ui
plan: 04
type: execute
wave: 2
depends_on:
  - "10-01"
  - "10-02"
files_modified:
  - android/feature/settings/src/main/kotlin/app/dqxn/android/feature/settings/row/SettingRowDispatcher.kt
  - android/feature/settings/src/main/kotlin/app/dqxn/android/feature/settings/row/SettingComponents.kt
  - android/feature/settings/src/main/kotlin/app/dqxn/android/feature/settings/row/BooleanSettingRow.kt
  - android/feature/settings/src/main/kotlin/app/dqxn/android/feature/settings/row/EnumSettingRow.kt
  - android/feature/settings/src/main/kotlin/app/dqxn/android/feature/settings/row/IntSettingRow.kt
  - android/feature/settings/src/main/kotlin/app/dqxn/android/feature/settings/row/FloatSettingRow.kt
  - android/feature/settings/src/main/kotlin/app/dqxn/android/feature/settings/row/StringSettingRow.kt
  - android/feature/settings/src/main/kotlin/app/dqxn/android/feature/settings/row/InfoSettingRow.kt
autonomous: true
requirements:
  - F2.9
  - F10.4

must_haves:
  truths:
    - "SettingRowDispatcher routes all 12 SettingDefinition subtypes to correct row composables"
    - "Three-layer visibility gating works: hidden, visibleWhen, entitlement"
    - "Value changes from row composables propagate via onValueChanged callback"
    - "All interactive elements have minimum 76dp touch targets"
    - "EnumSettingRow renders chips (<=10), dropdown (>10), or preview cards based on option count"
    - "InfoSettingRow uses SemanticColors from Plan 01 for 4 styles"
  artifacts:
    - path: "android/feature/settings/src/main/kotlin/app/dqxn/android/feature/settings/row/SettingRowDispatcher.kt"
      provides: "12-branch when dispatch with AnimatedVisibility"
    - path: "android/feature/settings/src/main/kotlin/app/dqxn/android/feature/settings/row/SettingComponents.kt"
      provides: "SettingLabel, SelectionChip, PreviewSelectionCard shared components"
  key_links:
    - from: "SettingRowDispatcher.kt"
      to: "SettingDefinition subtypes"
      via: "when dispatch"
      pattern: "is SettingDefinition\\."
    - from: "SettingRowDispatcher.kt"
      to: "EntitlementManager"
      via: "isAccessible check"
      pattern: "isAccessible"
    - from: "InfoSettingRow.kt"
      to: "SemanticColors"
      via: "InfoStyle color mapping"
      pattern: "SemanticColors\\."
---

<objective>
SettingRowDispatcher hub + shared components + first 6 setting row types (Boolean, Enum, Int, Float, String, Info).

Purpose: The dispatcher is the foundational UI dispatch layer consumed by setup wizard (Plan 07), widget settings sheet (Plan 08), and main settings (Plan 09). This plan creates the dispatcher with its first 6 row types. InfoSettingRow depends on SemanticColors from Plan 01.
Output: SettingRowDispatcher with 12-branch dispatch (6 implemented, 6 stubbed), shared SettingComponents, first 6 row composables.
</objective>

<execution_context>
@/Users/ohm/.claude/get-shit-done/workflows/execute-plan.md
@/Users/ohm/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-settings-foundation-setup-ui/10-RESEARCH.md

@android/sdk/contracts/src/main/kotlin/app/dqxn/android/sdk/contracts/settings/SettingDefinition.kt
@android/sdk/contracts/src/main/kotlin/app/dqxn/android/sdk/contracts/entitlement/Gated.kt
@android/sdk/contracts/src/main/kotlin/app/dqxn/android/sdk/contracts/entitlement/EntitlementManager.kt
@android/sdk/contracts/src/main/kotlin/app/dqxn/android/sdk/contracts/settings/SettingsEnums.kt
@android/core/design/src/main/kotlin/app/dqxn/android/core/design/motion/DashboardMotion.kt
@android/core/design/src/main/kotlin/app/dqxn/android/core/design/token/DashboardSpacing.kt
@android/core/design/src/main/kotlin/app/dqxn/android/core/design/token/DashboardTypography.kt
@android/core/design/src/main/kotlin/app/dqxn/android/core/design/token/TextEmphasis.kt
@android/core/design/src/main/kotlin/app/dqxn/android/core/design/token/CardSize.kt

# Plan 01 provides SemanticColors
@.planning/phases/10-settings-foundation-setup-ui/10-01-SUMMARY.md
# Plan 02 provides OverlayScaffold, SettingsNavigation, build config
@.planning/phases/10-settings-foundation-setup-ui/10-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: SettingRowDispatcher + SettingComponents + 3 core rows</name>
  <files>
    android/feature/settings/src/main/kotlin/app/dqxn/android/feature/settings/row/SettingRowDispatcher.kt
    android/feature/settings/src/main/kotlin/app/dqxn/android/feature/settings/row/SettingComponents.kt
    android/feature/settings/src/main/kotlin/app/dqxn/android/feature/settings/row/BooleanSettingRow.kt
    android/feature/settings/src/main/kotlin/app/dqxn/android/feature/settings/row/EnumSettingRow.kt
  </files>
  <action>
    1. **SettingComponents.kt**: Shared building blocks used by all row types:
       - `SettingLabel(label, description?, theme)`: Row with label (`DashboardTypography.itemTitle`) + optional description (`DashboardTypography.description` at `TextEmphasis.Medium`). Minimum height 76dp (F10.4).
       - `SelectionChip(text, isSelected, onClick, theme)`: Material 3 FilterChip with `CardSize.SMALL.cornerRadius`, accent color when selected. Minimum 76dp height.
       - `PreviewSelectionCard(isSelected, content, onClick, theme)`: Card with border highlight when selected using accent color. `CardSize.MEDIUM.cornerRadius`.
       - `formatGmtOffset(zoneId: String): String` utility function.
       - `executeInstructionAction(context: Context, action: InstructionAction)`: Launches `OpenUrl` (Intent.ACTION_VIEW) or `LaunchApp` (package manager launch intent).

    2. **SettingRowDispatcher.kt**: Central dispatch composable:
       ```kotlin
       @Composable
       fun SettingRowDispatcher(
           definition: SettingDefinition<*>,
           currentValue: Any?,
           currentSettings: Map<String, Any?>,
           entitlementManager: EntitlementManager,
           theme: DashboardThemeDefinition,
           onValueChanged: (String, Any?) -> Unit,
           onNavigate: ((SettingNavigation) -> Unit)? = null,
       )
       ```
       - Layer 1: `if (definition.hidden) return` (hard skip)
       - Layer 2: `visibleWhen?.invoke(currentSettings) != false` (null = always visible -- critical: prevents flickering on initial empty map load per Pitfall 1)
       - Layer 3: `definition.isAccessible(entitlementManager)` entitlement check
       - `AnimatedVisibility(visible = isVisible && hasEntitlement, enter = DashboardMotion.expandEnter, exit = DashboardMotion.expandExit)`
       - 12-branch `when` dispatching to individual row composables. For not-yet-implemented rows (Instruction, AppPicker, DateFormat, Timezone, SoundPicker, Uri), use `else` fallback: `SettingLabel(definition.label, definition.description, theme)`.

    3. **BooleanSettingRow**: `SettingLabel` + M3 `Switch`. Toggle fires `onValueChanged(definition.key, !currentValue)`.

    4. **EnumSettingRow**: 3 render modes based on option count and `optionPreviews`:
       - If `optionPreviews` non-null: `PreviewSelectionCard` grid (chunked rows of 5)
       - If options <= 10: `SelectionChip` row with `FlowRow`
       - If options > 10: `ExposedDropdownMenuBox`
       Compare with `value == option || value?.toString() == option.name` per Pitfall 3 (type-prefixed serialization).
  </action>
  <verify>
    <automated>cd /Users/ohm/Workspace/dqxn/android && ./gradlew :feature:settings:compileDebugKotlin --console=plain 2>&1 | tail -10</automated>
  </verify>
  <done>
    - SettingRowDispatcher compiles with 12-branch dispatch + 3-layer visibility gating
    - BooleanSettingRow and EnumSettingRow render with design tokens
    - SettingComponents (SettingLabel, SelectionChip, PreviewSelectionCard) available
    - Unimplemented rows fall through to SettingLabel
  </done>
</task>

<task type="auto">
  <name>Task 2: Int, Float, String, Info row types</name>
  <files>
    android/feature/settings/src/main/kotlin/app/dqxn/android/feature/settings/row/IntSettingRow.kt
    android/feature/settings/src/main/kotlin/app/dqxn/android/feature/settings/row/FloatSettingRow.kt
    android/feature/settings/src/main/kotlin/app/dqxn/android/feature/settings/row/StringSettingRow.kt
    android/feature/settings/src/main/kotlin/app/dqxn/android/feature/settings/row/InfoSettingRow.kt
  </files>
  <action>
    1. **IntSettingRow**: If `getEffectivePresets(currentSettings)` returns presets, render as `SelectionChip` row. Otherwise render as `SettingLabel` with current value display. No slider -- discrete presets only.

    2. **FloatSettingRow**: Discrete selection chips/presets, NOT slider (sliders conflict with pager swipe per anti-pattern). Chips for preset values if defined, otherwise render value display with +/- buttons respecting `min/max/step`.

    3. **StringSettingRow**: `OutlinedTextField` with `textFieldValue` state, `maxLength` filter via `TextFieldDefaults`, keyboard auto-defocus on Done action. `isEditing` local state to toggle between display and edit modes. Uses `DashboardTypography.itemTitle` for label.

    4. **InfoSettingRow**: 4-style color mapping using `SemanticColors` from `:core:design` (created in Plan 01):
       - `InfoStyle.INFO` -> `SemanticColors.Info`
       - `InfoStyle.WARNING` -> `SemanticColors.Warning`
       - `InfoStyle.SUCCESS` -> `SemanticColors.Success`
       - `InfoStyle.ERROR` -> `SemanticColors.Error`
       Icon + text with appropriate tint. Renders as a card with `CardSize.MEDIUM.cornerRadius`.
  </action>
  <verify>
    <automated>cd /Users/ohm/Workspace/dqxn/android && ./gradlew :feature:settings:compileDebugKotlin --console=plain 2>&1 | tail -10</automated>
  </verify>
  <done>
    - Int, Float, String, Info row types render with design tokens
    - InfoSettingRow correctly maps InfoStyle to SemanticColors
    - FloatSettingRow uses discrete chips, NOT slider
    - All interactive elements >= 76dp touch targets
  </done>
</task>

</tasks>

<verification>
```bash
cd /Users/ohm/Workspace/dqxn/android && ./gradlew :feature:settings:compileDebugKotlin --console=plain 2>&1 | tail -10
```
</verification>

<success_criteria>
- SettingRowDispatcher routes first 6 subtypes to real composables, remaining 6 to fallback
- Three-layer visibility (hidden, visibleWhen, entitlement) gating functional
- EnumSettingRow renders chips/dropdown/preview based on option count
- InfoSettingRow uses SemanticColors for 4 info styles
- visibleWhen treats null map values as default-visible (Pitfall 1)
- EnumSetting compares with toString fallback (Pitfall 3)
</success_criteria>

<output>
After completion, create `.planning/phases/10-settings-foundation-setup-ui/10-04-SUMMARY.md`
</output>
