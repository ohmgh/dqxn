---
phase: 10-settings-foundation-setup-ui
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - android/feature/settings/build.gradle.kts
  - android/feature/settings/src/main/kotlin/app/dqxn/android/feature/settings/SettingsNavigation.kt
  - android/feature/settings/src/main/kotlin/app/dqxn/android/feature/settings/overlay/OverlayScaffold.kt
  - android/feature/settings/src/main/kotlin/app/dqxn/android/feature/settings/overlay/OverlayTitleBar.kt
  - android/feature/settings/src/test/kotlin/app/dqxn/android/feature/settings/overlay/OverlayScaffoldTest.kt
autonomous: true
requirements:
  - F10.4

must_haves:
  truths:
    - "`:feature:settings` compiles with `:core:design` and `:data` dependencies"
    - "OverlayScaffold renders with correct OverlayType-based shapes and design tokens"
    - "OverlayTitleBar close button meets 76dp minimum touch target"
    - "SettingNavigation sealed interface has 4 event types"
  artifacts:
    - path: "android/feature/settings/build.gradle.kts"
      provides: "Feature settings module with core:design + data deps"
    - path: "android/feature/settings/src/main/kotlin/app/dqxn/android/feature/settings/SettingsNavigation.kt"
      provides: "SettingNavigation sealed interface with 4 events"
    - path: "android/feature/settings/src/main/kotlin/app/dqxn/android/feature/settings/overlay/OverlayScaffold.kt"
      provides: "Shared overlay container composable"
    - path: "android/feature/settings/src/test/kotlin/app/dqxn/android/feature/settings/overlay/OverlayScaffoldTest.kt"
      provides: "Robolectric Compose tests for overlay scaffold behavior"
  key_links:
    - from: "android/feature/settings/build.gradle.kts"
      to: ":core:design, :data"
      via: "implementation project dependencies"
      pattern: 'implementation\(project\(":core:design"\)\)'
---

<objective>
Feature settings module configuration, shared overlay infrastructure, and navigation types.

Purpose: Establish the `:feature:settings` module as compilable with correct dependencies, create the shared overlay container used by all subsequent overlay plans, and define the navigation event types for sub-picker routing.
Output: Compilable `:feature:settings` module, OverlayScaffold/OverlayTitleBar with behavior tests, SettingNavigation sealed interface.
</objective>

<execution_context>
@/Users/ohm/.claude/get-shit-done/workflows/execute-plan.md
@/Users/ohm/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-settings-foundation-setup-ui/10-RESEARCH.md

@android/feature/settings/build.gradle.kts
@android/core/design/src/main/kotlin/app/dqxn/android/core/design/token/CardSize.kt
@android/core/design/src/main/kotlin/app/dqxn/android/core/design/token/DashboardSpacing.kt
@android/core/design/src/main/kotlin/app/dqxn/android/core/design/token/TextEmphasis.kt
@android/core/design/src/main/kotlin/app/dqxn/android/core/design/token/DashboardTypography.kt
@android/core/design/src/main/kotlin/app/dqxn/android/core/design/motion/DashboardMotion.kt
</context>

<tasks>

<task type="auto">
  <name>Task 1: Feature settings build config + SettingsNavigation</name>
  <files>
    android/feature/settings/build.gradle.kts
    android/feature/settings/src/main/kotlin/app/dqxn/android/feature/settings/SettingsNavigation.kt
  </files>
  <action>
    1. **build.gradle.kts**: Add explicit dependencies beyond what `dqxn.android.feature` provides:
       ```kotlin
       plugins { id("dqxn.android.feature") }
       android { namespace = "app.dqxn.android.feature.settings" }
       dependencies {
           implementation(project(":core:design"))
           implementation(project(":data"))
       }
       ```
       The `dqxn.android.feature` convention plugin already provides `:sdk:*`, lifecycle, Hilt, Navigation Compose, and Compose. `:core:design` needed for tokens/motion. `:data` needed for repository injection (Delete All Data, analytics consent).

    2. **SettingsNavigation.kt**: Sealed interface with 4 events for sub-navigation within settings:
       ```kotlin
       sealed interface SettingNavigation {
           data class ToTimezonePicker(val settingKey: String, val currentValue: String?) : SettingNavigation
           data class ToDateFormatPicker(val settingKey: String, val currentValue: DateFormatOption) : SettingNavigation
           data class ToAppPicker(val settingKey: String, val currentPackage: String?) : SettingNavigation
           data class OnInstructionAction(val settingKey: String, val action: InstructionAction) : SettingNavigation
       }
       ```
       Import `DateFormatOption` and `InstructionAction` from `:sdk:contracts`.
  </action>
  <verify>
    <automated>cd /Users/ohm/Workspace/dqxn/android && ./gradlew :feature:settings:compileDebugKotlin --console=plain 2>&1 | tail -10</automated>
  </verify>
  <done>
    - `:feature:settings` compiles with `:core:design` and `:data` dependencies
    - SettingNavigation sealed interface has 4 event types
  </done>
</task>

<task type="auto">
  <name>Task 2: OverlayScaffold + OverlayTitleBar + behavior tests</name>
  <files>
    android/feature/settings/src/main/kotlin/app/dqxn/android/feature/settings/overlay/OverlayScaffold.kt
    android/feature/settings/src/main/kotlin/app/dqxn/android/feature/settings/overlay/OverlayTitleBar.kt
    android/feature/settings/src/test/kotlin/app/dqxn/android/feature/settings/overlay/OverlayScaffoldTest.kt
  </files>
  <action>
    1. **OverlayScaffold.kt**: Shared container composable for all overlay surfaces.
       - `OverlayType` enum: `Hub` (full-screen, no rounded corners), `Preview` (top-rounded), `Confirmation` (all-rounded).
       - Shape derived from `OverlayType` using `CardSize.LARGE.cornerRadius` (16dp) -- NOT inline dp values per replication advisory fix.
       - Background color from `LocalDashboardTheme.current`.
       - Uses `DashboardSpacing.ScreenEdgePadding` for internal padding.
       - Uses `DashboardMotion.sheetEnter/sheetExit` for `AnimatedVisibility`.
       - Accepts `title: String`, `overlayType: OverlayType`, `onClose: () -> Unit`, `modifier: Modifier`, `content: @Composable () -> Unit`.
       - Minimum touch target 76dp on close button (F10.4).
       - Uses `Column` with `OverlayTitleBar` at top and `content()` filling remaining space.

    2. **OverlayTitleBar.kt**: Title + close button composable.
       - Title uses `DashboardTypography.title`.
       - Text color from `LocalDashboardTheme.current.primaryTextColor`.
       - Close button uses `TextEmphasis.Medium` (0.7f) alpha -- NOT inline 0.6f per advisory fix.
       - Close button minimum size 76dp (F10.4).
       - Row layout with `SpaceBetween` arrangement.

    3. **OverlayScaffoldTest.kt**: Robolectric Compose test verifying behavior (NOT compile-only):
       - **Shape logic**: Render with `OverlayType.Hub`, verify no rounded corners (0dp). Render with `OverlayType.Preview`, verify top corners rounded. Render with `OverlayType.Confirmation`, verify all corners rounded. Use `onNode` semantics to verify clip shape.
       - **Touch target sizing**: Render OverlayScaffold, find close button via test tag `"overlay_close_button"`, verify minimum size >= 76dp via `assertHeightIsAtLeast(76.dp)` and `assertWidthIsAtLeast(76.dp)`.
       - **Design token usage**: Verify title text renders with expected content (title string visible in semantics). Verify close button has correct alpha (`TextEmphasis.Medium` = 0.7f).
       - **Content slot**: Verify content composable renders inside scaffold (pass `Text("test content")`, verify "test content" appears in semantics tree).

       Use `createComposeRule()`. Provide fake `LocalDashboardTheme` via `CompositionLocalProvider`.
  </action>
  <verify>
    <automated>cd /Users/ohm/Workspace/dqxn/android && ./gradlew :feature:settings:testDebugUnitTest --tests "*.OverlayScaffoldTest" --console=plain 2>&1 | tail -20</automated>
  </verify>
  <done>
    - OverlayScaffold renders with OverlayType-based shape, design tokens, 76dp close button
    - OverlayTitleBar uses DashboardTypography.title and TextEmphasis.Medium
    - OverlayScaffoldTest passes: shape logic, touch target sizing, design token usage, content slot
  </done>
</task>

</tasks>

<verification>
```bash
cd /Users/ohm/Workspace/dqxn/android && ./gradlew :feature:settings:testDebugUnitTest --tests "*.OverlayScaffoldTest" --console=plain 2>&1 | tail -30
```
</verification>

<success_criteria>
- `:feature:settings` module compiles with `:core:design` and `:data` deps
- OverlayScaffold + OverlayTitleBar compile with correct design token usage
- OverlayScaffoldTest passes with shape, touch target, token, and content verification
- SettingNavigation sealed interface compiles with 4 event types
</success_criteria>

<output>
After completion, create `.planning/phases/10-settings-foundation-setup-ui/10-02-SUMMARY.md`
</output>
