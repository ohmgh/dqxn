---
phase: 12-ci-gates-benchmarking
plan: 05
type: execute
wave: 1
depends_on: []
files_modified:
  - android/gradle/libs.versions.toml
  - android/sdk/common/build.gradle.kts
autonomous: true
requirements: []

must_haves:
  truths:
    - "Pitest mutation testing attempted on :sdk:common with documented outcome (working or incompatibility recorded)"
    - "Version catalog has Pitest entries if setup succeeded"
  artifacts:
    - path: "android/sdk/common/build.gradle.kts"
      provides: "Pitest plugin configuration (if compatible) or commented-out block with incompatibility note"
      contains: "pitest"
  key_links:
    - from: "android/sdk/common/build.gradle.kts"
      to: "android/gradle/libs.versions.toml"
      via: "Pitest plugin alias reference"
      pattern: "pitest"
---

<objective>
Best-effort Pitest mutation testing setup on `:sdk:common`.

Purpose: Roadmap SC6 requires "Mutation kill rate tracking configured (Pitest setup)." Pitest compatibility with Kotlin 2.3 + JDK 25 is LOW confidence per research. This plan attempts setup and documents the outcome either way. Not a blocking gate at V1 -- tracking only.

Output: Either a working Pitest configuration on `:sdk:common` with a recorded kill rate, or a documented incompatibility in STATE.md with the specific error.
</objective>

<execution_context>
@/Users/ohm/.claude/get-shit-done/workflows/execute-plan.md
@/Users/ohm/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/12-ci-gates-benchmarking/12-RESEARCH.md
@android/gradle/libs.versions.toml
@android/sdk/common/build.gradle.kts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Pitest version catalog entries + configure on :sdk:common</name>
  <files>
    android/gradle/libs.versions.toml
    android/sdk/common/build.gradle.kts
  </files>
  <action>
Add Pitest entries to `android/gradle/libs.versions.toml`:

**Versions section:**
```
pitest = "1.22.0"
pitest-plugin = "1.19.0-rc.2"
```

**Plugins section:**
```
pitest = { id = "info.solidsoft.pitest", version.ref = "pitest-plugin" }
```

Note: Use `info.solidsoft.pitest` (standard JVM plugin) for `:sdk:common` since it's an Android library but Pitest targets JVM test classes. If the standard plugin fails with Android module, try `pl.droidsonroids.pitest` instead (add `pitest-android-plugin = "0.2.25"` version and `pitest-android = { id = "pl.droidsonroids.pitest", version.ref = "pitest-android-plugin" }` plugin alias).

Add to `android/sdk/common/build.gradle.kts`:

1. `alias(libs.plugins.pitest)` in plugins block
2. Pitest configuration block:
```kotlin
pitest {
    targetClasses.set(listOf("app.dqxn.android.sdk.common.*"))
    threads.set(4)
    outputFormats.set(listOf("XML", "HTML"))
    timestampedReports.set(false)
    junit5PluginVersion.set("1.2.1")
    mutators.set(listOf("DEFAULTS"))
}
```

3. Add `testImplementation("org.pitest:pitest-junit5-plugin:1.2.1")` to dependencies.

**Fallback protocol:** If `./gradlew :sdk:common:pitest --console=plain` fails with:
- JDK 25 bytecode error: Record the exact error in a comment block in `build.gradle.kts`, comment out the pitest config, and note in SUMMARY.md: "Pitest incompatible with JDK 25 â€” deferred to post-JDK-25-support release."
- Android module error: Switch to `pl.droidsonroids.pitest` plugin and retry.
- Other error: Record error and comment out config.

The goal is to ATTEMPT and DOCUMENT, not to force success.
  </action>
  <verify>
    <automated>cd /Users/ohm/Workspace/dqxn/android && grep -q "pitest" gradle/libs.versions.toml && grep -q "pitest" sdk/common/build.gradle.kts && ./gradlew :sdk:common:compileDebugKotlin --console=plain 2>&1 | tail -5 && echo "PASS: pitest configured, module compiles" || echo "FAIL"</automated>
  </verify>
  <done>Pitest attempted on :sdk:common. Either: (a) `./gradlew :sdk:common:pitest` runs and produces mutation report, or (b) incompatibility documented with exact error, config commented out, module still compiles.</done>
</task>

</tasks>

<verification>
```bash
cd /Users/ohm/Workspace/dqxn/android

# 1. Version catalog has pitest entries
grep -q "pitest" gradle/libs.versions.toml

# 2. sdk:common references pitest (either active or commented)
grep -q "pitest" sdk/common/build.gradle.kts

# 3. Module still compiles regardless of pitest outcome
./gradlew :sdk:common:compileDebugKotlin --console=plain

# 4. If pitest succeeded, report exists:
# ls sdk/common/build/reports/pitest/ 2>/dev/null
```
</verification>

<success_criteria>
- Version catalog contains Pitest version and plugin entries
- `:sdk:common` build.gradle.kts references Pitest (active config or commented-out with documented reason)
- `:sdk:common` still compiles regardless of Pitest outcome
- SUMMARY documents the outcome: working kill rate OR specific incompatibility error
</success_criteria>

<output>
After completion, create `.planning/phases/12-ci-gates-benchmarking/12-05-SUMMARY.md`
</output>
